{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp, FirebaseApp } from 'firebase/app';\r\nimport { getAuth, GoogleAuthProvider, Auth } from 'firebase/auth';\r\nimport { getFirestore, Firestore } from 'firebase/firestore';\r\nimport { getDatabase, Database } from 'firebase/database';\r\n\r\n// 1. CONFIGURATION\r\nconst firebaseConfig = {\r\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n    databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,\r\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID\r\n};\r\n\r\n// 2. SINGLETON INSTANCES\r\nlet app: FirebaseApp | null = null;\r\nlet auth: Auth | null = null;\r\nlet db: Firestore | null = null;\r\nlet rtdb: Database | null = null;\r\nlet googleProvider: GoogleAuthProvider | null = null;\r\n\r\n// 3. INITIALIZATION (Safe for SSR/HMR)\r\nif (typeof window !== \"undefined\") {\r\n    try {\r\n        // A. APP INITIALIZATION\r\n        if (getApps().length === 0) {\r\n            app = initializeApp(firebaseConfig);\r\n            console.log(\"[System] Firebase App Initialized (Fresh)\");\r\n        } else {\r\n            app = getApp();\r\n            console.log(\"[System] Firebase App Reused (HMR/Existing)\");\r\n        }\r\n\r\n        // B. AUTH\r\n        if (app) {\r\n            auth = getAuth(app);\r\n            googleProvider = new GoogleAuthProvider();\r\n            googleProvider.setCustomParameters({ prompt: 'select_account' });\r\n        }\r\n\r\n        // C. FIRESTORE\r\n        if (app) {\r\n            db = getFirestore(app);\r\n        }\r\n\r\n        // D. REALTIME DATABASE (CRITICAL SINGLETON FIX)\r\n        if (app && firebaseConfig.databaseURL) {\r\n            // Explicitly pass URL to prevent default mismatch errors\r\n            rtdb = getDatabase(app, firebaseConfig.databaseURL);\r\n            console.log(\"[System] RTDB Singleton Initialized\");\r\n        } else {\r\n            console.error(\"[System] RTDB Failed: Missing URL or App\");\r\n        }\r\n\r\n    } catch (e) {\r\n        console.error(\"[System] FATAL FIREBASE INIT ERROR:\", e);\r\n    }\r\n}\r\n\r\n// 4. EXPORTS (Getters allow safe consumption, but instances are frozen)\r\nexport const getAuthInstance = () => auth;\r\nexport const getFirestoreInstance = () => db;\r\nexport const getDatabaseInstance = () => rtdb;\r\nexport const getGoogleProvider = () => googleProvider;\r\n\r\n// 5. CONFIG VALIDATOR\r\nexport const isConfigValid = (): boolean => {\r\n    if (typeof window === \"undefined\") return false;\r\n    const hasPlaceholders = Object.values(firebaseConfig).some(val => val && val.startsWith('PLACEHOLDER'));\r\n    const requiredKeys = ['apiKey', 'authDomain', 'projectId', 'databaseURL'];\r\n    const missingKeys = requiredKeys.filter(key => !firebaseConfig[key as keyof typeof firebaseConfig]);\r\n    return !hasPlaceholders && missingKeys.length === 0;\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,mBAAmB;AACnB,MAAM,iBAAiB;IACnB,MAAM;IACN,UAAU;IACV,WAAW;IACX,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACT;AAEA,yBAAyB;AACzB,IAAI,MAA0B;AAC9B,IAAI,OAAoB;AACxB,IAAI,KAAuB;AAC3B,IAAI,OAAwB;AAC5B,IAAI,iBAA4C;AAEhD,uCAAuC;AACvC;;AAsCO,MAAM,kBAAkB,IAAM;AAC9B,MAAM,uBAAuB,IAAM;AACnC,MAAM,sBAAsB,IAAM;AAClC,MAAM,oBAAoB,IAAM;AAGhC,MAAM,gBAAgB;IACzB,wCAAmC,OAAO;;;IAC1C,MAAM;IACN,MAAM;IACN,MAAM;AAEV"}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/AuthService.ts"],"sourcesContent":["import { UserProfile, AuthContextState } from '../types';\r\nimport { getAuthInstance, getGoogleProvider } from './firebase';\r\nimport { signInWithPopup, signOut, onAuthStateChanged, User as FirebaseUser } from 'firebase/auth';\r\n\r\nconst STORAGE_KEY = 'accs_auth_storage';\r\n\r\n// Helper to map Firebase User to Cortex Profile\r\nconst mapUser = (fbUser: FirebaseUser): UserProfile => ({\r\n    id: fbUser.uid,\r\n    email: fbUser.email || '',\r\n    name: fbUser.displayName || 'Student',\r\n    role: 'STUDENT', // Default to Student\r\n    avatarUrl: fbUser.photoURL || undefined,\r\n    completed: false, // Default to false until we verify with Firestore\r\n    createdAt: fbUser.metadata.creationTime || new Date().toISOString()\r\n});\r\n\r\nexport const AuthService = {\r\n\r\n    /**\r\n     * Initializes Auth Listener\r\n     * Returns an unsubscriber\r\n     */\r\n    initCallback: (callback: (state: AuthContextState) => void) => {\r\n        const auth = getAuthInstance();\r\n\r\n        if (!auth) {\r\n            callback({ status: 'GUEST', user: null, token: null });\r\n            return () => { }; // Return dummy unsubscriber\r\n        }\r\n\r\n        return onAuthStateChanged(auth, (user: FirebaseUser | null) => {\r\n            if (user) {\r\n                const profile = mapUser(user);\r\n                // Persist minimal state for checks before JS loads (optional)\r\n                localStorage.setItem(STORAGE_KEY, JSON.stringify({\r\n                    status: 'AUTHENTICATED',\r\n                    user: profile\r\n                }));\r\n\r\n                callback({\r\n                    status: 'AUTHENTICATED',\r\n                    user: profile,\r\n                    token: 'valid_session'\r\n                });\r\n            } else {\r\n                localStorage.removeItem(STORAGE_KEY);\r\n                callback({\r\n                    status: 'GUEST',\r\n                    user: null,\r\n                    token: null\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Google Login via Popup\r\n     */\r\n    loginWithGoogle: async (): Promise<AuthContextState> => {\r\n        const auth = getAuthInstance();\r\n        const provider = getGoogleProvider();\r\n\r\n        // HARDENING: Friendly Error if Auth failed to init (e.g. missing keys)\r\n        if (!auth || !provider) {\r\n            const msg = \"Configuration Error: Authentication service unavailable.\";\r\n            console.error(\"[Auth] Missing Firebase Config\");\r\n            return { status: 'GUEST', user: null, token: null }; // Degrade instead of throw\r\n        }\r\n\r\n        try {\r\n            const result = await signInWithPopup(auth, provider);\r\n            const user = result.user;\r\n            const profile = mapUser(user);\r\n\r\n            return {\r\n                status: 'AUTHENTICATED',\r\n                user: profile,\r\n                token: await user.getIdToken()\r\n            };\r\n        } catch (error: any) {\r\n            console.error(\"[Auth] Google Login Blocked/Failed\", error.code, error.message);\r\n\r\n            // Map to User-Friendly Errors\r\n            let friendlyMessage = \"Sign-in failed. Please try again.\";\r\n            if (error.code === 'auth/popup-closed-by-user') friendlyMessage = \"Sign-in cancelled.\";\r\n            if (error.code === 'auth/popup-blocked') friendlyMessage = \"Popup blocked. Please allow popups for this site.\";\r\n            if (error.code === 'auth/network-request-failed') friendlyMessage = \"Network error. Check your connection.\";\r\n\r\n            throw new Error(friendlyMessage);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Logout\r\n     */\r\n    logout: async () => {\r\n        const auth = getAuthInstance();\r\n        if (auth) await signOut(auth);\r\n        localStorage.removeItem(STORAGE_KEY);\r\n    },\r\n\r\n    // Legacy/Mock methods for Email (optional to keep or remove?)\r\n    // Keeping basic stub for types compatibility or if needed later\r\n    login: async (email: string, password: string) => { throw new Error(\"Email Login not implemented in MVP\"); },\r\n    register: async (identity: any, profile: any) => { throw new Error(\"Email Register not implemented in MVP\"); },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AACA;AACA;AAAA;;;AAEA,MAAM,cAAc;AAEpB,gDAAgD;AAChD,MAAM,UAAU,CAAC,SAAsC,CAAC;QACpD,IAAI,OAAO,GAAG;QACd,OAAO,OAAO,KAAK,IAAI;QACvB,MAAM,OAAO,WAAW,IAAI;QAC5B,MAAM;QACN,WAAW,OAAO,QAAQ,IAAI;QAC9B,WAAW;QACX,WAAW,OAAO,QAAQ,CAAC,YAAY,IAAI,IAAI,OAAO,WAAW;IACrE,CAAC;AAEM,MAAM,cAAc;IAEvB;;;KAGC,GACD,cAAc,CAAC;QACX,MAAM,OAAO,IAAA,sJAAe;QAE5B,IAAI,CAAC,MAAM;YACP,SAAS;gBAAE,QAAQ;gBAAS,MAAM;gBAAM,OAAO;YAAK;YACpD,OAAO,KAAQ,GAAG,4BAA4B;QAClD;QAEA,OAAO,IAAA,wLAAkB,EAAC,MAAM,CAAC;YAC7B,IAAI,MAAM;gBACN,MAAM,UAAU,QAAQ;gBACxB,8DAA8D;gBAC9D,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;oBAC7C,QAAQ;oBACR,MAAM;gBACV;gBAEA,SAAS;oBACL,QAAQ;oBACR,MAAM;oBACN,OAAO;gBACX;YACJ,OAAO;gBACH,aAAa,UAAU,CAAC;gBACxB,SAAS;oBACL,QAAQ;oBACR,MAAM;oBACN,OAAO;gBACX;YACJ;QACJ;IACJ;IAEA;;KAEC,GACD,iBAAiB;QACb,MAAM,OAAO,IAAA,sJAAe;QAC5B,MAAM,WAAW,IAAA,wJAAiB;QAElC,uEAAuE;QACvE,IAAI,CAAC,QAAQ,CAAC,UAAU;YACpB,MAAM,MAAM;YACZ,QAAQ,KAAK,CAAC;YACd,OAAO;gBAAE,QAAQ;gBAAS,MAAM;gBAAM,OAAO;YAAK,GAAG,2BAA2B;QACpF;QAEA,IAAI;YACA,MAAM,SAAS,MAAM,IAAA,qLAAe,EAAC,MAAM;YAC3C,MAAM,OAAO,OAAO,IAAI;YACxB,MAAM,UAAU,QAAQ;YAExB,OAAO;gBACH,QAAQ;gBACR,MAAM;gBACN,OAAO,MAAM,KAAK,UAAU;YAChC;QACJ,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,sCAAsC,MAAM,IAAI,EAAE,MAAM,OAAO;YAE7E,8BAA8B;YAC9B,IAAI,kBAAkB;YACtB,IAAI,MAAM,IAAI,KAAK,6BAA6B,kBAAkB;YAClE,IAAI,MAAM,IAAI,KAAK,sBAAsB,kBAAkB;YAC3D,IAAI,MAAM,IAAI,KAAK,+BAA+B,kBAAkB;YAEpE,MAAM,IAAI,MAAM;QACpB;IACJ;IAEA;;KAEC,GACD,QAAQ;QACJ,MAAM,OAAO,IAAA,sJAAe;QAC5B,IAAI,MAAM,MAAM,IAAA,6KAAO,EAAC;QACxB,aAAa,UAAU,CAAC;IAC5B;IAEA,8DAA8D;IAC9D,gEAAgE;IAChE,OAAO,OAAO,OAAe;QAAuB,MAAM,IAAI,MAAM;IAAuC;IAC3G,UAAU,OAAO,UAAe;QAAmB,MAAM,IAAI,MAAM;IAA0C;AACjH"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/FirestoreService.ts"],"sourcesContent":["import {\r\n    doc,\r\n    setDoc,\r\n    getDoc,\r\n    getDocs,\r\n    deleteDoc,\r\n    serverTimestamp,\r\n    collection,\r\n    onSnapshot,\r\n    writeBatch\r\n} from 'firebase/firestore';\r\nimport { getFirestoreInstance } from './firebase';\r\n\r\n/**\r\n * Firestore Service - Silent Sync Layer\r\n * \r\n * Philosophy: \r\n * 1. Local-first: If Firestore fails, we ignore it.\r\n * 2. Unobtrusive: Never throw errors to the main app.\r\n * 3. Specific: Only touch define paths users/{uid}/...\r\n */\r\n\r\nexport const FirestoreService = {\r\n\r\n    /**\r\n     * Save basic user profile data (silently)\r\n     */\r\n    saveUserProfile: async (uid: string, profile: Partial<any>) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const userRef = doc(db, 'users', uid, 'profile', 'main');\r\n            await setDoc(userRef, {\r\n                ...profile,\r\n                lastActive: serverTimestamp(),\r\n            }, { merge: true });\r\n\r\n            console.log(\"[Firestore] Profile saved successfully.\");\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to save profile:\", error);\r\n            throw error; // Propagate to UI\r\n        }\r\n    },\r\n\r\n    saveSubject: async (uid: string, subjectId: string, subjectData: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const subjectRef = doc(db, 'users', uid, 'subjects', subjectId);\r\n            await setDoc(subjectRef, {\r\n                ...subjectData,\r\n                lastUpdated: serverTimestamp()\r\n            }, { merge: true });\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to save subject:\", error);\r\n        }\r\n    },\r\n\r\n    deleteSubject: async (uid: string, subjectId: string) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const subjectRef = doc(db, 'users', uid, 'subjects', subjectId);\r\n            await deleteDoc(subjectRef);\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to delete subject:\", error);\r\n        }\r\n    },\r\n\r\n    saveLecture: async (uid: string, subjectId: string, lectureId: string, lectureData: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const lectureRef = doc(db, 'users', uid, 'subjects', subjectId, 'lectures', lectureId);\r\n            await setDoc(lectureRef, {\r\n                ...lectureData,\r\n                updatedAt: serverTimestamp()\r\n            }, { merge: true });\r\n\r\n            const subjectRef = doc(db, 'users', uid, 'subjects', subjectId);\r\n            await setDoc(subjectRef, {\r\n                lastUpdated: serverTimestamp()\r\n            }, { merge: true });\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to save lecture:\", error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * ATOMIC SAVE: Session + Snapshot\r\n     * Ensures UI and Data never drift.\r\n     */\r\n    saveSessionWithSnapshot: async (uid: string, session: any, snapshot: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const batch = writeBatch(db);\r\n\r\n            // 1. Session Ref\r\n            const sessionRef = doc(db, 'users', uid, 'subjects', session.subjectId, 'lectures', session.lectureId, 'sessions', session.id);\r\n            batch.set(sessionRef, {\r\n                ...session,\r\n                syncedAt: serverTimestamp()\r\n            });\r\n\r\n            // 2. Snapshot Ref (Authority)\r\n            const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n            batch.set(snapshotRef, {\r\n                ...snapshot,\r\n                lastUpdatedAt: serverTimestamp(),\r\n                snapshotVersion: 1\r\n            }, { merge: true });\r\n\r\n            // 3. Cognitive Index Ref (Parallel Sync)\r\n            if (session.performanceIndex) {\r\n                const indexRef = doc(db, 'users', uid, 'cognitiveIndex', 'main');\r\n                batch.set(indexRef, {\r\n                    value: session.performanceIndex, // Simplified for now\r\n                    totalSessions: snapshot.profile.totalSessions,\r\n                    lastUpdated: serverTimestamp()\r\n                }, { merge: true });\r\n            }\r\n\r\n            // Execute Atomic Commit\r\n            await batch.commit();\r\n            console.log(\"[Firestore] Atomic Save Complete: Session + Snapshot\");\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to atomic save:\", error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * ATOMIC SUBJECT SAVE: Subject + Snapshot Touch\r\n     */\r\n    saveSubjectWithSnapshot: async (uid: string, subjectId: string, subjectData: any, snapshot: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const batch = writeBatch(db);\r\n\r\n            // 1. Subject Ref\r\n            const subjectRef = doc(db, 'users', uid, 'subjects', subjectId);\r\n            batch.set(subjectRef, {\r\n                ...subjectData,\r\n                lastUpdated: serverTimestamp()\r\n            }, { merge: true });\r\n\r\n            // 2. Snapshot Ref (Beacon)\r\n            const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n            batch.set(snapshotRef, {\r\n                ...snapshot,\r\n                lastUpdatedAt: serverTimestamp(),\r\n                snapshotVersion: 1\r\n            }, { merge: true });\r\n\r\n            await batch.commit();\r\n            console.log(\"[Firestore] Atomic Save: Subject + Snapshot\");\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to save subject:\", error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * RECURSIVE DELETE: Subject + Lectures + Sessions + Snapshot\r\n     */\r\n    deleteSubjectRecursive: async (uid: string, subjectId: string, snapshot: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            console.log(\"[Firestore] Starting Recursive Delete for:\", subjectId);\r\n            const batch = writeBatch(db);\r\n\r\n            // 1. Delete Subject Document\r\n            const subjectRef = doc(db, 'users', uid, 'subjects', subjectId);\r\n            batch.delete(subjectRef);\r\n\r\n            // 2. Find and Delete All Lectures\r\n            const lecturesColl = collection(db, 'users', uid, 'subjects', subjectId, 'lectures');\r\n            const lecturesSnap = await getDocs(lecturesColl);\r\n\r\n            for (const lecDoc of lecturesSnap.docs) {\r\n                // 3. Find and Delete All Sessions for this Lecture\r\n                const sessionsColl = collection(db, 'users', uid, 'subjects', subjectId, 'lectures', lecDoc.id, 'sessions');\r\n                const sessionsSnap = await getDocs(sessionsColl);\r\n\r\n                sessionsSnap.forEach(sessDoc => {\r\n                    batch.delete(sessDoc.ref);\r\n                });\r\n\r\n                batch.delete(lecDoc.ref);\r\n            }\r\n\r\n            // 4. Update Snapshot (Beacon)\r\n            const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n            batch.set(snapshotRef, {\r\n                ...snapshot,\r\n                lastUpdatedAt: serverTimestamp(),\r\n                snapshotVersion: 1\r\n            }, { merge: true });\r\n\r\n            await batch.commit();\r\n            console.log(\"[Firestore] Recursive Delete Complete\");\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to delete subject recursively:\", error);\r\n        }\r\n    },\r\n\r\n    saveStateSnapshot: async (uid: string, snapshot: any) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return;\r\n\r\n            const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n            await setDoc(snapshotRef, {\r\n                ...snapshot,\r\n                lastUpdatedAt: serverTimestamp(),\r\n                snapshotVersion: 1\r\n            }, { merge: true });\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to save state snapshot:\", error);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Load FULL user data on login to hydrate local store.\r\n     * Recursively fetches Subjects -> Lectures -> Sessions.\r\n     * Includes Raw Data Normalization to prevent undefined errors.\r\n     */\r\n    loadUserData: async (uid: string) => {\r\n        try {\r\n            const db = getFirestoreInstance();\r\n            if (!db) return null;\r\n\r\n            console.log(\"[Firestore] Starting deep hydration for:\", uid);\r\n            const startTime = Date.now();\r\n\r\n            // 1. Load Cognitive Index, State Snapshot, AND Identity Profile (Parallel)\r\n            const indexRef = doc(db, 'users', uid, 'cognitiveIndex', 'main');\r\n            const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n            const profileRef = doc(db, 'users', uid, 'profile', 'main');\r\n\r\n            const [indexSnap, snapshotSnap, profileSnap] = await Promise.all([\r\n                getDoc(indexRef),\r\n                getDoc(snapshotRef),\r\n                getDoc(profileRef)\r\n            ]);\r\n\r\n            const cognitiveIndex = indexSnap.exists() ? indexSnap.data() : null;\r\n            const stateSnapshot = snapshotSnap.exists() ? snapshotSnap.data() : null;\r\n            const identityProfile = profileSnap.exists() ? profileSnap.data() : null;\r\n\r\n            // 2. Load Subjects\r\n            const subjectsColl = collection(db, 'users', uid, 'subjects');\r\n            const subjectsSnap = await getDocs(subjectsColl);\r\n\r\n            const subjects: any[] = [];\r\n            const lectures: any[] = [];\r\n            const sessions: any[] = [];\r\n\r\n            // 3. Traverse Hierarchy (Parallelized at subject level)\r\n            await Promise.all(subjectsSnap.docs.map(async (subDoc) => {\r\n                const subData: any = subDoc.data();\r\n\r\n                // NORMALIZE SUBJECT\r\n                const validSubject = {\r\n                    ...subData,\r\n                    id: subDoc.id,\r\n                    name: subData.name || \"Unnamed Subject\",\r\n                    config: subData.config || { strictnessLevel: 0, preferredDays: [], sessionDurationTarget: 0 },\r\n                    metrics: subData.metrics || { stability: 0, readiness: 0, totalWeight: 0 }\r\n                };\r\n                subjects.push(validSubject);\r\n\r\n                // Fetch Lectures for this Subject\r\n                const lecturesColl = collection(db, 'users', uid, 'subjects', subDoc.id, 'lectures');\r\n                const lecturesSnap = await getDocs(lecturesColl);\r\n\r\n                await Promise.all(lecturesSnap.docs.map(async (lecDoc) => {\r\n                    const lecData: any = lecDoc.data();\r\n\r\n                    // NORMALIZE LECTURE\r\n                    const validLecture = {\r\n                        ...lecData,\r\n                        id: lecDoc.id,\r\n                        subjectId: subDoc.id,\r\n                        stability: lecData.stability ?? 0,\r\n                        status: lecData.status || 'Pending',\r\n                        cognitiveIndex: lecData.cognitiveIndex ?? 0,\r\n                        duration: lecData.duration || 0,\r\n                        relativeDifficulty: lecData.relativeDifficulty || 5\r\n                    };\r\n                    lectures.push(validLecture);\r\n\r\n                    // Fetch Sessions for this Lecture\r\n                    const sessionsColl = collection(db, 'users', uid, 'subjects', subDoc.id, 'lectures', lecDoc.id, 'sessions');\r\n                    const sessionsSnap = await getDocs(sessionsColl);\r\n\r\n                    sessionsSnap.forEach(sessDoc => {\r\n                        const sessData: any = sessDoc.data();\r\n                        // NORMALIZE SESSION\r\n                        sessions.push({\r\n                            ...sessData,\r\n                            id: sessDoc.id,\r\n                            lectureId: lecDoc.id,\r\n                            subjectId: subDoc.id,\r\n                            performanceIndex: sessData.performanceIndex ?? 0,\r\n                            cognitiveCost: sessData.cognitiveCost ?? 0\r\n                        });\r\n                    });\r\n                }));\r\n            }));\r\n\r\n            console.log(`[Firestore] Hydration complete in ${Date.now() - startTime}ms. Found: ${subjects.length} Subjects, ${lectures.length} Lectures.`);\r\n\r\n            return {\r\n                cognitiveIndex,\r\n                stateSnapshot,\r\n                identityProfile, // Normalized Identity Data\r\n                subjects,\r\n                lectures,\r\n                sessions\r\n            };\r\n\r\n        } catch (error) {\r\n            console.warn(\"[Firestore] Failed to load deep data:\", error);\r\n            return null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Real-time Listener for State Snapshot\r\n     * Returns an unsubscribe function.\r\n     */\r\n    subscribeToSnapshot: (uid: string, onUpdate: (snapshot: any) => void) => {\r\n        const db = getFirestoreInstance();\r\n        if (!db) return () => { };\r\n\r\n        const snapshotRef = doc(db, 'users', uid, 'stateSnapshot', 'main');\r\n\r\n        console.log(\"[Firestore] Attaching real-time listener to:\", uid);\r\n        const unsubscribe = onSnapshot(snapshotRef, (docSnap) => {\r\n            if (docSnap.exists()) {\r\n                onUpdate(docSnap.data());\r\n            }\r\n        });\r\n\r\n        return unsubscribe;\r\n    },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 582, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/CognitiveEngine.ts"],"sourcesContent":["/**\r\n * ENGINEERING: COGNITIVE ENGINE (DETERMINISTIC)\r\n * Reference: Cognitive System Implementation Plan\r\n * \r\n * ROLE:\r\n * Pure mathematical engine for calculating:\r\n * 1. Time Difficulty (Linear Mapping)\r\n * 2. Understanding Difficulty (Inversion)\r\n * 3. Relative Difficulty (Mean)\r\n * 4. Expected Study Time (Standard & Adaptive)\r\n * 5. Cognitive Index & Grading\r\n * 6. Cognitive Load Score (Biological Cost)\r\n * \r\n * PRINCIPLES:\r\n * - Deterministic: Same Input = Same Output\r\n * - No Fuzzy Logic: Strict Linear Scaling\r\n * - 0-10 Scale for all indices\r\n */\r\n\r\n// PART 8: GRADE MAPPING CONSTANTS\r\nexport type Grade = 'A+' | 'A' | 'B+' | 'B' | 'C+' | 'C' | 'D';\r\n\r\nexport const CognitiveEngine = {\r\n\r\n    /**\r\n     * MASTER CALCULATION (STRICT CONTRACT)\r\n     * Returns the full set of metrics required for System Persistence.\r\n     */\r\n    calculate: (params: {\r\n        lectureDuration: number,\r\n        actualDuration: number,\r\n        relativeDifficulty: number, // 0-10\r\n        studentIndex?: number | null // Optional for adaptive baseline\r\n    }) => {\r\n        const { lectureDuration, actualDuration, relativeDifficulty, studentIndex } = params;\r\n\r\n        // 1. Calculate Expected Time\r\n        const expected = CognitiveEngine.calculateExpectedStudyTime(lectureDuration, relativeDifficulty, studentIndex);\r\n\r\n        // 2. Calculate Cognitive Load Score (Biological Cost)\r\n        const loadScore = CognitiveEngine.calculateCognitiveLoadScore(expected, actualDuration, relativeDifficulty);\r\n\r\n        // 3. Calculate Performance Index (0-10)\r\n        const index = CognitiveEngine.calculateCognitiveIndex(expected, actualDuration);\r\n\r\n        // 4. Determine Grade\r\n        const grade = CognitiveEngine.determineGrade(index);\r\n\r\n        return {\r\n            expectedStudyTimeMinutes: expected,\r\n            relativeDifficulty: relativeDifficulty,\r\n            cognitiveLoadIndex: Math.round(loadScore), // Integer for UI\r\n            performanceGrade: grade,\r\n            performanceIndex: index\r\n        };\r\n    },\r\n\r\n    /**\r\n     * PART 1: TIME DIFFICULTY\r\n     * Maps duration 15m -> 1.667 to 120m -> 10.000\r\n     * Linear Scale.\r\n     */\r\n    calculateTimeDifficulty: (durationMinutes: number): number => {\r\n        const minTime = 15;\r\n        const maxTime = 120;\r\n        const minDiff = 1.667;\r\n        const maxDiff = 10.0;\r\n\r\n        // Clamp input\r\n        if (durationMinutes < minTime) return minDiff;\r\n        if (durationMinutes > maxTime) return maxDiff;\r\n\r\n        // MEDICAL GRADE = FOLLOW THE TABLE DATA.\r\n        const mapping: Record<number, number> = {\r\n            15: 1.667,\r\n            30: 3.334,\r\n            45: 5.001,\r\n            60: 6.668,\r\n            75: 8.335,\r\n            90: 9.168,\r\n            105: 9.584,\r\n            120: 10.000\r\n        };\r\n\r\n        if (mapping[durationMinutes]) return mapping[durationMinutes];\r\n\r\n        // Piecewise Interpolation for non-standard times\r\n        const breakpoints = [15, 30, 45, 60, 75, 90, 105, 120];\r\n\r\n        // 1. Find range\r\n        for (let i = 0; i < breakpoints.length - 1; i++) {\r\n            const low = breakpoints[i];\r\n            const high = breakpoints[i + 1];\r\n            if (durationMinutes >= low && durationMinutes <= high) {\r\n                const range = high - low;\r\n                const progress = (durationMinutes - low) / range;\r\n                const valLow = mapping[low];\r\n                const valHigh = mapping[high];\r\n                return valLow + progress * (valHigh - valLow);\r\n            }\r\n        }\r\n\r\n        // Out of bounds\r\n        if (durationMinutes < 15) return 1.667 * (durationMinutes / 15);\r\n        return 10.0;\r\n    },\r\n\r\n    /**\r\n     * PART 2: UNDERSTANDING INVERSION\r\n     * Understanding 1 -> Difficulty 10\r\n     * Understanding 10 -> Difficulty 1\r\n     */\r\n    calculateUnderstandingDifficulty: (understandingLevel: number): number => {\r\n        // Clamp input 1-10\r\n        const level = Math.max(1, Math.min(10, understandingLevel));\r\n        const difficulty = 11 - level;\r\n        return difficulty;\r\n    },\r\n\r\n    /**\r\n     * PART 3: RELATIVE DIFFICULTY\r\n     * Mean of TimeDifficulty and UnderstandingDifficulty\r\n     */\r\n    calculateRelativeDifficulty: (timeDiff: number, undDiff: number): number => {\r\n        const mean = (timeDiff + undDiff) / 2;\r\n        // Clamp 0-10 and Round 1 decimal\r\n        const result = Math.min(10, Math.max(0, mean));\r\n        return Math.round(result * 10) / 10;\r\n    },\r\n\r\n    /**\r\n     * PART 5 & 9: SCALE EXPECTED STUDY TIME (ADAPTIVE)\r\n     * Base = Duration * 2\r\n     * Final = Base * (RelativeDifficulty / 5) * AdaptiveFactor(Index)\r\n     * \r\n     * Adaptive Rules:\r\n     * - Index > 9 (Fast): x0.9 (Reward efficiency)\r\n     * - Index < 4 (Struggling): x1.2 (Remedial buffer)\r\n     * - Constraint: Diff 10 is typically max, but individual adaptation allows variation.\r\n     */\r\n    calculateExpectedStudyTime: (lectureDuration: number, relativeDifficulty: number, studentIndex: number | null = null): number => {\r\n        // Step 1: Base Expected Time (x2 rule)\r\n        const base = lectureDuration * 2;\r\n\r\n        /**\r\n         * CRITICAL RULE: FIRST-TIME STUDENT (ONBOARDING CONTRACT)\r\n         * If studentIndex is 0 (New Student), we MUST NOT apply strictly physics.\r\n         * The student has no history, so difficulty scaling is unfair/inaccurate.\r\n         * We simply double the time to ensure they have enough buffer.\r\n         */\r\n        if (studentIndex === 0) {\r\n            return Math.round(base);\r\n        }\r\n\r\n        // Step 2: Difficulty Scaling\r\n        // 5 = x1 (Standard)\r\n        // 10 = x2 (Hard)\r\n        const difficultyMultiplier = relativeDifficulty / 5;\r\n\r\n        let final = base * difficultyMultiplier;\r\n\r\n        // Step 3: Adaptive Logic (Part 9)\r\n        if (studentIndex !== null) {\r\n            if (studentIndex >= 9.0) {\r\n                final *= 0.9;\r\n            } else if (studentIndex <= 4.0) {\r\n                final *= 1.2;\r\n            }\r\n        }\r\n\r\n        return Math.round(final);\r\n    },\r\n\r\n    /**\r\n     * PART 10: COGNITIVE LOAD SCORE\r\n     * Formula: (Actual / Expected) * (RelativeDifficulty / 10) * 100\r\n     * Range: 0 - 100+\r\n     * Interpretation: High Score = High Mental Cost.\r\n     */\r\n    calculateCognitiveLoadScore: (expectedMinutes: number, actualMinutes: number, relativeDifficulty: number): number => {\r\n        if (expectedMinutes <= 0) return 0;\r\n\r\n        // Ratio > 1 means Slower (More time taken) -> Higher cost\r\n        const timeRatio = actualMinutes / expectedMinutes;\r\n\r\n        // Difficulty factor (0-1)\r\n        const diffFactor = relativeDifficulty / 10;\r\n\r\n        // Raw Score\r\n        const score = timeRatio * diffFactor * 100;\r\n\r\n        // Cap for UI sanity (e.g. 200)? Or leave uncapped?\r\n        // Prompt typically implies 0-100 scale, but logic allows overflow.\r\n        // We will clamp to 100 as \"Max Load\" usually implies \"Full Capacity\".\r\n        return Math.min(100, Math.round(score));\r\n    },\r\n\r\n    /**\r\n     * PART 7: COGNITIVE INDEX\r\n     * TimeRatio = Expected / Actual\r\n     * Normalized 0-10\r\n     */\r\n    calculateCognitiveIndex: (expectedMinutes: number, actualMinutes: number): number => {\r\n        if (actualMinutes <= 0) return 0;\r\n\r\n        // 1. Apply Tolerance Cap (No bonus beyond 10 mins early)\r\n        const cappedActual = Math.max(actualMinutes, expectedMinutes - 10);\r\n\r\n        // 2. Calculate Ratio\r\n        const ratio = expectedMinutes / cappedActual;\r\n\r\n        // 3. Dynamic Normalization\r\n        // Goal: Ratio 1.0 (On Time) -> Score 9.0 (A)\r\n        // Goal: Max Ratio (10m early) -> Score 10.0 (A+)\r\n        const maxRatio = expectedMinutes / (expectedMinutes - 10);\r\n\r\n        // Slope calculation\r\n        // Index = 9 + slope * (ratio - 1)\r\n        // 10 = 9 + slope * (maxRatio - 1)\r\n        // 1 = slope * (maxRatio - 1)\r\n        // slope = 1 / (maxRatio - 1)\r\n\r\n        const slope = 1 / (maxRatio - 1);\r\n\r\n        let index = 9 + slope * (ratio - 1);\r\n\r\n        // Fallback for very slow students\r\n        return Math.min(10, Math.max(0, parseFloat(index.toFixed(2))));\r\n    },\r\n\r\n    /**\r\n     * PART 8: GRADE MAPPING\r\n     */\r\n    determineGrade: (index: number): Grade => {\r\n        if (index >= 9.5) return 'A+';\r\n        if (index >= 8.5) return 'A';\r\n        if (index >= 7.5) return 'B+';\r\n        if (index >= 6.5) return 'B';\r\n        if (index >= 5.5) return 'C+';\r\n        if (index >= 4.0) return 'C';\r\n        return 'D';\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 789, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/store/useStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist, createJSONStorage } from 'zustand/middleware';\r\nimport {\r\n    StudentProfile,\r\n    Subject,\r\n    Lecture,\r\n    DailyLoad,\r\n    StudySession,\r\n    SubjectConfig,\r\n    SubjectMetrics,\r\n    AuthContextState,\r\n    UserProfile\r\n} from '@/core/types';\r\nimport { AuthService } from '@/core/services/AuthService';\r\nimport { FirestoreService } from '@/core/services/FirestoreService';\r\nimport { getDatabaseInstance } from '@/core/services/firebase';\r\nimport { ref, onValue } from 'firebase/database';\r\nimport { CognitiveEngine } from '@/core/engines/CognitiveEngine';\r\n\r\n// --- ADMIN STATE SLICE ---\r\ninterface AdminSlice {\r\n    students: UserProfile[];\r\n    selectedStudent: UserProfile | null;\r\n    isAdminMode: boolean; // UI Toggle\r\n    adminError: string | null; // Error State for UI Feedback\r\n\r\n    // Actions\r\n    fetchStudents: () => Promise<void>;\r\n    selectStudent: (student: UserProfile | null) => void;\r\n    setAdminMode: (isActive: boolean) => void;\r\n}\r\n\r\n// Merge SystemState\r\ninterface SystemState extends AdminSlice {\r\n    // --- STATE SLICES ---\r\n\r\n    profile: StudentProfile;\r\n    subjects: Subject[];\r\n    lectures: Lecture[]; // Normalized list of all lectures\r\n    sessions: StudySession[];\r\n    dailyLoad: DailyLoad; // Current Day's Accumulator\r\n\r\n    // --- AUTHENTICATION ---\r\n    authState: AuthContextState;\r\n    authModal: { isOpen: boolean; mode: 'LOGIN' | 'REGISTER'; onSuccess?: () => void };\r\n    unsubscribeSnapshot?: () => void; // Listener cleanup\r\n\r\n    // Remote Termination State\r\n    terminationState: { reason: string; message: string; severity?: 'warning' | 'info' } | null;\r\n\r\n    // --- ACTIVE SESSION (PERSISTENCE) ---\r\n    activeSession: {\r\n        lectureId: string;\r\n        subjectId: string; // Explicitly Added\r\n        startTime: number;     // Timestamp when session started\r\n        originalDuration: number; // Planned minutes\r\n        pausedAt: number | null; // Timestamp if currently paused, else null\r\n        totalPausedTime: number; // Accumulated pause duration in ms\r\n        isActive: boolean;     // Redundant but helpful? Keep for clarity.\r\n    } | null;\r\n\r\n    // --- ACTIONS (Mutators) ---\r\n\r\n    // 1. Subject Control\r\n    addSubject: (subject: Subject) => void;\r\n    renameSubject: (id: string, newName: string) => void;\r\n    deleteSubject: (id: string) => void;\r\n    updateSubjectConfig: (id: string, config: Partial<SubjectConfig>) => void;\r\n    updateSubjectMetrics: (id: string, metrics: Partial<SubjectMetrics>) => void;\r\n\r\n    // 2. Inventory Management\r\n    addLecture: (lecture: Lecture) => void;\r\n    updateLectureStatus: (id: string, status: Lecture['status']) => void;\r\n    updateLectureStability: (id: string, newStability: number) => void;\r\n\r\n    // 3. Operational Flow\r\n    registerSession: (session: StudySession) => void;\r\n    resetDailyLoad: () => void; // Called by checkNewDay() logic\r\n\r\n    updateCapacity: (newCapacity: number) => void;\r\n    setProfile: (profile: StudentProfile) => void;\r\n\r\n    // 4. Active Session Control\r\n    startActiveSession: (lectureId: string, durationMinutes: number, subjectId: string) => void;\r\n    endActiveSession: (penalty?: boolean, isRemoteKill?: boolean, terminationPayload?: { reason: string; message: string; severity?: 'warning' | 'info' }) => void; // Finalizes the session\r\n    pauseActiveSession: () => void;\r\n    resumeActiveSession: () => void;\r\n    deleteLecture: (lectureId: string) => void;\r\n    clearActiveSession: () => void;\r\n\r\n    // --- AUTH ACTIONS ---\r\n    login: (email: string, pass: string) => Promise<boolean>;\r\n    loginWithGoogle: () => Promise<{ success: boolean; error?: string }>;\r\n    register: (identity: any, profile: any) => Promise<boolean>;\r\n    logout: () => void;\r\n    syncAuth: () => void;\r\n    initializeRealtimeSync: (uid: string) => void;\r\n\r\n    // --- UI ACTIONS ---\r\n    openAuthModal: (mode?: 'LOGIN' | 'REGISTER', onSuccess?: () => void) => void;\r\n    closeAuthModal: () => void;\r\n}\r\n\r\nexport const useStore = create<SystemState>()(\r\n    persist(\r\n        (set, get) => ({\r\n            // --- INITIAL STATE ---\r\n\r\n            profile: {\r\n                consistencyIndex: 85,\r\n                learningPhase: 'INIT',\r\n                totalSessions: 0,\r\n                currentCapacity: 100,\r\n                lastSessionDate: \"2024-01-01T00:00:00.000Z\"\r\n            },\r\n\r\n            subjects: [],\r\n            lectures: [],\r\n            sessions: [],\r\n            dailyLoad: {\r\n                date: \"2024-01-01\",\r\n                totalCognitiveCost: 0,\r\n                status: 'Safe'\r\n            },\r\n\r\n\r\n            // Initialize from Service (Synchronous part, usually guest)\r\n            authState: { status: 'LOADING', user: null, token: null },\r\n            authModal: { isOpen: false, mode: 'LOGIN', onSuccess: undefined },\r\n            unsubscribeSnapshot: undefined,\r\n\r\n            activeSession: null,\r\n\r\n            // --- ADMIN SLICE INIT ---\r\n            students: [],\r\n            selectedStudent: null,\r\n            isAdminMode: false,\r\n            adminError: null,\r\n\r\n            // --- ADMIN ACTIONS ---\r\n            fetchStudents: async () => {\r\n                const { students, error } = await import('@/core/services/AdminService').then(m => m.AdminService.getAllStudents());\r\n                if (error) {\r\n                    set({ students: [], adminError: error });\r\n                } else {\r\n                    set({ students: students, adminError: null });\r\n                }\r\n            },\r\n\r\n            selectStudent: (student) => set({ selectedStudent: student }),\r\n\r\n            setAdminMode: (isActive) => set({ isAdminMode: isActive }),\r\n\r\n\r\n            // --- ACTIONS ---\r\n\r\n            addSubject: (subject) => set((state) => {\r\n                // FIRESTORE SYNC (Atomic Beacon)\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n\r\n                    // Prepare Snapshot (e.g. update totals or just touch timestamp)\r\n                    const nextSnapshot = {\r\n                        profile: state.profile, // Can update totals here if needed\r\n                        dailyLoad: state.dailyLoad\r\n                    };\r\n\r\n                    FirestoreService.saveSubjectWithSnapshot(user.id, subject.id, subject, nextSnapshot);\r\n                }\r\n\r\n                // Optimistic Update\r\n                return {\r\n                    subjects: [...state.subjects, subject]\r\n                };\r\n            }),\r\n\r\n            renameSubject: (id: string, newName: string) => set((state) => {\r\n                // FIRESTORE SYNC (Atomic Beacon)\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n                    // Prepare Snapshot (Touch timestamp)\r\n                    const nextSnapshot = { profile: state.profile, dailyLoad: state.dailyLoad };\r\n                    FirestoreService.saveSubjectWithSnapshot(user.id, id, { name: newName }, nextSnapshot);\r\n                }\r\n\r\n                return {\r\n                    subjects: state.subjects.map(s =>\r\n                        s.id === id ? { ...s, name: newName } : s\r\n                    )\r\n                };\r\n            }),\r\n\r\n            deleteSubject: (id: string) => set((state) => {\r\n                // FIRESTORE SYNC (Recursive & Atomic)\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n                    // Update Snapshot Stats (Decrease count potentially, or just touch)\r\n                    const nextSnapshot = {\r\n                        profile: state.profile,\r\n                        dailyLoad: state.dailyLoad\r\n                    };\r\n                    FirestoreService.deleteSubjectRecursive(user.id, id, nextSnapshot);\r\n                }\r\n\r\n                return {\r\n                    subjects: state.subjects.filter(s => s.id !== id),\r\n                    lectures: state.lectures.filter(l => l.subjectId !== id),\r\n                    sessions: state.sessions.filter(s => s.subjectId !== id)\r\n                };\r\n            }),\r\n\r\n            updateSubjectConfig: (id, config) => set((state) => ({\r\n                subjects: state.subjects.map(s =>\r\n                    s.id === id ? { ...s, config: { ...s.config, ...config } } : s\r\n                )\r\n            })),\r\n\r\n            updateSubjectMetrics: (id, metrics) => set((state) => ({\r\n                subjects: state.subjects.map(s =>\r\n                    s.id === id ? { ...s, metrics: { ...s.metrics, ...metrics } } : s\r\n                )\r\n            })),\r\n\r\n            addLecture: (lecture) => set((state) => {\r\n                // FIRESTORE SYNC\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n                    FirestoreService.saveLecture(\r\n                        user.id,\r\n                        lecture.subjectId,\r\n                        lecture.id,\r\n                        lecture\r\n                    );\r\n                }\r\n\r\n                return {\r\n                    lectures: [...state.lectures, lecture]\r\n                };\r\n            }),\r\n\r\n            updateLectureStatus: (id, status) => set((state) => ({\r\n                lectures: state.lectures.map(l =>\r\n                    l.id === id ? { ...l, status } : l\r\n                )\r\n            })),\r\n\r\n            updateLectureStability: (id, newStability) => set((state) => ({\r\n                lectures: state.lectures.map(l =>\r\n                    l.id === id ? {\r\n                        ...l,\r\n                        stability: Math.max(0, Math.min(100, newStability)), // Clamp 0-100\r\n                        lastRevision: new Date().toISOString()\r\n                    } : l\r\n                )\r\n            })),\r\n\r\n            registerSession: (session) => set((state) => {\r\n                // 1. Add Session to Log\r\n                const newSessions = [...state.sessions, session];\r\n\r\n                // 2. Calculate New Daily Load\r\n                // NOTE: Logic for \"Is this a new day?\" should trigger resetDailyLoad elsewhere, \r\n                // but here we just accumulate.\r\n                const newCost = state.dailyLoad.totalCognitiveCost + session.cognitiveCost;\r\n\r\n                // 3. Determine Risk Status (Simple check, complex logic in CognitiveLoadEngine)\r\n                // This is a naive safeguard. Real status is set by Engine before passing here.\r\n                let status: DailyLoad['status'] = 'Safe';\r\n                if (newCost > 100) status = 'Risk';\r\n                else if (newCost > 80) status = 'Warning';\r\n\r\n                // FIRESTORE SYNC (Atomic Snapshot Strategy)\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n\r\n                    // Prepare Snapshot State\r\n                    const nextProfile = {\r\n                        ...state.profile,\r\n                        totalSessions: state.profile.totalSessions + 1,\r\n                        learningPhase: (state.profile.totalSessions + 1) >= 3 ? 'ADAPTIVE' :\r\n                            (state.profile.totalSessions + 1) >= 1 ? 'NOVICE' : 'INIT',\r\n                        lastSessionDate: new Date().toISOString()\r\n                    };\r\n\r\n                    const snapshot = {\r\n                        profile: nextProfile,\r\n                        dailyLoad: {\r\n                            totalCognitiveCost: newCost,\r\n                            status\r\n                        },\r\n                    };\r\n\r\n                    // Atomic Write\r\n                    FirestoreService.saveSessionWithSnapshot(\r\n                        user.id,\r\n                        session,\r\n                        snapshot\r\n                    );\r\n                }\r\n\r\n                // Optimistic Local Update (Will be confirmed by Snapshot Listener)\r\n                return {\r\n                    sessions: newSessions,\r\n                    dailyLoad: {\r\n                        ...state.dailyLoad,\r\n                        totalCognitiveCost: newCost,\r\n                        status\r\n                    },\r\n                    profile: {\r\n                        ...state.profile,\r\n                        totalSessions: state.profile.totalSessions + 1,\r\n                        // [CRITICAL LOGIC] Persistent Phase Transition\r\n                        learningPhase: (state.profile.totalSessions + 1) >= 3 ? 'ADAPTIVE' :\r\n                            (state.profile.totalSessions + 1) >= 1 ? 'NOVICE' : 'INIT',\r\n                        lastSessionDate: new Date().toISOString()\r\n                    }\r\n                };\r\n            }),\r\n\r\n            resetDailyLoad: () => set((state) => ({\r\n                dailyLoad: {\r\n                    date: new Date().toISOString().split('T')[0],\r\n                    totalCognitiveCost: 0,\r\n                    status: 'Safe'\r\n                }\r\n            })),\r\n\r\n            updateCapacity: (newCapacity) => set((state) => ({\r\n                profile: {\r\n                    ...state.profile,\r\n                    currentCapacity: newCapacity\r\n                }\r\n            })),\r\n\r\n            setProfile: (profile) => set(() => ({ profile })),\r\n\r\n            // --- REMOTE TERMINATION STATE ---\r\n            terminationState: null as { reason: string; message: string; severity?: 'warning' | 'info' } | null,\r\n\r\n            // --- ACTIVE SESSION ACTIONS ---\r\n            startActiveSession: (lectureId, durationMinutes, subjectId) => set(() => ({\r\n                activeSession: {\r\n                    lectureId,\r\n                    subjectId, // Explicitly stored\r\n                    startTime: Date.now(),\r\n                    originalDuration: durationMinutes,\r\n                    pausedAt: null, // Start running\r\n                    totalPausedTime: 0,\r\n                    isActive: true\r\n                },\r\n                terminationState: null // Reset on start\r\n            })),\r\n\r\n            pauseActiveSession: () => set((state) => {\r\n                if (!state.activeSession || state.activeSession.pausedAt) return {};\r\n                return {\r\n                    activeSession: {\r\n                        ...state.activeSession,\r\n                        pausedAt: Date.now()\r\n                    }\r\n                };\r\n            }),\r\n\r\n            resumeActiveSession: () => set((state) => {\r\n                if (!state.activeSession || !state.activeSession.pausedAt) return {};\r\n                const pauseDuration = Date.now() - state.activeSession.pausedAt;\r\n                return {\r\n                    activeSession: {\r\n                        ...state.activeSession,\r\n                        pausedAt: null,\r\n                        totalPausedTime: state.activeSession.totalPausedTime + pauseDuration\r\n                    }\r\n                };\r\n            }),\r\n\r\n            endActiveSession: (penalty = false, isRemoteKill = false, terminationPayload) => set((state) => {\r\n                console.log(\"[STORE] endActiveSession triggered.\", { active: !!state.activeSession, penalty, isRemoteKill, hasPayload: !!terminationPayload });\r\n\r\n                // REMOTE KILL: Immediate Reset (Server has already handled data)\r\n                if (isRemoteKill) {\r\n                    return {\r\n                        activeSession: null,\r\n                        terminationState: terminationPayload || null\r\n                    };\r\n                }\r\n\r\n                if (!state.activeSession) return {};\r\n\r\n                const now = Date.now();\r\n                // 1. Calculate net duration\r\n                let netDuration = now - state.activeSession.startTime;\r\n                if (state.activeSession.pausedAt) {\r\n                    netDuration -= (now - state.activeSession.pausedAt);\r\n                }\r\n                netDuration -= state.activeSession.totalPausedTime;\r\n                const actualMinutes = Math.max(1, Math.round(netDuration / 60000));\r\n\r\n                // 2. Fetch Context (Lecture/Subject)\r\n                const lecture = state.lectures.find(l => l.id === state.activeSession?.lectureId);\r\n                if (!lecture) {\r\n                    console.error(\"CRITICAL: Lecture not found for active session.\");\r\n                    return { activeSession: null };\r\n                }\r\n\r\n                // 3. EXECUTE COGNITIVE ENGINE (The wiring)\r\n                let metrics = CognitiveEngine.calculate({\r\n                    lectureDuration: lecture.duration,\r\n                    actualDuration: actualMinutes,\r\n                    relativeDifficulty: lecture.relativeDifficulty,\r\n                    studentIndex: lecture.cognitiveIndex || null\r\n                });\r\n\r\n                // PENALTY OVERRIDE (Forced Close)\r\n                if (penalty) {\r\n                    metrics = {\r\n                        ...metrics,\r\n                        performanceGrade: 'C', // \"Least Grade C\"\r\n                        performanceIndex: 0,   // \"Failure\"\r\n                        cognitiveLoadIndex: 100 // \"Maximum Penalty\"\r\n                    };\r\n                }\r\n\r\n                console.log(\"[STORE] Cognitive Metrics Calculated:\", metrics);\r\n\r\n                // 4. Construct Final Session Record\r\n                const newSession: StudySession = {\r\n                    id: crypto.randomUUID(),\r\n                    lectureId: lecture.id,\r\n                    parentId: lecture.id,\r\n                    subjectId: lecture.subjectId,\r\n                    date: new Date().toISOString(),\r\n                    startTime: state.activeSession.startTime,\r\n                    endTime: now,\r\n                    status: penalty ? 'INTERRUPTED' : (actualMinutes < 5 ? 'INTERRUPTED' : 'COMPLETED'),\r\n\r\n                    // PERSISTED METRICS\r\n                    expectedDuration: metrics.expectedStudyTimeMinutes,\r\n                    actualDuration: actualMinutes,\r\n                    cognitiveCost: metrics.cognitiveLoadIndex,\r\n                    performanceIndex: metrics.performanceIndex,\r\n                    focusPerformance: penalty ? 0 : 100,\r\n                };\r\n\r\n                // 5. UPDATE LECTURE STATE (Persistence of Result)\r\n                const updatedLectures = state.lectures.map(l => {\r\n                    if (l.id === lecture.id) {\r\n                        return {\r\n                            ...l,\r\n                            status: 'Mastered',\r\n                            cognitiveIndex: metrics.performanceIndex,\r\n                            grade: metrics.performanceGrade,\r\n                            lastRevision: new Date().toISOString(),\r\n                            stability: Math.min(100, l.stability + 10)\r\n                        } as Lecture;\r\n                    }\r\n                    return l;\r\n                });\r\n\r\n                // 6. FIRESTORE SYNC (The Missing Piece)\r\n                const user = state.authState.user;\r\n                if (state.authState.status === 'AUTHENTICATED' && user) {\r\n                    // Prepare Snapshot\r\n                    const nextProfile = {\r\n                        ...state.profile,\r\n                        totalSessions: state.profile.totalSessions + 1,\r\n                        learningPhase: (state.profile.totalSessions + 1) >= 3 ? 'ADAPTIVE' :\r\n                            (state.profile.totalSessions + 1) >= 1 ? 'NOVICE' : 'INIT',\r\n                        lastSessionDate: new Date().toISOString()\r\n                    };\r\n\r\n                    const nextDailyLoad = {\r\n                        ...state.dailyLoad,\r\n                        totalCognitiveCost: state.dailyLoad.totalCognitiveCost + metrics.cognitiveLoadIndex,\r\n                        // Recalculate status simply here or rely on registerSession logic? \r\n                        // For now, simple accumulation. Real guard logic is elsewhere.\r\n                    };\r\n\r\n                    const snapshot = {\r\n                        profile: nextProfile,\r\n                        dailyLoad: nextDailyLoad\r\n                    };\r\n\r\n                    console.log(\"[STORE] Persisting Ended Session to Firestore...\", newSession.id);\r\n                    FirestoreService.saveSessionWithSnapshot(\r\n                        user.id,\r\n                        newSession,\r\n                        snapshot\r\n                    );\r\n                }\r\n\r\n                console.log(\"[STORE] Session Persisted Locally & Cloud.\");\r\n\r\n                return {\r\n                    sessions: [...state.sessions, newSession],\r\n                    lectures: updatedLectures,\r\n                    activeSession: null,\r\n                    dailyLoad: {\r\n                        ...state.dailyLoad,\r\n                        totalCognitiveCost: state.dailyLoad.totalCognitiveCost + metrics.cognitiveLoadIndex\r\n                    },\r\n                    profile: {\r\n                        ...state.profile,\r\n                        totalSessions: state.profile.totalSessions + 1,\r\n                        learningPhase: (state.profile.totalSessions + 1) >= 3 ? 'ADAPTIVE' :\r\n                            (state.profile.totalSessions + 1) >= 1 ? 'NOVICE' : 'INIT',\r\n                        lastSessionDate: new Date().toISOString()\r\n                    }\r\n                };\r\n            }),\r\n\r\n            deleteLecture: (lectureId) => set((state) => ({\r\n                lectures: state.lectures.filter(l => l.id !== lectureId),\r\n                sessions: state.sessions.filter(s => s.lectureId !== lectureId)\r\n            })),\r\n\r\n            clearActiveSession: () => set(() => ({ activeSession: null })),\r\n\r\n\r\n\r\n            // --- AUTH IMPLEMENTATION ---\r\n            login: async (email, pass) => {\r\n                try {\r\n                    const result = await AuthService.login(email, pass);\r\n                    set({ authState: result });\r\n                    return true;\r\n                } catch (e) {\r\n                    console.error(\"Login Failed\", e);\r\n                    return false;\r\n                }\r\n            },\r\n\r\n            loginWithGoogle: async () => {\r\n                try {\r\n                    const result = await AuthService.loginWithGoogle();\r\n                    set({ authState: result });\r\n\r\n                    // FIRESTORE SYNC: Load User Data\r\n                    if (result.status === 'AUTHENTICATED' && result.user) {\r\n                        const userData = await FirestoreService.loadUserData(result.user.id);\r\n                        if (userData) {\r\n                            set((state) => {\r\n                                // CRITICAL FIX: Merge persisted identity (completed flag) into AuthState\r\n                                const updatedUser = state.authState.user && userData.identityProfile\r\n                                    ? { ...state.authState.user, ...userData.identityProfile }\r\n                                    : state.authState.user;\r\n\r\n                                // A) SIGN-UP / FIRST LOGIN LOGIC (Robust Merge)\r\n                                if (result.user) {\r\n                                    const currentUser = result.user;\r\n                                    const existing = userData.identityProfile || {};\r\n\r\n                                    // QUOTA GUARD: THROTTLE LOGIN WRITES (1 Hour)\r\n                                    const lastLogin = existing.lastLoginAt ? new Date(existing.lastLoginAt).getTime() : 0;\r\n                                    const shouldWrite = (Date.now() - lastLogin) > 3600000;\r\n\r\n                                    if (shouldWrite) {\r\n                                        // Base Payload: Always ensure Email is current\r\n                                        const payload: any = {\r\n                                            email: currentUser.email,\r\n                                            lastActive: new Date().toISOString(),\r\n                                            lastLoginAt: new Date().toISOString(),\r\n                                            lastLoginDevice: navigator.userAgent,\r\n                                            lastLoginIP: 'Unknown'\r\n                                        };\r\n\r\n                                        // Conditional Defaults: Only set if missing (NO OVERWRITE)\r\n                                        if (!existing.role) payload.role = 'STUDENT';\r\n                                        if (!existing.createdAt) payload.createdAt = new Date().toISOString();\r\n                                        if (existing.completed === undefined) payload.completed = false;\r\n\r\n                                        console.log(\"[Store] Persisting/Merging User Profile (Throttled):\", payload);\r\n                                        FirestoreService.saveUserProfile(currentUser.id, payload);\r\n                                    } else {\r\n                                        console.log(\"[Store] Login Write Skipped (Throttled 1h)\");\r\n                                    }\r\n\r\n                                    // Reflect in Local State immediately (for UI consistency)\r\n                                    if (state.authState.user) {\r\n                                        // Object.assign(state.authState.user, payload); // Don't blindly assign if we didn't generate payload components\r\n                                    }\r\n                                }\r\n\r\n                                const isLocalFresh = state.subjects.length === 0 && state.sessions.length === 0;\r\n                                console.log(\"[Store] Merging Firestore Data. Local Fresh:\", isLocalFresh);\r\n\r\n                                // Update AuthState immediately to pass RootGate\r\n                                if (updatedUser !== state.authState.user) {\r\n                                    state.authState.user = updatedUser; // Direct mutation ok inside set, or use spread below\r\n                                }\r\n\r\n                                if (!isLocalFresh && !userData.subjects.length) {\r\n                                    return { authState: { ...state.authState, user: updatedUser } };\r\n                                }\r\n\r\n                                // SNAPSHOT HYDRATION STRATEGY\r\n                                if (userData.stateSnapshot) {\r\n                                    console.log(\"[Store] Hydrating from Snapshot (User Truth)\");\r\n                                    return {\r\n                                        authState: { ...state.authState, user: updatedUser }, // Ensure AuthState is updated\r\n                                        profile: { ...state.profile, ...userData.stateSnapshot.profile },\r\n                                        dailyLoad: { ...state.dailyLoad, ...userData.stateSnapshot.dailyLoad },\r\n                                        subjects: userData.subjects.length > 0 ? userData.subjects : state.subjects,\r\n                                        lectures: userData.lectures.length > 0 ? userData.lectures : state.lectures,\r\n                                        sessions: userData.sessions.length > 0 ? userData.sessions : state.sessions\r\n                                    };\r\n                                }\r\n\r\n                                // FALLBACK: No Snapshot -> Recompute & Heal\r\n                                console.warn(\"[Store] No Snapshot found. Recomputing from raw data...\");\r\n                                const calculatedSessions = userData.sessions.length || state.profile.totalSessions;\r\n                                // Simple recompute logic (expand as needed)\r\n                                const healedProfile = {\r\n                                    ...state.profile,\r\n                                    totalSessions: calculatedSessions,\r\n                                    learningPhase: calculatedSessions >= 3 ? 'ADAPTIVE' : calculatedSessions >= 1 ? 'NOVICE' : 'INIT',\r\n                                };\r\n\r\n                                // Initiate Healing Save (Async, don't await)\r\n                                if (result.user) {\r\n                                    FirestoreService.saveStateSnapshot(result.user.id, {\r\n                                        profile: healedProfile,\r\n                                        dailyLoad: state.dailyLoad // Keep current load or 0 if fresh\r\n                                    });\r\n                                }\r\n\r\n                                return {\r\n                                    authState: { ...state.authState, user: updatedUser },\r\n                                    profile: healedProfile,\r\n                                    subjects: userData.subjects.length > 0 ? userData.subjects : state.subjects,\r\n                                    lectures: userData.lectures.length > 0 ? userData.lectures : state.lectures,\r\n                                    sessions: userData.sessions.length > 0 ? userData.sessions : state.sessions\r\n                                } as any;\r\n                            });\r\n                            console.log(\"[Store] Hydrated from Firestore\", userData);\r\n                        }\r\n                    }\r\n\r\n                    return { success: true };\r\n                } catch (e: any) {\r\n                    console.error(\"Google Login Failed\", e);\r\n                    return { success: false, error: e.message || \"Unknown error\" };\r\n                }\r\n            },\r\n\r\n            register: async (identity, profile) => {\r\n                try {\r\n                    const result = await AuthService.register(identity, profile);\r\n                    set({ authState: result });\r\n                    return true;\r\n                } catch (e) {\r\n                    console.error(\"Register Failed\", e);\r\n                    return false;\r\n                }\r\n            },\r\n\r\n            logout: async () => {\r\n                await AuthService.logout();\r\n                set({ authState: { status: 'GUEST', user: null, token: null } });\r\n            },\r\n\r\n            syncAuth: () => {\r\n                const unsubscribe = AuthService.initCallback((result) => {\r\n                    set((state) => {\r\n                        // Cleanup listener on logout\r\n                        if (result.status !== 'AUTHENTICATED' && state.unsubscribeSnapshot) {\r\n                            console.log(\"[Store] Cleaning up snapshot listener\");\r\n                            state.unsubscribeSnapshot();\r\n                            return { authState: result, unsubscribeSnapshot: undefined };\r\n                        }\r\n\r\n                        // [CRITICAL FIX] MERGE LOGIC\r\n                        // If we are authenticated and the UID matches our hydrated local state,\r\n                        // we MUST preserve the local profile data (completed, academicYear, etc.)\r\n                        // because raw Firebase Auth result doesn't have them.\r\n                        if (result.status === 'AUTHENTICATED' && result.user && state.authState.user?.id === result.user.id) {\r\n\r\n                            // Merge Strategy: Take fresh Auth data (token, email) + Overlay Local Profile Data\r\n                            const mergedUser = {\r\n                                ...result.user, // Fresh Identity\r\n                                ...state.authState.user, // Persisted Profile (wins for custom fields)\r\n                                // Explicitly re-apply fresh identity criticals if needed, \r\n                                // but usually local state has the correct data from previous session.\r\n                                // To be safe, we ensure 'completed' is strictly preserved if true.\r\n                                completed: state.authState.user.completed === true ? true : result.user.completed\r\n                            };\r\n\r\n                            console.log(\"[Store] syncAuth: Preserved Local Profile\", {\r\n                                wasCompleted: state.authState.user.completed,\r\n                                nowCompleted: mergedUser.completed\r\n                            });\r\n\r\n                            return { authState: { ...result, user: mergedUser } };\r\n                        }\r\n\r\n                        return { authState: result };\r\n                    });\r\n                });\r\n                // Note: We don't store the auth unsubscribe here as it's global.\r\n            },\r\n\r\n            initializeRealtimeSync: (uid) => {\r\n                set((state) => {\r\n                    // Cleanup existing\r\n                    if (state.unsubscribeSnapshot) {\r\n                        state.unsubscribeSnapshot();\r\n                    }\r\n\r\n                    console.log(\"[Store] Initializing Real-Time Sync for:\", uid);\r\n\r\n                    // A. FIRESTORE LISTENER (Metrics Beacon)\r\n                    const unsubscribeFirestore = FirestoreService.subscribeToSnapshot(uid, async (snapshot: any) => {\r\n                        console.log(\"[Store]  Snapshot Beacon Received (Metrics Update)\");\r\n                        set((currentState) => ({\r\n                            profile: { ...currentState.profile, ...snapshot.profile },\r\n                            dailyLoad: { ...currentState.dailyLoad, ...snapshot.dailyLoad }\r\n                        }));\r\n                    });\r\n\r\n                    // B. RTDB LISTENER (Session Kill Switch & Connection)\r\n                    let unsubscribeRTDB = () => { };\r\n                    const db = getDatabaseInstance();\r\n                    if (db) {\r\n                        const sessionRef = ref(db, `status/${uid}/activeSession`);\r\n                        const cleanRTDB = onValue(sessionRef, (snapshot) => {\r\n                            const remoteSession = snapshot.val();\r\n                            const currentStore = get();\r\n\r\n                            // KILL SWITCH LOGIC\r\n                            // IF Local thinks we are active (activeSession != null)\r\n                            // AND Remote says we are inactive (remoteSession == null)\r\n                            // THEN Force End Local Session.\r\n                            // KILL SWITCH LOGIC\r\n                            // IF Local thinks we are active (activeSession != null)\r\n                            // AND Remote says we are inactive (remoteSession == null)\r\n                            // THEN Force End Local Session.\r\n                            if (currentStore.activeSession && !remoteSession) {\r\n                                console.warn(\"[Store]  REMOTE KILL SWITCH TRIGGERED: Session Force Ended by Server/Admin.\");\r\n\r\n                                // 1. Terminate Local Session State (Silent Reset)\r\n                                // Pass 'true' for isRemoteKill to SKIP writes and metrics\r\n                                currentStore.endActiveSession(false, true);\r\n\r\n                                // 2. Hard Clear just in case\r\n                                set({ activeSession: null });\r\n                            }\r\n                        });\r\n                        unsubscribeRTDB = () => cleanRTDB();\r\n                    }\r\n\r\n                    // Combined Cleanup\r\n                    const cleanup = () => {\r\n                        unsubscribeFirestore();\r\n                        unsubscribeRTDB();\r\n                    };\r\n\r\n                    return { unsubscribeSnapshot: cleanup };\r\n                });\r\n            },\r\n\r\n            openAuthModal: (mode = 'LOGIN', onSuccess) => set({ authModal: { isOpen: true, mode, onSuccess } }),\r\n            closeAuthModal: () => set((state) => ({ authModal: { ...state.authModal, isOpen: false, onSuccess: undefined } }))\r\n        }),\r\n        {\r\n            name: 'academic-system-storage', // Key in localStorage\r\n            storage: createJSONStorage(() => localStorage), // Persist to browser\r\n            partialize: (state) => ({\r\n                // Omit authModal.onSuccess which is not serializable\r\n                ...state,\r\n                authModal: { ...state.authModal, onSuccess: undefined }\r\n            })\r\n        }\r\n    )\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1486, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/config/admin.ts"],"sourcesContent":["/**\r\n * Admin Configuration\r\n * \r\n * Defines the list of Google UIDs that are granted Admin privileges.\r\n * This should be secured via Firestore Security Rules in a production app.\r\n * For this MVP/Demo, a client-side whitelist is sufficient for UI gating.\r\n */\r\n\r\nexport const ADMIN_UIDS = [\r\n    // Add your Google UID here to facilitate testing\r\n    '7DDyPlo4C8W9e3FjYqLwZ4xJ8u53', // Example UID (Replace with real one)\r\n    'REPLACE_WITH_YOUR_ACTUAL_UID'  // Placeholder\r\n];\r\n\r\nexport const isAdmin = (uid: string): boolean => {\r\n    return ADMIN_UIDS.includes(uid);\r\n};\r\n\r\nexport const ACADEMIC_YEARS = [\r\n    \"Year 1\",\r\n    \"Year 2\",\r\n    \"Year 3\",\r\n    \"Year 4\",\r\n    \"Year 5\"\r\n] as const;\r\n\r\nexport type AcademicYear = typeof ACADEMIC_YEARS[number];\r\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;;;;;AAEM,MAAM,aAAa;IACtB,iDAAiD;IACjD;IACA,+BAAgC,cAAc;CACjD;AAEM,MAAM,UAAU,CAAC;IACpB,OAAO,WAAW,QAAQ,CAAC;AAC/B;AAEO,MAAM,iBAAiB;IAC1B;IACA;IACA;IACA;IACA;CACH"}},
    {"offset": {"line": 1519, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/profile/CompleteProfileView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useStore } from '@/store/useStore';\r\nimport { FirestoreService } from '@/core/services/FirestoreService';\r\nimport { ACADEMIC_YEARS } from '@/config/admin';\r\nimport { User, BookOpen, Check, ChevronDown, GraduationCap } from 'lucide-react';\r\n\r\nexport default function CompleteProfileView() {\r\n    const { authState } = useStore();\r\n\r\n    const [fullName, setFullName] = useState('');\r\n    const [academicYear, setAcademicYear] = useState(ACADEMIC_YEARS[0]);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    // SAFETY GUARD: Show if not completed OR if fullName is missing (Migration Case)\r\n    // Only hide if BOTH completed=true AND fullName exists.\r\n    if (authState.user?.completed && authState.user?.fullName) {\r\n        return null;\r\n    }\r\n    const [language, setLanguage] = useState<'en' | 'ar'>('en');\r\n    const [nameStatus, setNameStatus] = useState<'IDLE' | 'VALID' | 'INVALID'>('IDLE');\r\n    const [errorMessage, setErrorMessage] = useState('');\r\n\r\n    const validateName = (name: string) => {\r\n        const trimmed = name.trim();\r\n        const parts = trimmed.split(/\\s+/);\r\n        const isValid = parts.length >= 3;\r\n        const hasInvalidChars = /[0-9!@#$%^&*()_+={}\\[\\]|\\\\:;\"'<>,.?/~`]/.test(trimmed);\r\n        if (hasInvalidChars) return { valid: false };\r\n        return { valid: isValid };\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (!fullName) {\r\n            setNameStatus('IDLE');\r\n            return;\r\n        }\r\n        const check = validateName(fullName);\r\n        if (check.valid) {\r\n            setNameStatus('VALID');\r\n        } else {\r\n            if (fullName.length > 5) setNameStatus('INVALID');\r\n            else setNameStatus('IDLE');\r\n        }\r\n    }, [fullName]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        const check = validateName(fullName);\r\n        if (!check.valid) {\r\n            setNameStatus('INVALID');\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            if (!authState.user?.id) throw new Error(\"No User ID\");\r\n\r\n            // Dynamic Import for Sentinel to avoid SSR issues if any, or just strictly Client side\r\n            const { serverTimestamp } = await import('firebase/firestore');\r\n\r\n            const updates = {\r\n                fullName: fullName.trim(),\r\n                academicYear,\r\n                completed: true,\r\n                completedAt: serverTimestamp(),\r\n                updatedAt: serverTimestamp() // Consistency\r\n            };\r\n\r\n            await FirestoreService.saveUserProfile(authState.user.id, updates);\r\n\r\n            const currentUser = authState.user;\r\n            if (currentUser) {\r\n                useStore.setState(state => ({\r\n                    authState: {\r\n                        ...state.authState,\r\n                        status: 'AUTHENTICATED',\r\n                        user: { ...currentUser, ...updates }\r\n                    }\r\n                }));\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            setErrorMessage(language === 'en' ? \"Connection Error\" : \"  \");\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const t = {\r\n        title: language === 'en' ? \"Academic Profile\" : \" \",\r\n        subtitle: language === 'en' ? \"Contextual calibration\" : \" \",\r\n        welcome: language === 'en' ? \"Welcome, Doctor\" : \"   \",\r\n        nameLabel: language === 'en' ? \"Full Name\" : \" \",\r\n        namePlaceholder: language === 'en' ? \"Mohamed Ahmed Mahmoud\" : \"  \",\r\n        yearLabel: language === 'en' ? \"Current Academic Year\" : \"  \",\r\n        yearHelper: language === 'en' ? \"You can change this later from your profile settings.\" : \"     .\",\r\n        button: language === 'en' ? \"Initialize System\" : \" \",\r\n    };\r\n\r\n    const isRtl = language === 'ar';\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[999999] bg-[#020617] flex items-center justify-center font-sans overflow-hidden\">\r\n\r\n            <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\r\n                <div className=\"absolute top-[-20%] left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] bg-indigo-600/20 rounded-full blur-[120px]\" />\r\n                <div className=\"absolute bottom-[-10%] right-[-10%] w-[800px] h-[800px] bg-violet-900/10 rounded-full blur-[100px]\" />\r\n                <div className=\"absolute inset-0 opacity-[0.03]\"\r\n                    style={{ backgroundImage: `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E\")` }}\r\n                />\r\n            </div>\r\n\r\n            <div className=\"relative w-full max-w-[480px] mx-4 bg-slate-900/40 backdrop-blur-2xl border border-white/10 rounded-3xl shadow-2xl p-8 flex flex-col items-center overflow-hidden\">\r\n\r\n                <div className=\"absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-white/30 to-transparent\" />\r\n\r\n                <div className=\"absolute top-6 right-6 flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition-colors z-10\">\r\n                    <button onClick={() => setLanguage('en')} className={`text-[11px] font-bold tracking-wider ${!isRtl ? 'text-white' : 'text-slate-500'}`}>EN</button>\r\n                    <div className=\"w-[1px] h-3 bg-white/20\" />\r\n                    <button onClick={() => setLanguage('ar')} className={`text-[11px] font-bold tracking-wider ${isRtl ? 'text-white' : 'text-slate-500'}`}>AR</button>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col items-center w-full mb-8 mt-2 text-center\">\r\n                    <h1 className=\"text-2xl font-semibold text-white tracking-tight mb-1 drop-shadow-lg\">\r\n                        {t.title}\r\n                    </h1>\r\n                    <p className=\"text-[11px] uppercase tracking-[0.2em] text-indigo-200/70 font-medium\">\r\n                        {t.subtitle}\r\n                    </p>\r\n\r\n                    <div className=\"flex items-center gap-4 w-full justify-center my-6 opacity-60\">\r\n                        <div className=\"h-[1px] w-16 bg-gradient-to-r from-transparent via-indigo-400 to-transparent\" />\r\n                        <GraduationCap className=\"w-5 h-5 text-indigo-300\" strokeWidth={1.5} />\r\n                        <div className=\"h-[1px] w-16 bg-gradient-to-r from-transparent via-indigo-400 to-transparent\" />\r\n                    </div>\r\n\r\n                    <h2 className=\"text-[15px] font-medium text-slate-200\">\r\n                        {t.welcome}\r\n                    </h2>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"w-full flex flex-col gap-6\" dir={isRtl ? 'rtl' : 'ltr'}>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-[13px] font-medium text-slate-300 ml-1\">\r\n                            {t.nameLabel}\r\n                        </label>\r\n                        <div className=\"relative group\">\r\n                            <div className={`absolute top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none transition-colors group-focus-within:text-indigo-400 ${isRtl ? 'right-4' : 'left-4'}`}>\r\n                                <User className=\"w-4 h-4\" />\r\n                            </div>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={fullName}\r\n                                onChange={(e) => setFullName(e.target.value)}\r\n                                placeholder={t.namePlaceholder}\r\n                                className={`w-full py-3.5 bg-[#0B1120]/60 border text-sm text-white placeholder:text-slate-600 rounded-xl focus:outline-none focus:bg-[#0B1120]/90 focus:border-indigo-500/80 transition-all shadow-inner ${isRtl ? 'pr-11 pl-4' : 'pl-11 pr-11'} ${nameStatus === 'VALID' ? 'border-emerald-500/50 shadow-emerald-500/10' : 'border-white/10 hover:border-white/20'}`}\r\n                            />\r\n                            {nameStatus === 'VALID' && (\r\n                                <div className={`absolute top-1/2 -translate-y-1/2 text-emerald-400 pointer-events-none animate-in fade-in zoom-in duration-300 ${isRtl ? 'left-4' : 'right-4'}`}>\r\n                                    <Check className=\"w-4 h-4\" strokeWidth={3} />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-[13px] font-medium text-slate-300 ml-1\">\r\n                            {t.yearLabel}\r\n                        </label>\r\n                        <div className=\"relative group\">\r\n                            <div className={`absolute top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none transition-colors group-focus-within:text-indigo-400 ${isRtl ? 'right-4' : 'left-4'}`}>\r\n                                <BookOpen className=\"w-4 h-4\" />\r\n                            </div>\r\n                            <select\r\n                                value={academicYear}\r\n                                onChange={(e) => setAcademicYear(e.target.value as any)}\r\n                                className={`w-full py-3.5 bg-[#0B1120]/60 border border-white/10 hover:border-white/20 text-sm text-white rounded-xl focus:outline-none focus:bg-[#0B1120]/90 focus:border-indigo-500/80 appearance-none cursor-pointer transition-all shadow-inner ${isRtl ? 'pr-11 pl-11' : 'pl-11 pr-11'}`}\r\n                            >\r\n                                {ACADEMIC_YEARS.map(year => (\r\n                                    <option key={year} value={year} className=\"bg-slate-900 text-white\">{year}</option>\r\n                                ))}\r\n                            </select>\r\n                            <div className={`absolute top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none ${isRtl ? 'left-4' : 'right-4'}`}>\r\n                                <ChevronDown className=\"w-4 h-4\" />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-[11px] text-slate-500 pl-1\">\r\n                            {t.yearHelper}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isSubmitting || nameStatus !== 'VALID'}\r\n                        className={`mt-2 w-full py-4 rounded-xl text-sm font-semibold tracking-wide transition-all duration-300 shadow-lg ${isSubmitting || nameStatus !== 'VALID'\r\n                            ? 'bg-white/5 text-slate-500 cursor-not-allowed border border-white/5'\r\n                            : 'bg-gradient-to-r from-indigo-600 to-violet-600 text-white shadow-indigo-500/40 hover:shadow-indigo-500/60 hover:scale-[1.01] border border-white/10'\r\n                            }`}\r\n                    >\r\n                        {isSubmitting ? (\r\n                            <span className=\"flex items-center justify-center gap-2\">\r\n                                <span className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                Initializing...\r\n                            </span>\r\n                        ) : t.button}\r\n                    </button>\r\n\r\n                    {errorMessage && <p className=\"text-center text-rose-400 text-xs mt-2 animate-pulse\">{errorMessage}</p>}\r\n                </form>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1982, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/FlowEngine.ts"],"sourcesContent":["import { StudySession } from '../types';\r\n\r\nexport type FlowState =\r\n    | 'AUTH_CHECK'\r\n    | 'AUTH_LOGIN'\r\n    | 'ORIENTATION' // New\r\n    | 'SUBJECT_LIST' // New Home\r\n    | 'DASHBOARD_HOME' // New: Main Dashboard\r\n    | 'DASHBOARD_SUBJECT' // New: Detail View\r\n    | 'DASHBOARD_SETTINGS' // New: Settings View\r\n    | 'DASHBOARD_HISTORY' // New: History View\r\n    | 'DASHBOARD_INPUTS' // New: Academic Inputs Control Panel\r\n    | 'DASHBOARD_CONFIG' // New: Global System Configuration\r\n    | 'SUBJECT_ADD_NAME'\r\n    | 'SUBJECT_SETUP_DATE'\r\n    | 'INTENT' // Renamed logic to Subject Detail? Or kept for specific subject intent\r\n    | 'INTENT_ACTION'\r\n    | 'REG_TYPE'\r\n    | 'REG_DURATION'\r\n    | 'REG_UNDERSTANDING'\r\n    | 'REG_DEMAND'\r\n    | 'CALIBRATION_FAMILIARITY'\r\n    | 'CALIBRATION_FOCUS'\r\n    | 'CALIBRATION_TIME'\r\n    | 'STUDY_EXECUTION'\r\n    | 'REFLECTION_CHECK'\r\n    | 'REFLECTION_REASON'\r\n    | 'SUMMARY';\r\n\r\nexport interface FlowContext {\r\n    currentState: FlowState;\r\n    selectedSubjectId?: string;\r\n    activeLectureId?: string; // Explicitly track lecture being studied\r\n    actionType?: 'STUDY' | 'REGISTER';\r\n    tempCalibration: {\r\n        familiarity: number;\r\n        focus: number; // 0-100\r\n        time: number;\r\n    };\r\n    tempRegistration?: {\r\n        type: string;\r\n        duration: number; // minutes\r\n        understanding: number;\r\n        demand: string;\r\n    };\r\n    currentSessionId?: string;\r\n    feedbackMessage?: string;\r\n    predictedDuration?: number; // Added for Session Start Context\r\n}\r\n\r\nexport const FlowEngine = {\r\n    getInitialState: (): FlowContext => ({\r\n        currentState: 'SUBJECT_LIST',\r\n        selectedSubjectId: undefined,\r\n        tempCalibration: {\r\n            familiarity: 50,\r\n            focus: 50,\r\n            time: 25\r\n        },\r\n        tempRegistration: {\r\n            type: 'Theory',\r\n            duration: 60,\r\n            understanding: 50,\r\n            demand: 'Moderate'\r\n        }\r\n    }),\r\n\r\n    /**\r\n     * Determines the next state based on the current state and user input.\r\n     */\r\n    nextState: (current: FlowState, input: any): FlowState => {\r\n        switch (current) {\r\n            case 'ORIENTATION':\r\n                return 'SUBJECT_LIST';\r\n\r\n\r\n            case 'SUBJECT_LIST':\r\n                if (input === 'ADD_SUBJECT') return 'SUBJECT_ADD_NAME';\r\n                // Else input is subject ID\r\n                return 'INTENT_ACTION'; // \"What are you planning?\" for selected subject\r\n\r\n            case 'SUBJECT_ADD_NAME':\r\n                return 'SUBJECT_LIST'; // Skip Exam Date Question\r\n\r\n            case 'SUBJECT_SETUP_DATE':\r\n                return 'SUBJECT_LIST'; // Done adding\r\n\r\n            case 'INTENT':\r\n                return 'INTENT_ACTION';\r\n\r\n            case 'INTENT_ACTION':\r\n                if (input === 'ACTION_REGISTER') return 'REG_TYPE';\r\n                return 'CALIBRATION_FAMILIARITY';\r\n\r\n            // --- REGISTRATION FLOW ---\r\n            case 'REG_TYPE': return 'REG_DURATION';\r\n            case 'REG_DURATION': return 'REG_UNDERSTANDING';\r\n            case 'REG_UNDERSTANDING': return 'SUMMARY'; // Skipped REG_DEMAND\r\n            case 'REG_DEMAND': return 'SUMMARY';\r\n\r\n            // --- STUDY FLOW ---\r\n            case 'CALIBRATION_FAMILIARITY': return 'CALIBRATION_FOCUS';\r\n            case 'CALIBRATION_FOCUS': return 'CALIBRATION_TIME';\r\n            case 'CALIBRATION_TIME': return 'STUDY_EXECUTION';\r\n            case 'STUDY_EXECUTION': return 'REFLECTION_CHECK';\r\n            case 'REFLECTION_CHECK': if (input === false) return 'REFLECTION_REASON'; return 'SUMMARY';\r\n            case 'REFLECTION_REASON': return 'SUMMARY';\r\n\r\n            case 'SUMMARY': return 'SUBJECT_LIST'; // Back to list\r\n\r\n            default: return 'SUBJECT_LIST';\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the Translation Key for the current state.\r\n     */\r\n    getQuestionKey: (state: FlowState): string => {\r\n        switch (state) {\r\n            case 'SUBJECT_LIST': return 'subject_list_empty'; // Or special handling\r\n            case 'SUBJECT_ADD_NAME': return 'subject_name';\r\n            case 'SUBJECT_SETUP_DATE': return 'exam_date';\r\n\r\n            case 'INTENT': return 'intent';\r\n            case 'INTENT_ACTION': return 'action_required';\r\n\r\n            case 'REG_TYPE': return 'type_q';\r\n            case 'REG_DURATION': return 'duration_q';\r\n            case 'REG_UNDERSTANDING': return 'understanding_q';\r\n            case 'REG_DEMAND': return 'demand_q';\r\n\r\n            case 'CALIBRATION_FAMILIARITY': return 'fam_q';\r\n            case 'CALIBRATION_FOCUS': return 'focus_q';\r\n            case 'CALIBRATION_TIME': return 'time_q';\r\n\r\n            case 'STUDY_EXECUTION': return 'session_active';\r\n            case 'REFLECTION_CHECK': return 'reflection_q';\r\n            case 'REFLECTION_REASON': return 'reason_q';\r\n            case 'SUMMARY': return 'cycle_complete';\r\n            default: return '...';\r\n        }\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAkDO,MAAM,aAAa;IACtB,iBAAiB,IAAmB,CAAC;YACjC,cAAc;YACd,mBAAmB;YACnB,iBAAiB;gBACb,aAAa;gBACb,OAAO;gBACP,MAAM;YACV;YACA,kBAAkB;gBACd,MAAM;gBACN,UAAU;gBACV,eAAe;gBACf,QAAQ;YACZ;QACJ,CAAC;IAED;;KAEC,GACD,WAAW,CAAC,SAAoB;QAC5B,OAAQ;YACJ,KAAK;gBACD,OAAO;YAGX,KAAK;gBACD,IAAI,UAAU,eAAe,OAAO;gBACpC,2BAA2B;gBAC3B,OAAO,iBAAiB,gDAAgD;YAE5E,KAAK;gBACD,OAAO,gBAAgB,0BAA0B;YAErD,KAAK;gBACD,OAAO,gBAAgB,cAAc;YAEzC,KAAK;gBACD,OAAO;YAEX,KAAK;gBACD,IAAI,UAAU,mBAAmB,OAAO;gBACxC,OAAO;YAEX,4BAA4B;YAC5B,KAAK;gBAAY,OAAO;YACxB,KAAK;gBAAgB,OAAO;YAC5B,KAAK;gBAAqB,OAAO,WAAW,qBAAqB;YACjE,KAAK;gBAAc,OAAO;YAE1B,qBAAqB;YACrB,KAAK;gBAA2B,OAAO;YACvC,KAAK;gBAAqB,OAAO;YACjC,KAAK;gBAAoB,OAAO;YAChC,KAAK;gBAAmB,OAAO;YAC/B,KAAK;gBAAoB,IAAI,UAAU,OAAO,OAAO;gBAAqB,OAAO;YACjF,KAAK;gBAAqB,OAAO;YAEjC,KAAK;gBAAW,OAAO,gBAAgB,eAAe;YAEtD;gBAAS,OAAO;QACpB;IACJ;IAEA;;KAEC,GACD,gBAAgB,CAAC;QACb,OAAQ;YACJ,KAAK;gBAAgB,OAAO,sBAAsB,sBAAsB;YACxE,KAAK;gBAAoB,OAAO;YAChC,KAAK;gBAAsB,OAAO;YAElC,KAAK;gBAAU,OAAO;YACtB,KAAK;gBAAiB,OAAO;YAE7B,KAAK;gBAAY,OAAO;YACxB,KAAK;gBAAgB,OAAO;YAC5B,KAAK;gBAAqB,OAAO;YACjC,KAAK;gBAAc,OAAO;YAE1B,KAAK;gBAA2B,OAAO;YACvC,KAAK;gBAAqB,OAAO;YACjC,KAAK;gBAAoB,OAAO;YAEhC,KAAK;gBAAmB,OAAO;YAC/B,KAAK;gBAAoB,OAAO;YAChC,KAAK;gBAAqB,OAAO;YACjC,KAAK;gBAAW,OAAO;YACvB;gBAAS,OAAO;QACpB;IACJ;AACJ"}},
    {"offset": {"line": 2094, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/layout/SingleQuestionView.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"binaryBtn\": \"SingleQuestionView-module__Akm0dW__binaryBtn\",\n  \"binaryOptions\": \"SingleQuestionView-module__Akm0dW__binaryOptions\",\n  \"container\": \"SingleQuestionView-module__Akm0dW__container\",\n  \"dateInput\": \"SingleQuestionView-module__Akm0dW__dateInput\",\n  \"enterBtn\": \"SingleQuestionView-module__Akm0dW__enterBtn\",\n  \"gridBtn\": \"SingleQuestionView-module__Akm0dW__gridBtn\",\n  \"gridBtnActive\": \"SingleQuestionView-module__Akm0dW__gridBtnActive\",\n  \"gridContainer\": \"SingleQuestionView-module__Akm0dW__gridContainer\",\n  \"hint\": \"SingleQuestionView-module__Akm0dW__hint\",\n  \"inputArea\": \"SingleQuestionView-module__Akm0dW__inputArea\",\n  \"key\": \"SingleQuestionView-module__Akm0dW__key\",\n  \"question\": \"SingleQuestionView-module__Akm0dW__question\",\n  \"scaleNumber\": \"SingleQuestionView-module__Akm0dW__scaleNumber\",\n  \"scaleNumberActive\": \"SingleQuestionView-module__Akm0dW__scaleNumberActive\",\n  \"slider\": \"SingleQuestionView-module__Akm0dW__slider\",\n  \"sliderContainer\": \"SingleQuestionView-module__Akm0dW__sliderContainer\",\n  \"sliderLabels\": \"SingleQuestionView-module__Akm0dW__sliderLabels\",\n  \"sliderScale\": \"SingleQuestionView-module__Akm0dW__sliderScale\",\n  \"sliderValueDisplay\": \"SingleQuestionView-module__Akm0dW__sliderValueDisplay\",\n  \"textInput\": \"SingleQuestionView-module__Akm0dW__textInput\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 2120, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/i18n/translations.ts"],"sourcesContent":["export type Language = 'en' | 'ar';\r\n\r\nexport const translations = {\r\n    en: {\r\n        orientation: \"Regulate your academic load, one decision at a time.\",\r\n        auth_check: \"Verifying credentials...\",\r\n        auth_login: \"Identify yourself.\",\r\n        intent: \"What is your current academic focus?\",\r\n        subject_list_empty: \"No courses enrolled.\",\r\n        add_subject: \"Enroll Course\",\r\n        subject_name: \"Course Title\",\r\n        exam_date: \"Examination Date\",\r\n        action_required: \"Action Required\",\r\n        register_class: \"Log Class\",\r\n        study_now: \"Start Session\",\r\n        type_q: \"Session Format?\",\r\n        duration_q: \"Duration?\",\r\n        understanding_q: \"Your level of understanding of the lecture from the college professor's explanation?\",\r\n        demand_q: \"Cognitive Demand?\",\r\n        duration_note: \"Duration of the university record\",\r\n        duration_warning: \"Note: You must record any lecture or section at the college using your personal phone. Here, you will record the duration of the recording you made.\",\r\n        fam_q: \"Topic Familiarity?\",\r\n        focus_q: \"Current Focus Level?\",\r\n        time_q: \"Allocated Time?\",\r\n        session_active: \"SESSION IN PROGRESS\",\r\n        reflection_q: \"Session Outcome?\",\r\n        reason_q: \"Primary Factor?\",\r\n        cycle_complete: \"Cycle Logged.\",\r\n        // Actions\r\n        yes: \"Yes\",\r\n        no: \"No\",\r\n        theory: \"Theory\",\r\n        practical: \"Practical\",\r\n        revision: \"Revision\",\r\n        very_light: \"Minimal\",\r\n        light: \"Low\",\r\n        moderate: \"Moderate\",\r\n        heavy: \"High\",\r\n        very_heavy: \"Intense\",\r\n        safe: \"Optimal\",\r\n        medium: \"Moderate\",\r\n        // Dashboard\r\n        dashboard: \"Overview\",\r\n        sessions: \"History\",\r\n        academic_input: \"Input Registry\",\r\n        inject_input: \"Log Session\",\r\n        questions: \"Inquiry\",\r\n        settings: \"Configuration\",\r\n        system_capacity: \"MENTAL CAPACITY\",\r\n        nominal_state: \"OPTIMAL\",\r\n        depleted_state: \"FATIGUED\",\r\n        cognitive_load: \"COGNITIVE LOAD\",\r\n        units: \"UNITS\",\r\n        status: \"CONDITION\",\r\n        velocity: \"PACE\",\r\n        cycles: \"SESSIONS\",\r\n        active_subjects: \"Curriculum\",\r\n        inspect: \"ACCESS\",\r\n        stability: \"RETENTION\",\r\n        exam_in: \"EXAM\",\r\n        days: \"DAYS\",\r\n        // Academic Input Empty State\r\n        input_guide_title: \"No Academic Records\",\r\n        input_guide_desc: \"Begin by logging your recent lectures, labs, or revision sessions to calibrate your cognitive load.\",\r\n        log_entry: \"Log First Session\",\r\n        // Branding\r\n        brand_name: \"CORTEX\",\r\n        brand_subtitle: \"ACADEMIC CONTROL SYSTEM\",\r\n        // Navigation Hints\r\n        press_enter: \"Press Enter to continue\",\r\n        select_option_hint: \"Select option and press Enter (or double tap)\",\r\n        low_label: \"LOW\",\r\n        high_label: \"HIGH\",\r\n        stop_session: \"STOP SESSION\",\r\n        // Table\r\n        col_item: \"Item Name\",\r\n        col_type: \"Type\",\r\n        col_duration: \"Duration\",\r\n        col_diff: \"Difficulty\",\r\n        col_delta: \"Delta\",\r\n        col_status: \"Status\",\r\n        col_actions: \"Actions\",\r\n        status_ready: \"READY\",\r\n        status_progress: \"IN PROGRESS\",\r\n        status_completed: \"COMPLETED\",\r\n        status_interrupted: \"INTERRUPTED\",\r\n        diff_avg: \"Avg\",\r\n        sess_scan: \"Inspect\",\r\n        sess_start: \"Start Session\",\r\n        sess_del: \"Delete\",\r\n        empty_state: \"No academic structure found. Add a Lecture to begin.\",\r\n        study_session_label: \"Study Session\",\r\n        lecture_label: \"Lecture\",\r\n        section_label: \"Section\",\r\n        avg_session: \"Avg Session\",\r\n        avg_diff: \"Avg Difficulty\",\r\n        total_sessions: \"Total Sessions\",\r\n        // Durations\r\n        min_15: \"15 min\",\r\n        min_30: \"30 min\",\r\n        min_45: \"45 min\",\r\n        hr_1: \"1 hr\",\r\n        hr_1_15: \"1 hr, 15 min\",\r\n        hr_1_30: \"1 hr, 30 min\",\r\n        hr_1_45: \"1 hr, 45 min\",\r\n        hr_2: \"2 hr\",\r\n        enter_btn: \"ENTER\",\r\n        // Settings - Physiology\r\n        physio_config: \"Physiology Configuration\",\r\n        sys_regulation: \"System Regulation Rules & Thresholds\",\r\n        cancel: \"Cancel\",\r\n        save_changes: \"Save Changes\",\r\n        sys_strictness: \"System Strictness\",\r\n        level_relaxed: \"Relaxed\",\r\n        level_standard: \"Standard\",\r\n        level_military: \"Military\",\r\n        cog_thresholds: \"Cognitive Thresholds\",\r\n        load_limit_label: \"Load Limit until System Lockout\",\r\n        limit_conservative: \"50% (Conservative)\",\r\n        limit_none: \"100% (No Limit)\",\r\n        revision_strategy: \"Revision Strategy\",\r\n        strat_spaced: \"Spaced Repetition (Standard)\",\r\n        strat_jit: \"Just-in-Time (Exam Focused)\",\r\n        strat_aggressive: \"Aggressive (Maintenance)\",\r\n        sys_override: \"System Override\",\r\n        override_warning: \"Changing these values will recalibrate all upcoming session predictions for this subject. Existing stability metrics will be preserved.\",\r\n\r\n        // Expected Time (New)\r\n        hours: \"hours\",\r\n        minutes: \"minutes\",\r\n        expectedTime: \"Expected study time\",\r\n    },\r\n    ar: {\r\n        orientation: \"     .\",\r\n        auth_check: \" ...\",\r\n        auth_login: \" \",\r\n        intent: \"    \",\r\n        subject_list_empty: \"   .\",\r\n        add_subject: \" \",\r\n        subject_name: \" \",\r\n        exam_date: \" \",\r\n        action_required: \" \",\r\n        register_class: \" \",\r\n        study_now: \" \",\r\n        type_q: \" \",\r\n        duration_q: \"\",\r\n        understanding_q: \"      \",\r\n        demand_q: \" \",\r\n        duration_note: \"  \",\r\n        duration_warning: \":            .        .\",\r\n        fam_q: \" \",\r\n        focus_q: \"  \",\r\n        time_q: \" \",\r\n        session_active: \" \",\r\n        reflection_q: \" \",\r\n        reason_q: \"  \",\r\n        cycle_complete: \" .\",\r\n        // Actions\r\n        yes: \"\",\r\n        no: \"\",\r\n        theory: \"\",\r\n        practical: \"\",\r\n        revision: \"\",\r\n        very_light: \"\",\r\n        light: \"\",\r\n        moderate: \"\",\r\n        heavy: \"\",\r\n        very_heavy: \"\",\r\n        safe: \"\",\r\n        medium: \"\",\r\n        // Dashboard\r\n        dashboard: \" \",\r\n        sessions: \"\",\r\n        academic_input: \" \",\r\n        inject_input: \" \",\r\n        questions: \"\",\r\n        settings: \"\",\r\n        system_capacity: \" \",\r\n        nominal_state: \"\",\r\n        depleted_state: \"\",\r\n        cognitive_load: \" \",\r\n        units: \"\",\r\n        status: \"\",\r\n        velocity: \"\",\r\n        cycles: \"\",\r\n        active_subjects: \"\",\r\n        inspect: \"\",\r\n        stability: \"\",\r\n        exam_in: \"\",\r\n        days: \"\",\r\n        // Academic Input Empty State\r\n        input_guide_title: \"   \",\r\n        input_guide_desc: \"       .\",\r\n        log_entry: \"  \",\r\n        // Branding\r\n        brand_name: \"\",\r\n        brand_subtitle: \"  \",\r\n        // Navigation Hints\r\n        press_enter: \" Enter \",\r\n        select_option_hint: \"   Enter (  )\",\r\n        low_label: \"\",\r\n        high_label: \"\",\r\n        stop_session: \" \",\r\n        // Table\r\n        col_item: \"\",\r\n        col_type: \"\",\r\n        col_duration: \"\",\r\n        col_diff: \"\",\r\n        col_delta: \"\",\r\n        col_status: \"\",\r\n        col_actions: \"\",\r\n        status_ready: \"\",\r\n        status_progress: \" \",\r\n        status_completed: \"\",\r\n        status_interrupted: \"\",\r\n        diff_avg: \"\",\r\n        sess_scan: \"\",\r\n        sess_start: \"\",\r\n        sess_del: \"\",\r\n        empty_state: \"   .   .\",\r\n        study_session_label: \" \",\r\n        lecture_label: \"\",\r\n        section_label: \"\",\r\n        avg_session: \" \",\r\n        avg_diff: \" \",\r\n        total_sessions: \" \",\r\n        // Durations\r\n        min_15: \"15 \",\r\n        min_30: \"30 \",\r\n        min_45: \"45 \",\r\n        hr_1: \"1 \",\r\n        hr_1_15: \"1  15 \",\r\n        hr_1_30: \"1  30 \",\r\n        hr_1_45: \"1  45 \",\r\n        hr_2: \"2 \",\r\n        enter_btn: \"\",\r\n\r\n        // Settings - Physiology\r\n        physio_config: \" \",\r\n        sys_regulation: \"  \",\r\n        cancel: \"\",\r\n        save_changes: \" \",\r\n        sys_strictness: \" \",\r\n        level_relaxed: \"\",\r\n        level_standard: \"\",\r\n        level_military: \"\",\r\n        cog_thresholds: \" \",\r\n        load_limit_label: \"    \",\r\n        limit_conservative: \"50% ()\",\r\n        limit_none: \"100% ( )\",\r\n        revision_strategy: \" \",\r\n        strat_spaced: \"  ()\",\r\n        strat_jit: \"   ( )\",\r\n        strat_aggressive: \" ()\",\r\n        sys_override: \" \",\r\n        override_warning: \"            .     .\",\r\n\r\n        // Expected Time (New)\r\n        hours: \"\",\r\n        minutes: \"\",\r\n        expectedTime: \"  \",\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2386, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/layout/SingleQuestionView.tsx"],"sourcesContent":["import React from 'react';\r\nimport styles from './SingleQuestionView.module.css';\r\nimport { ArrowRight, CornerDownLeft } from 'lucide-react';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\n\r\ninterface SingleQuestionViewProps {\r\n    question: string;\r\n    subtitle?: string;\r\n    warning?: string; // New Prop\r\n    inputType: 'text' | 'slider' | 'binary' | 'none' | 'date' | 'grid';\r\n    value?: any;\r\n    onChange?: (value: any) => void;\r\n    onConfirm?: () => void;\r\n    placeholder?: string;\r\n    options?: { label: string; value: any }[];\r\n    lang: Language;\r\n}\r\n\r\nexport function SingleQuestionView({\r\n    question,\r\n    subtitle,\r\n    warning,\r\n    inputType,\r\n    value,\r\n    onChange,\r\n    onConfirm,\r\n    placeholder,\r\n    options,\r\n    lang\r\n}: SingleQuestionViewProps) {\r\n    const t = translations[lang];\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' && onConfirm) {\r\n            onConfirm();\r\n        }\r\n    };\r\n\r\n    // Global Enter Key Handler for Grid/None types\r\n    React.useEffect(() => {\r\n        const handleGlobalKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Enter' && onConfirm) {\r\n                // Only trigger for Grid or None (Message) types\r\n                // Inputs like Text/Slider handle their own Enter key events via onKeyDown prop\r\n                // to avoid double-firing.\r\n                if (inputType === 'grid' || inputType === 'none') {\r\n                    // Check if value is selected for grid?\r\n                    // Usually safe to call confirm, page logic handles validation if needed.\r\n                    if (inputType === 'grid' && (value === undefined || value === null)) return;\r\n                    onConfirm();\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleGlobalKeyDown);\r\n        return () => window.removeEventListener('keydown', handleGlobalKeyDown);\r\n    }, [inputType, value, onConfirm]);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <h1 className={styles.question}>{question}</h1>\r\n\r\n            {/* Subtitle: White, slightly dimmed */}\r\n            {subtitle && (\r\n                <div style={{\r\n                    fontSize: '1rem',\r\n                    color: '#ffffff',\r\n                    marginTop: '-1rem',\r\n                    marginBottom: '0.5rem',\r\n                    opacity: 0.8,\r\n                    textAlign: 'center'\r\n                }}>\r\n                    {subtitle}\r\n                </div>\r\n            )}\r\n\r\n            {/* Warning: Red, larger, prominent */}\r\n            {warning && (\r\n                <div style={{\r\n                    fontSize: '1.05rem',\r\n                    color: '#ef4444',\r\n                    marginTop: '0.5rem',\r\n                    marginBottom: '1.5rem',\r\n                    fontWeight: 500,\r\n                    maxWidth: '600px',\r\n                    textAlign: 'center',\r\n                    lineHeight: '1.5'\r\n                }}>\r\n                    {warning}\r\n                </div>\r\n            )}\r\n\r\n            <div className={styles.inputArea}>\r\n                {inputType === 'text' && (\r\n                    <input\r\n                        type=\"text\"\r\n                        className={styles.textInput}\r\n                        value={value || ''}\r\n                        onChange={(e) => onChange && onChange(e.target.value)}\r\n                        onKeyDown={handleKeyDown}\r\n                        placeholder={placeholder}\r\n                        autoFocus\r\n                    />\r\n                )}\r\n\r\n                {inputType === 'slider' && (\r\n                    <div className={styles.sliderContainer}>\r\n                        <div className={styles.sliderValueDisplay}>\r\n                            {value || 5} / 10\r\n                        </div>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"1\"\r\n                            max=\"10\"\r\n                            step=\"1\"\r\n                            value={value || 5}\r\n                            onChange={(e) => onChange && onChange(Number(e.target.value))}\r\n                            onKeyDown={handleKeyDown}\r\n                            className={styles.slider}\r\n                            autoFocus\r\n                        />\r\n                        <div className={styles.sliderScale}>\r\n                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((num) => (\r\n                                <span\r\n                                    key={num}\r\n                                    className={value === num ? styles.scaleNumberActive : styles.scaleNumber}\r\n                                    onClick={() => onChange && onChange(num)}\r\n                                >\r\n                                    {num}\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                        <div className={styles.sliderLabels}>\r\n                            <span>{t.low_label}</span>\r\n                            <span>{t.high_label}</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {inputType === 'binary' && (\r\n                    <div className={styles.binaryOptions}>\r\n                        <button className={styles.binaryBtn} onClick={() => { onChange && onChange(true); onConfirm && onConfirm(); }}>{t.yes}</button>\r\n                        <button className={styles.binaryBtn} onClick={() => { onChange && onChange(false); onConfirm && onConfirm(); }}>{t.no}</button>\r\n                    </div>\r\n                )}\r\n\r\n                {inputType === 'grid' && options && (\r\n                    <div className={styles.gridContainer}>\r\n                        {options.map((opt) => (\r\n                            <button\r\n                                key={opt.label}\r\n                                className={`${styles.gridBtn} ${value === opt.value ? styles.gridBtnActive : ''}`}\r\n                                onClick={() => { onChange && onChange(opt.value); }}\r\n                                onDoubleClick={() => { onChange && onChange(opt.value); onConfirm && onConfirm(); }}\r\n                            >\r\n                                {opt.label}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {inputType === 'date' && (\r\n                    <input\r\n                        type=\"date\"\r\n                        className={styles.dateInput}\r\n                        value={value || ''}\r\n                        onChange={(e) => onChange && onChange(e.target.value)}\r\n                        onKeyDown={handleKeyDown}\r\n                        autoFocus\r\n                    />\r\n                )}\r\n            </div>\r\n\r\n            {inputType !== 'binary' && inputType !== 'none' && (\r\n                <button className={styles.enterBtn} onClick={() => onConfirm && onConfirm()}>\r\n                    {t.enter_btn} <CornerDownLeft size={16} />\r\n                </button>\r\n            )}\r\n\r\n            {inputType === 'grid' && (\r\n                <div className={styles.hint}>\r\n                    {t.select_option_hint}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2683, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/dashboard/ControlLayout.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"avatarInitials\": \"ControlLayout-module__xAmKTa__avatarInitials\",\n  \"backdrop\": \"ControlLayout-module__xAmKTa__backdrop\",\n  \"brandName\": \"ControlLayout-module__xAmKTa__brandName\",\n  \"brandSubtitle\": \"ControlLayout-module__xAmKTa__brandSubtitle\",\n  \"contentViewport\": \"ControlLayout-module__xAmKTa__contentViewport\",\n  \"fadeIn\": \"ControlLayout-module__xAmKTa__fadeIn\",\n  \"fullWidth\": \"ControlLayout-module__xAmKTa__fullWidth\",\n  \"globalControls\": \"ControlLayout-module__xAmKTa__globalControls\",\n  \"header\": \"ControlLayout-module__xAmKTa__header\",\n  \"headerLeft\": \"ControlLayout-module__xAmKTa__headerLeft\",\n  \"headerRight\": \"ControlLayout-module__xAmKTa__headerRight\",\n  \"iconBtn\": \"ControlLayout-module__xAmKTa__iconBtn\",\n  \"layoutContainer\": \"ControlLayout-module__xAmKTa__layoutContainer\",\n  \"logoArea\": \"ControlLayout-module__xAmKTa__logoArea\",\n  \"logoIcon\": \"ControlLayout-module__xAmKTa__logoIcon\",\n  \"logoText\": \"ControlLayout-module__xAmKTa__logoText\",\n  \"mainContent\": \"ControlLayout-module__xAmKTa__mainContent\",\n  \"mobileMenuBtn\": \"ControlLayout-module__xAmKTa__mobileMenuBtn\",\n  \"navGroup\": \"ControlLayout-module__xAmKTa__navGroup\",\n  \"navItem\": \"ControlLayout-module__xAmKTa__navItem\",\n  \"navItemActive\": \"ControlLayout-module__xAmKTa__navItemActive\",\n  \"navLabel\": \"ControlLayout-module__xAmKTa__navLabel\",\n  \"navigation\": \"ControlLayout-module__xAmKTa__navigation\",\n  \"notificationArea\": \"ControlLayout-module__xAmKTa__notificationArea\",\n  \"sidebar\": \"ControlLayout-module__xAmKTa__sidebar\",\n  \"sidebarClosed\": \"ControlLayout-module__xAmKTa__sidebarClosed\",\n  \"sidebarOpen\": \"ControlLayout-module__xAmKTa__sidebarOpen\",\n  \"sidebarToggle\": \"ControlLayout-module__xAmKTa__sidebarToggle\",\n  \"textBtn\": \"ControlLayout-module__xAmKTa__textBtn\",\n  \"userAvatar\": \"ControlLayout-module__xAmKTa__userAvatar\",\n  \"userInfo\": \"ControlLayout-module__xAmKTa__userInfo\",\n  \"userName\": \"ControlLayout-module__xAmKTa__userName\",\n  \"userRole\": \"ControlLayout-module__xAmKTa__userRole\",\n  \"userSection\": \"ControlLayout-module__xAmKTa__userSection\",\n  \"withSidebar\": \"ControlLayout-module__xAmKTa__withSidebar\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 2724, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/hooks.ts"],"sourcesContent":["import { useMemo, useState, useEffect } from 'react';\r\nimport { useStore } from '../store/useStore';\r\n\r\n/**\r\n * UI DATA LAYER (READ-ONLY)\r\n * \r\n * This file acts as the \"Read\" counterpart to SystemAPI.ts (\"Write\").\r\n * Components should import these hooks to render state.\r\n * They should NEVER import useStore directly.\r\n */\r\n\r\n// --- 1. TELEMETRY HOOKS ---\r\n\r\nexport const useStudentProfile = () => {\r\n    return useStore(state => state.profile);\r\n};\r\n\r\nexport const useDailyLoad = () => {\r\n    return useStore(state => state.dailyLoad);\r\n};\r\n\r\nexport const useSystemStatus = () => {\r\n    return useStore(state => {\r\n        const loadStatus = state.dailyLoad.status;\r\n        const capacity = state.profile.currentCapacity;\r\n\r\n        if (capacity <= 5) return 'CRITICAL';\r\n        if (loadStatus === 'Risk') return 'LOCKED';\r\n        if (loadStatus === 'Warning') return 'WARNING';\r\n        return 'NOMINAL';\r\n    });\r\n};\r\n\r\n// --- 2. INVENTORY HOOKS ---\r\n\r\nexport const useSubjectList = () => {\r\n    return useStore(state => state.subjects);\r\n};\r\n\r\nexport const useSubject = (subjectId: string) => {\r\n    return useStore(state => state.subjects.find(s => s.id === subjectId));\r\n};\r\n\r\nexport const useSubjectLectures = (subjectId: string) => {\r\n    const lectures = useStore(state => state.lectures);\r\n    return useMemo(() => lectures.filter(l => l.subjectId === subjectId), [lectures, subjectId]);\r\n};\r\n\r\n// --- 3. SESSION HOOKS ---\r\n\r\nexport const useSessionLog = () => {\r\n    return useStore(state => state.sessions);\r\n};\r\n\r\n// --- 4. UTILITY HOOKS ---\r\n\r\nexport const useMediaQuery = (query: string): boolean => {\r\n    const [matches, setMatches] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const media = window.matchMedia(query);\r\n        if (media.matches !== matches) {\r\n            setMatches(media.matches);\r\n        }\r\n\r\n        const listener = () => setMatches(media.matches);\r\n        media.addEventListener('change', listener);\r\n        return () => media.removeEventListener('change', listener);\r\n    }, [query, matches]);\r\n\r\n    return matches;\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;;;AAYO,MAAM,oBAAoB;IAC7B,OAAO,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,OAAO;AAC1C;AAEO,MAAM,eAAe;IACxB,OAAO,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,SAAS;AAC5C;AAEO,MAAM,kBAAkB;IAC3B,OAAO,IAAA,oIAAQ,EAAC,CAAA;QACZ,MAAM,aAAa,MAAM,SAAS,CAAC,MAAM;QACzC,MAAM,WAAW,MAAM,OAAO,CAAC,eAAe;QAE9C,IAAI,YAAY,GAAG,OAAO;QAC1B,IAAI,eAAe,QAAQ,OAAO;QAClC,IAAI,eAAe,WAAW,OAAO;QACrC,OAAO;IACX;AACJ;AAIO,MAAM,iBAAiB;IAC1B,OAAO,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,QAAQ;AAC3C;AAEO,MAAM,aAAa,CAAC;IACvB,OAAO,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;AAC/D;AAEO,MAAM,qBAAqB,CAAC;IAC/B,MAAM,WAAW,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,QAAQ;IACjD,OAAO,IAAA,gNAAO,EAAC,IAAM,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK,YAAY;QAAC;QAAU;KAAU;AAC/F;AAIO,MAAM,gBAAgB;IACzB,OAAO,IAAA,oIAAQ,EAAC,CAAA,QAAS,MAAM,QAAQ;AAC3C;AAIO,MAAM,gBAAgB,CAAC;IAC1B,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACN,MAAM,QAAQ,OAAO,UAAU,CAAC;QAChC,IAAI,MAAM,OAAO,KAAK,SAAS;YAC3B,WAAW,MAAM,OAAO;QAC5B;QAEA,MAAM,WAAW,IAAM,WAAW,MAAM,OAAO;QAC/C,MAAM,gBAAgB,CAAC,UAAU;QACjC,OAAO,IAAM,MAAM,mBAAmB,CAAC,UAAU;IACrD,GAAG;QAAC;QAAO;KAAQ;IAEnB,OAAO;AACX"}},
    {"offset": {"line": 2797, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/auth/AuthModal.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"backBtn\": \"AuthModal-module__kkVAJG__backBtn\",\n  \"backdrop\": \"AuthModal-module__kkVAJG__backdrop\",\n  \"close\": \"AuthModal-module__kkVAJG__close\",\n  \"divider\": \"AuthModal-module__kkVAJG__divider\",\n  \"emailBtn\": \"AuthModal-module__kkVAJG__emailBtn\",\n  \"error\": \"AuthModal-module__kkVAJG__error\",\n  \"footerText\": \"AuthModal-module__kkVAJG__footerText\",\n  \"googleBtn\": \"AuthModal-module__kkVAJG__googleBtn\",\n  \"input\": \"AuthModal-module__kkVAJG__input\",\n  \"inputGroup\": \"AuthModal-module__kkVAJG__inputGroup\",\n  \"inputIcon\": \"AuthModal-module__kkVAJG__inputIcon\",\n  \"inputWrapper\": \"AuthModal-module__kkVAJG__inputWrapper\",\n  \"label\": \"AuthModal-module__kkVAJG__label\",\n  \"linkBtn\": \"AuthModal-module__kkVAJG__linkBtn\",\n  \"modal\": \"AuthModal-module__kkVAJG__modal\",\n  \"primaryBtn\": \"AuthModal-module__kkVAJG__primaryBtn\",\n  \"scaleIn\": \"AuthModal-module__kkVAJG__scaleIn\",\n  \"subtitle\": \"AuthModal-module__kkVAJG__subtitle\",\n  \"title\": \"AuthModal-module__kkVAJG__title\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 2822, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/auth/AuthModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { createPortal } from \"react-dom\";\r\nimport { useStore } from '@/store/useStore';\r\nimport { isConfigValid } from '@/core/services/firebase';\r\nimport { X, ArrowRight, User, Mail, Lock, ShieldCheck, BookOpen } from 'lucide-react';\r\nimport styles from \"./AuthModal.module.css\";\r\n\r\n// Interface matches what the UI needs, but we also integrate logic\r\ninterface AuthModalProps {\r\n    open: boolean;\r\n    onClose: () => void;\r\n    onGoogleSignIn?: () => void;\r\n    onEmailSignIn?: () => void;\r\n    initialMode?: 'LOGIN' | 'REGISTER';\r\n}\r\n\r\ntype Mode = 'LOGIN' | 'EMAIL_LOGIN' | 'REG_IDENTITY' | 'REG_PROFILE' | 'REG_INIT';\r\n\r\nexport const AuthModal: React.FC<AuthModalProps> = ({\r\n    open,\r\n    onClose,\r\n    onGoogleSignIn,\r\n    onEmailSignIn,\r\n    initialMode = 'LOGIN'\r\n}) => {\r\n    const { login, loginWithGoogle, register, authModal } = useStore();\r\n    const [mode, setMode] = useState<Mode>(initialMode === 'REGISTER' ? 'REG_IDENTITY' : 'LOGIN');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [configValid, setConfigValid] = useState(true);\r\n\r\n    // Ensure Client-Side Rendering for Portal\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        setConfigValid(isConfigValid());\r\n        return () => setMounted(false);\r\n    }, []);\r\n\r\n    // Form State\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [name, setName] = useState('');\r\n    const [university, setUniversity] = useState('');\r\n    const [faculty, setFaculty] = useState('');\r\n\r\n\r\n    const handleGoogleLogin = async () => {\r\n        if (!configValid) return; // Prevent action if config is invalid\r\n\r\n        if (onGoogleSignIn) {\r\n            onGoogleSignIn();\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setError(null);\r\n\r\n        // 2. Call Store Action (Firebase handles Popup)\r\n        const result = await loginWithGoogle();\r\n\r\n        setIsLoading(false);\r\n        if (result.success) {\r\n            if (authModal.onSuccess) authModal.onSuccess();\r\n            onClose();\r\n        } else {\r\n            // Show the actual error bubbling up from Service/Firebase\r\n            // NOTE: AuthService error throwing is caught in store which returns {success: false, error: ...}\r\n            setError(result.error || \"Google connection failed. Check console.\");\r\n        }\r\n    };\r\n\r\n    const handleLogin = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        const success = await login(email, password);\r\n        setIsLoading(false);\r\n        if (success) {\r\n            if (authModal.onSuccess) authModal.onSuccess();\r\n            onClose();\r\n        } else {\r\n            setError(\"Invalid credentials. Please try again.\");\r\n        }\r\n    };\r\n\r\n    const handleRegister = async () => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        // Simulate Init Step\r\n        setMode('REG_INIT');\r\n\r\n        const success = await register(\r\n            { email, password },\r\n            { name, university, faculty }\r\n        );\r\n\r\n        setIsLoading(false);\r\n        if (success) {\r\n            if (authModal.onSuccess) authModal.onSuccess();\r\n            onClose();\r\n        } else {\r\n            setMode('REG_PROFILE');\r\n            setError(\"Registration failed. Please try again.\");\r\n        }\r\n    };\r\n\r\n    // --- RENDER HELPERS ---\r\n\r\n    const Input = ({ label, type, value, onChange, placeholder, icon: Icon }: any) => (\r\n        <div className={styles.inputGroup}>\r\n            <label className={styles.label}>{label}</label>\r\n            <div className={styles.inputWrapper}>\r\n                <input\r\n                    type={type}\r\n                    className={styles.input}\r\n                    value={value}\r\n                    onChange={(e) => onChange(e.target.value)}\r\n                    placeholder={placeholder}\r\n                />\r\n                <Icon className={styles.inputIcon} size={18} />\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    if (!mounted || !open) return null;\r\n\r\n    const handleEmailClick = () => {\r\n        if (onEmailSignIn) {\r\n            onEmailSignIn();\r\n        } else {\r\n            setMode('EMAIL_LOGIN');\r\n        }\r\n    };\r\n\r\n    return createPortal(\r\n        <div className={styles.backdrop}>\r\n            {/* Modal */}\r\n            <div className={styles.modal}>\r\n\r\n                <button onClick={onClose} className={styles.close}>\r\n                    <X size={20} />\r\n                </button>\r\n\r\n                {mode === 'LOGIN' && (\r\n                    <>\r\n                        <h2 className={styles.title}>Welcome back</h2>\r\n                        <p className={styles.subtitle}>Sign in to sync your neural context</p>\r\n\r\n                        {error && <div className={styles.error}>{error}</div>}\r\n\r\n                        <button\r\n                            className={styles.googleBtn}\r\n                            onClick={handleGoogleLogin}\r\n                            disabled={isLoading || !configValid}\r\n                            style={{\r\n                                opacity: !configValid ? 0.5 : 1,\r\n                                cursor: !configValid ? 'not-allowed' : 'pointer',\r\n                                filter: !configValid ? 'grayscale(100%)' : 'none'\r\n                            }}\r\n                            title={!configValid ? \"Firebase API keys are missing\" : \"Sign in with Google\"}\r\n                        >\r\n                            <img src=\"https://www.svgrepo.com/show/475656/google-color.svg\" alt=\"Google\" width={20} height={20} />\r\n                            {!configValid ? \"Configuration Disabled\" : (isLoading ? \"Connecting...\" : \"Continue with Google\")}\r\n                        </button>\r\n\r\n                        {!configValid && (\r\n                            <div style={{\r\n                                color: '#F87171',\r\n                                fontSize: '0.75rem',\r\n                                textAlign: 'center',\r\n                                marginTop: '0.5rem',\r\n                                padding: '0.5rem',\r\n                                background: 'rgba(127, 29, 29, 0.2)',\r\n                                borderRadius: '6px',\r\n                                border: '1px solid rgba(127, 29, 29, 0.5)'\r\n                            }}>\r\n                                System Error: Invalid Firebase Configuration.<br />\r\n                                Please update .env.local with real keys.\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className={styles.divider}>\r\n                            <span>or</span>\r\n                        </div>\r\n\r\n                        <button className={styles.emailBtn} onClick={handleEmailClick}>\r\n                            Continue with Email\r\n                        </button>\r\n\r\n                        <div className={styles.footerText}>\r\n                            <button onClick={() => setMode('REG_IDENTITY')} className={styles.linkBtn}>\r\n                                Don't have an account? Create Access\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n                {mode === 'EMAIL_LOGIN' && (\r\n                    <>\r\n                        <button onClick={() => setMode('LOGIN')} className={styles.backBtn}>\r\n                            <ArrowRight size={20} className=\"rotate-180\" />\r\n                        </button>\r\n\r\n                        <h2 className={styles.title}>Sign in with Email</h2>\r\n                        <p className={styles.subtitle} style={{ marginBottom: '1.5rem' }}>Enter your credentials below</p>\r\n\r\n                        <Input label=\"Email Address\" type=\"email\" value={email} onChange={setEmail} placeholder=\"student@university.edu\" icon={Mail} />\r\n                        <Input label=\"Password\" type=\"password\" value={password} onChange={setPassword} placeholder=\"\" icon={Lock} />\r\n\r\n                        <button className={styles.primaryBtn} onClick={handleLogin} disabled={isLoading}>\r\n                            {isLoading ? \"Authenticating...\" : \"Sign In\"}\r\n                        </button>\r\n\r\n                        <div className={styles.footerText} style={{ marginTop: '1.5rem' }}>\r\n                            <button className={styles.linkBtn}>Forgot Password?</button>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n                {mode === 'REG_IDENTITY' && (\r\n                    <>\r\n                        <h2 className={styles.title}>Create Access</h2>\r\n                        <p className={styles.subtitle}>Secure Identity setup</p>\r\n\r\n                        <Input label=\"Email Address\" type=\"email\" value={email} onChange={setEmail} placeholder=\"student@university.edu\" icon={Mail} />\r\n                        <Input label=\"Set Password\" type=\"password\" value={password} onChange={setPassword} placeholder=\"\" icon={Lock} />\r\n\r\n                        <button\r\n                            className={styles.primaryBtn}\r\n                            onClick={() => { if (email && password) setMode('REG_PROFILE') }}\r\n                            style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}\r\n                        >\r\n                            Continue\r\n                            <ArrowRight size={16} />\r\n                        </button>\r\n\r\n                        <div className={styles.footerText}>\r\n                            <button onClick={() => setMode('LOGIN')} className={styles.linkBtn}>Back to Sign In</button>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n                {mode === 'REG_PROFILE' && (\r\n                    <>\r\n                        <button onClick={() => setMode('REG_IDENTITY')} className={styles.backBtn}>\r\n                            <ArrowRight size={20} className=\"rotate-180\" />\r\n                        </button>\r\n\r\n                        <h2 className={styles.title}>Academic Profile</h2>\r\n                        <p className={styles.subtitle}>Contextual calibration</p>\r\n\r\n                        <Input label=\"Full Name\" type=\"text\" value={name} onChange={setName} placeholder=\"John Doe\" icon={User} />\r\n                        <Input label=\"University\" type=\"text\" value={university} onChange={setUniversity} placeholder=\"MIT\" icon={BookOpen} />\r\n                        <Input label=\"Faculty / Major\" type=\"text\" value={faculty} onChange={setFaculty} placeholder=\"Computer Science\" icon={ShieldCheck} />\r\n\r\n                        <button className={styles.primaryBtn} onClick={handleRegister} disabled={isLoading}>\r\n                            {isLoading ? \"Creating Profile...\" : \"Initialize System\"}\r\n                        </button>\r\n                    </>\r\n                )}\r\n\r\n                {mode === 'REG_INIT' && (\r\n                    <div className=\"text-center py-16\">\r\n                        <div className=\"animate-spin w-10 h-10 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-6\"></div>\r\n                        <h3 className=\"text-lg font-semibold text-white mb-2\">Initializing System</h3>\r\n                        <p className=\"text-slate-500 text-sm\">Securing workspace ledger...</p>\r\n                    </div>\r\n                )}\r\n\r\n            </div>\r\n        </div>,\r\n        document.body\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3420, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/admin/StudentsTable.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { UserProfileWithMeta } from '@/core/types';\r\nimport { Search, Filter, MoreHorizontal, User, Monitor, MousePointer2, Clock, AlertTriangle, Maximize2, Minimize2 } from 'lucide-react';\r\nimport { useState, Fragment } from 'react';\r\nimport { useStore } from '@/store/useStore'; // Keep for Error State/Actions\r\n\r\ninterface Props {\r\n    students: UserProfileWithMeta[];\r\n}\r\n\r\nexport const StudentsTable = ({ students }: Props) => {\r\n    const { selectStudent, adminError } = useStore();\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n    // Filter Logic\r\n    const filteredStudents = students.filter(student =>\r\n        student.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        student.email?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className={`w-full flex flex-col flex-1 min-h-0 transition-all duration-300 ${isFullscreen ? 'fixed inset-0 z-50 bg-[#0B1120] p-6' : ''}`}>\r\n            {/* TOOLBAR */}\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n                <div className=\"relative w-72 group\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search students...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-1.5 bg-slate-900/50 border border-white/5 rounded-xl text-xs text-white placeholder-slate-600 focus:outline-none focus:border-indigo-500/50 focus:bg-slate-900 transition-all\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={() => setIsFullscreen(!isFullscreen)}\r\n                        className=\"flex items-center gap-2 px-3 py-1.5 bg-slate-900/50 border border-white/5 rounded-lg text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800 transition-colors\"\r\n                        title={isFullscreen ? \"Exit Fullscreen\" : \"Enter Fullscreen\"}\r\n                    >\r\n                        {isFullscreen ? <Minimize2 size={14} /> : <Maximize2 size={14} />}\r\n                        {isFullscreen ? 'Exit' : 'Fullscreen'}\r\n                    </button>\r\n                    <div className=\"h-4 w-px bg-white/10 mx-2\"></div>\r\n                    <span className=\"text-xs text-slate-500 font-mono\">\r\n                        {students.length} Total\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* TABLE CONTAINER - NATIVE */}\r\n            <div className=\"flex-1 min-h-0\">\r\n                <div className=\"overflow-x-auto overflow-y-auto h-full scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent pr-6\">\r\n                    <table className=\"w-full text-left text-sm border-separate border-spacing-y-2\">\r\n\r\n                        {/* HEADER */}\r\n                        {/* HEADER */}\r\n                        {/* HEADER - BAR 1 */}\r\n                        <thead className=\"sticky top-0 z-30 text-[11px] font-bold uppercase tracking-[0.15em] text-slate-300 shadow-sm\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4 bg-slate-900 border-y border-l border-white/10 first:rounded-l-[14px] border-r-0 text-left\">Student</th>\r\n                                <th className=\"px-6 py-4 bg-slate-900 border-y border-white/10 text-center border-l-0 border-r-0\">Status</th>\r\n                                <th className=\"px-6 py-4 bg-slate-900 border-y border-white/10 text-center border-l-0 border-r-0\">Study State</th>\r\n                                <th className=\"px-6 py-4 bg-slate-900 border-y border-white/10 text-center border-l-0 border-r-0\">Joined</th>\r\n                                <th className=\"px-6 py-4 bg-slate-900 border-y border-r border-white/10 text-center last:rounded-r-[14px] border-l-0\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n\r\n                        {/* BODY */}\r\n                        <tbody className=\"\">\r\n                            {adminError ? (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-12 text-center text-red-500\">\r\n                                        Error: {adminError}\r\n                                    </td>\r\n                                </tr>\r\n                            ) : filteredStudents.length > 0 ? (\r\n                                (() => {\r\n                                    // Grouping Logic (Strict 7-Tier)\r\n                                    const groups: Record<number, any[]> = { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] };\r\n                                    filteredStudents.forEach(s => {\r\n                                        const rank = (s as any).sortRank || 7;\r\n                                        if (!groups[rank]) groups[rank] = [];\r\n                                        groups[rank].push(s);\r\n                                    });\r\n\r\n                                    const labels: Record<number, string> = {\r\n                                        1: 'Online & In Session',\r\n                                        2: 'Online (No Session)',\r\n                                        3: 'Background (In Session)',\r\n                                        4: 'Background (No Session)',\r\n                                        5: 'Offline (In Session)', // PURPLE\r\n                                        6: 'Offline (Recent)',\r\n                                        7: 'Inactive (>7 Days)'\r\n                                    };\r\n\r\n                                    return Object.keys(groups).sort().map(rankKey => {\r\n                                        const rank = parseInt(rankKey);\r\n                                        const studentsInGroup = groups[rank];\r\n\r\n                                        if (studentsInGroup.length === 0 && rank !== 7) return null;\r\n\r\n                                        return (\r\n                                            <Fragment key={`group-${rank}`}>\r\n                                                {/* SECTION HEADER */}\r\n                                                <tr key={`header-${rank}`} className=\"sticky top-[47px] z-20\">\r\n                                                    <td colSpan={5} className=\"py-0\">\r\n                                                        <div className=\"bg-[#0B1120] py-2\">\r\n                                                            {(() => {\r\n                                                                const glowMap: Record<number, string> = {\r\n                                                                    1: 'shadow-[0_0_20px_-5px_rgba(16,185,129,0.2)] border-emerald-500/10', // Green\r\n                                                                    2: 'shadow-[0_0_20px_-5px_rgba(16,185,129,0.2)] border-emerald-500/10', // Green\r\n                                                                    3: 'shadow-[0_0_20px_-5px_rgba(59,130,246,0.2)] border-blue-500/10',    // Blue\r\n                                                                    4: 'shadow-[0_0_20px_-5px_rgba(59,130,246,0.2)] border-blue-500/10',    // Blue\r\n                                                                    5: 'shadow-[0_0_20px_-5px_rgba(139,92,246,0.3)] border-purple-500/20',  // PURPLE\r\n                                                                    6: 'shadow-[0_0_20px_-5px_rgba(148,163,184,0.1)] border-white/5',       // Gray\r\n                                                                    7: 'shadow-[0_0_20px_-5px_rgba(239,68,68,0.2)] border-red-500/10'       // Red (Inactive)\r\n                                                                };\r\n\r\n                                                                const dotStyles: Record<number, string> = {\r\n                                                                    1: 'from-emerald-300 to-emerald-600 shadow-[0_0_8px_rgba(16,185,129,0.4)]',\r\n                                                                    2: 'from-emerald-300 to-emerald-600 shadow-[0_0_8px_rgba(16,185,129,0.4)]',\r\n                                                                    3: 'from-blue-300 to-blue-600 shadow-[0_0_8px_rgba(59,130,246,0.4)]',\r\n                                                                    4: 'from-blue-300 to-blue-600 shadow-[0_0_8px_rgba(59,130,246,0.4)]',\r\n                                                                    5: 'from-purple-300 to-purple-600 shadow-[0_0_8px_rgba(139,92,246,0.5)]',\r\n                                                                    6: 'from-slate-400 to-slate-700 shadow-[0_0_8px_rgba(148,163,184,0.2)]',\r\n                                                                    7: 'from-red-300 to-red-600 shadow-[0_0_8px_rgba(239,68,68,0.4)]' // Red\r\n                                                                };\r\n\r\n                                                                return (\r\n                                                                    <div className={`inline-flex items-center gap-3 px-5 py-2 bg-slate-900/90 border rounded-full backdrop-blur-md transition-all duration-500 ${glowMap[rank] || 'border-white/5'}`}>\r\n                                                                        {/* 3D DOT ICON */}\r\n                                                                        <div className={`w-2.5 h-2.5 rounded-full bg-gradient-to-b shadow-sm ${dotStyles[rank]} ring-1 ring-white/20`} />\r\n\r\n                                                                        <span className=\"text-[11px] font-bold text-slate-200 uppercase tracking-widest\">\r\n                                                                            {labels[rank]}\r\n                                                                        </span>\r\n                                                                        <span className=\"text-[10px] font-mono text-slate-500\">({studentsInGroup.length})</span>\r\n                                                                    </div>\r\n                                                                );\r\n                                                            })()}\r\n                                                        </div>\r\n                                                    </td>\r\n                                                </tr>\r\n\r\n                                                {/* EMPTY STATE FOR INACTIVE GROUP */}\r\n                                                {rank === 6 && studentsInGroup.length === 0 && (\r\n                                                    <tr className=\"bg-slate-900/30\">\r\n                                                        <td colSpan={5} className=\"px-6 py-4 text-xs text-slate-500 italic text-center\">\r\n                                                            No inactive students\r\n                                                        </td>\r\n                                                    </tr>\r\n                                                )}\r\n\r\n                                                {/* ROWS */}\r\n                                                {studentsInGroup.map((student) => {\r\n                                                    const presence = (student as any).presence || { status: 'offline' };\r\n                                                    const study = (student as any).study || { mode: 'none' };\r\n                                                    const isOnline = presence.status === 'online' || presence.status === 'background';\r\n\r\n                                                    return (\r\n                                                        <tr\r\n                                                            key={student.id}\r\n                                                            className=\"group relative cursor-pointer hover:scale-[1.002] transition-transform duration-200\"\r\n                                                            onClick={() => selectStudent(student)}\r\n                                                        >\r\n\r\n\r\n                                                            <td className=\"px-6 py-4 bg-[#0f1523] first:rounded-l-[16px] last:rounded-r-[16px] border-y border-white/[0.04] first:border-l last:border-r group-hover:bg-[#151b2b] group-hover:border-white/[0.08] transition-colors\">\r\n                                                                <div className=\"flex items-center gap-4\">\r\n                                                                    <div className=\"relative shrink-0\">\r\n                                                                        <div className=\"w-[42px] h-[42px] rounded-full bg-slate-800 shadow-inner ring-1 ring-white/10 flex items-center justify-center text-sm font-bold text-slate-400\">\r\n                                                                            {(student.fullName || student.email || '?').charAt(0).toUpperCase()}\r\n                                                                        </div>\r\n                                                                        {/* AVATAR STATUS DOT */}\r\n                                                                        {(() => {\r\n                                                                            // STRICT PRESENCE DOT COLOR (From AdminMetricsService)\r\n                                                                            // Values: 'green' | 'blue' | 'red' | 'gray'\r\n                                                                            const color = (student as any).dotColor || 'gray';\r\n                                                                            let dotClass = 'bg-slate-500 shadow-sm';\r\n\r\n                                                                            if (color === 'green') dotClass = 'bg-[#22c55e] shadow-[0_0_10px_rgba(34,197,94,0.6)] ring-2 ring-[#0B1120]';       // Online\r\n                                                                            else if (color === 'blue') dotClass = 'bg-[#3b82f6] shadow-[0_0_10px_rgba(59,130,246,0.6)] ring-2 ring-[#0B1120]';  // Background\r\n                                                                            else if (color === 'purple') dotClass = 'bg-[#a855f7] shadow-[0_0_10px_rgba(168,85,247,0.6)] ring-2 ring-[#0B1120]'; // Offline In Session\r\n                                                                            else if (color === 'red') dotClass = 'bg-[#ef4444] shadow-[0_0_10px_rgba(239,68,68,0.6)] ring-2 ring-[#0B1120]';   // Inactive\r\n                                                                            else dotClass = 'bg-slate-500 border-2 border-[#0B1120]';                                                       // Offline/Gray\r\n\r\n                                                                            return (\r\n                                                                                <div className={`absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full ${dotClass}`}></div>\r\n                                                                            );\r\n                                                                        })()}\r\n                                                                    </div>\r\n                                                                    <div className=\"flex flex-col justify-center\">\r\n                                                                        {student.fullName ? (\r\n                                                                            <span className=\"text-sm font-semibold text-slate-200 group-hover:text-white transition-colors\">\r\n                                                                                {student.fullName}\r\n                                                                            </span>\r\n                                                                        ) : (\r\n                                                                            <span className=\"text-xs font-semibold text-amber-500 flex items-center gap-1.5 animate-pulse\">\r\n                                                                                <AlertTriangle size={12} /> Profile Incomplete\r\n                                                                            </span>\r\n                                                                        )}\r\n                                                                        <span className=\"text-[11px] text-slate-500 group-hover:text-slate-400 font-mono mt-0.5 truncate max-w-[180px]\">\r\n                                                                            {student.email}\r\n                                                                        </span>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                            </td>\r\n\r\n                                                            {/* COL 1: PRESENCE */}\r\n                                                            <td className=\"px-6 py-4 text-center bg-[#0f1523] first:rounded-l-[16px] last:rounded-r-[16px] border-y border-white/[0.04] first:border-l last:border-r group-hover:bg-[#151b2b] group-hover:border-white/[0.08] transition-colors\">\r\n                                                                {(() => {\r\n                                                                    switch (presence.status) {\r\n                                                                        case 'online':\r\n                                                                            return (\r\n                                                                                <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-semibold bg-[#1e293b] text-emerald-400 border border-emerald-500/20 shadow-sm\">\r\n                                                                                    <div className=\"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_6px_rgba(52,211,153,0.5)]\"></div> Online\r\n                                                                                </span>\r\n                                                                            );\r\n                                                                        case 'background':\r\n                                                                            return (\r\n                                                                                <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-semibold bg-[#1e293b] text-blue-400 border border-blue-500/20 shadow-sm\">\r\n                                                                                    <AlertTriangle size={12} strokeWidth={2.5} /> Background\r\n                                                                                </span>\r\n                                                                            );\r\n                                                                        default:\r\n                                                                            const seenText = (student as any).lastSeenText ? `  ${(student as any).lastSeenText}` : '';\r\n                                                                            return (\r\n                                                                                <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-medium bg-[#1e293b] text-slate-500 border border-white/[0.05]\">\r\n                                                                                    Offline{seenText}\r\n                                                                                </span>\r\n                                                                            );\r\n                                                                    }\r\n                                                                })()}\r\n                                                            </td>\r\n\r\n                                                            {/* COL 2: STUDY STATE */}\r\n                                                            {/* COL 2: STUDY STATE */}\r\n                                                            <td className=\"px-6 py-4 text-center bg-[#0f1523] first:rounded-l-[16px] last:rounded-r-[16px] border-y border-white/[0.04] first:border-l last:border-r group-hover:bg-[#151b2b] group-hover:border-white/[0.08] transition-colors\">\r\n                                                                {(() => {\r\n                                                                    // STRICT RULE: \"No Session\" vs \"In Session\"\r\n                                                                    // Logic comes purely from study.mode ('in_session' | 'no_session')\r\n\r\n                                                                    if (study.mode === 'in_session') {\r\n                                                                        // Check for Zombie/Expired Sessions (>12h)\r\n                                                                        const startTime = (study as any).startTime || (presence as any).lastSeen || (presence as any).lastSeenAt;\r\n                                                                        if (startTime) {\r\n                                                                            const diff = Date.now() - new Date(startTime).getTime();\r\n                                                                            const hours = diff / (1000 * 60 * 60);\r\n                                                                            if (hours > 12) {\r\n                                                                                return (\r\n                                                                                    <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-bold bg-[#1e293b] text-red-400 border border-red-500/20 shadow-sm animate-pulse\">\r\n                                                                                        <AlertTriangle size={12} strokeWidth={2.5} /> Expired ({Math.floor(hours)}h)\r\n                                                                                    </span>\r\n                                                                                );\r\n                                                                            }\r\n                                                                        }\r\n                                                                        return (\r\n                                                                            <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[11px] font-bold bg-[#1e293b] text-indigo-300 border border-indigo-500/20 shadow-sm shadow-indigo-500/10\">\r\n                                                                                <Clock size={12} strokeWidth={2.5} /> In Session\r\n                                                                            </span>\r\n                                                                        );\r\n                                                                    }\r\n\r\n                                                                    // FALLBACK: No Session (Explicitly Empty per Rule 1)\r\n                                                                    // \"Study State = EMPTY (no text, no badge)\"\r\n                                                                    return null;\r\n                                                                })()}\r\n                                                            </td>\r\n                                                            <td className=\"px-6 py-4 text-center bg-[#0f1523] first:rounded-l-[16px] last:rounded-r-[16px] border-y border-white/[0.04] first:border-l last:border-r group-hover:bg-[#151b2b] group-hover:border-white/[0.08] transition-colors text-slate-500 font-mono text-xs\" suppressHydrationWarning>\r\n                                                                {student.createdAt ? new Date(student.createdAt).toISOString().split('T')[0] : \"-\"}\r\n                                                            </td>\r\n                                                            <td className=\"px-6 py-4 text-center bg-[#0f1523] first:rounded-l-[16px] last:rounded-r-[16px] border-y border-white/[0.04] first:border-l last:border-r group-hover:bg-[#151b2b] group-hover:border-white/[0.08] transition-colors rounded-r-[16px]\">\r\n                                                                <button className=\"p-2 rounded-lg text-slate-500 hover:text-white hover:bg-white/10 transition-colors\">\r\n                                                                    <MoreHorizontal size={18} />\r\n                                                                </button>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    );\r\n                                                })}\r\n                                            </Fragment>\r\n                                        );\r\n                                    });\r\n                                })()\r\n                            ) : (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-12 text-center text-slate-500\">\r\n                                        <div className=\"flex flex-col items-center gap-3\">\r\n                                            <div className=\"p-3 rounded-full bg-slate-900/50 border border-white/5\">\r\n                                                <User className=\"opacity-20\" size={24} />\r\n                                            </div>\r\n                                            <p>No students found matching your search.</p>\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4090, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/AdminService.ts"],"sourcesContent":["import {\r\n    collectionGroup,\r\n    getDocs,\r\n    query,\r\n    collection,\r\n    deleteDoc,\r\n    doc,\r\n    writeBatch,\r\n    updateDoc\r\n} from 'firebase/firestore';\r\nimport { ref, set, update } from 'firebase/database';\r\nimport { getFirestoreInstance, getDatabaseInstance, getAuthInstance } from './firebase'; // Singleton Import\r\nimport { getApp } from 'firebase/app';\r\nimport { UserProfile } from '@/core/types';\r\n\r\n// --- HELPER: AUTH HEADERS ---\r\nconst getAuthHeaders = async () => {\r\n    const auth = getAuthInstance();\r\n    if (!auth || !auth.currentUser) {\r\n        throw new Error(\"Unauthorized: No active admin session.\");\r\n    }\r\n    const token = await auth.currentUser.getIdToken(true); // Force refresh to ensure claims are up to date\r\n    return {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${token}`\r\n    };\r\n};\r\n\r\nexport const AdminService = {\r\n    getAllStudents: async (): Promise<{ students: UserProfile[], error: string | null }> => {\r\n        try {\r\n            console.warn(\"--- ADMIN SERVICE: START FETCH ---\");\r\n            const db = getFirestoreInstance();\r\n            const app = getApp();\r\n\r\n            if (!db) {\r\n                return { students: [], error: \"Firestore Instance Missing\" };\r\n            }\r\n\r\n            console.warn(`[AdminService] Target Project ID: ${app.options.projectId}`);\r\n\r\n            // 1. Query Collection Group 'profile'\r\n            const profilesQuery = query(collectionGroup(db, 'profile'));\r\n            const snapshot = await getDocs(profilesQuery);\r\n\r\n            console.warn(`[AdminService] Raw Snapshot Size: ${snapshot.size}`);\r\n\r\n            if (snapshot.empty) {\r\n                return { students: [], error: null }; // Valid empty state\r\n            }\r\n\r\n            const allUsers: UserProfile[] = [];\r\n\r\n            snapshot.forEach(doc => {\r\n                const data = doc.data();\r\n                // Parent of 'profile' collection is 'users/{uid}' doc. \r\n                const uid = doc.ref.parent.parent?.id;\r\n\r\n                if (uid && data) {\r\n                    const rawRole = data.role as string | undefined;\r\n                    const normalizedRole = rawRole ? rawRole.toUpperCase() : 'STUDENT';\r\n\r\n                    const profile = {\r\n                        id: uid,\r\n                        email: data.email || 'No email on record',\r\n                        name: data.fullName || data.name || 'Unknown Student',\r\n                        role: normalizedRole,\r\n                        academicYear: data.academicYear,\r\n                        completed: data.completed || false,\r\n                        createdAt: data.createdAt || data.updatedAt || new Date().toISOString(),\r\n                        fullName: data.fullName,\r\n                    } as any;\r\n\r\n                    allUsers.push(profile);\r\n                }\r\n            });\r\n\r\n            // Exclude Admins\r\n            const students = allUsers\r\n                .filter(u => u.role !== 'ADMIN')\r\n                .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n\r\n            console.warn(`[AdminService] Returning ${students.length} students.`);\r\n            return { students, error: null };\r\n\r\n        } catch (error: any) {\r\n            console.error(\"[AdminService] CRITICAL ERROR:\", error);\r\n            let errorMessage = \"Unknown Error\";\r\n\r\n            if (error?.code === 'permission-denied') {\r\n                errorMessage = \"PERMISSION DENIED: Security Rules blocked access. ensuring rules are deployed.\";\r\n            } else {\r\n                errorMessage = error.message || \"Failed to fetch data\";\r\n            }\r\n\r\n            return { students: [], error: errorMessage };\r\n        }\r\n    },\r\n\r\n\r\n    // --- DANGEROUS ACTIONS (VIA SECURE API) ---\r\n\r\n    // 1. DELETE STUDENT (HARD DELETE)\r\n    deleteStudent: async (uid: string): Promise<{ success: boolean; error?: string }> => {\r\n        try {\r\n            console.warn(`[AdminService] DELETING STUDENT (VIA API): ${uid}`);\r\n            const headers = await getAuthHeaders();\r\n            const response = await fetch('/api/admin/actions', {\r\n                method: 'POST',\r\n                headers,\r\n                body: JSON.stringify({ action: 'DELETE_STUDENT', uid })\r\n            });\r\n            const result = await response.json();\r\n            if (!result.success) throw new Error(result.error);\r\n\r\n            return { success: true };\r\n        } catch (e: any) {\r\n            console.error(\"DELETE FAILED\", e);\r\n            return { success: false, error: e.message };\r\n        }\r\n    },\r\n\r\n    // 2. RESET STUDENT (SOFT RESET)\r\n    resetStudent: async (uid: string): Promise<{ success: boolean; error?: string }> => {\r\n        try {\r\n            console.warn(`[AdminService] RESETTING STUDENT (VIA API): ${uid}`);\r\n            const headers = await getAuthHeaders();\r\n            const response = await fetch('/api/admin/actions', {\r\n                method: 'POST',\r\n                headers,\r\n                body: JSON.stringify({ action: 'RESET_STUDENT', uid })\r\n            });\r\n            const result = await response.json();\r\n            if (!result.success) throw new Error(result.error);\r\n\r\n            return { success: true };\r\n        } catch (e: any) {\r\n            console.error(\"RESET FAILED\", e);\r\n            return { success: false, error: e.message };\r\n        }\r\n    },\r\n\r\n    // 3. FORCE END SESSION\r\n    forceEndSession: async (uid: string): Promise<{ success: boolean; error?: string }> => {\r\n        try {\r\n            console.warn(`[AdminService] FORCE END SESSION (VIA API): ${uid}`);\r\n            const headers = await getAuthHeaders();\r\n            const response = await fetch('/api/admin/actions', {\r\n                method: 'POST',\r\n                headers,\r\n                body: JSON.stringify({ action: 'FORCE_END_SESSION', uid })\r\n            });\r\n            const result = await response.json();\r\n            if (!result.success) throw new Error(result.error);\r\n\r\n            return { success: true };\r\n        } catch (e: any) {\r\n            console.error(\"FORCE END FAILED\", e);\r\n            return { success: false, error: e.message };\r\n        }\r\n    }\r\n};\r\n\r\n// (Helper moved to top)\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAWA,qOAAyF,mBAAmB;AAC5G;AAAA;;;;AAGA,+BAA+B;AAC/B,MAAM,iBAAiB;IACnB,MAAM,OAAO,IAAA,sJAAe;IAC5B,IAAI,CAAC,QAAQ,CAAC,KAAK,WAAW,EAAE;QAC5B,MAAM,IAAI,MAAM;IACpB;IACA,MAAM,QAAQ,MAAM,KAAK,WAAW,CAAC,UAAU,CAAC,OAAO,gDAAgD;IACvG,OAAO;QACH,gBAAgB;QAChB,iBAAiB,CAAC,OAAO,EAAE,OAAO;IACtC;AACJ;AAEO,MAAM,eAAe;IACxB,gBAAgB;QACZ,IAAI;YACA,QAAQ,IAAI,CAAC;YACb,MAAM,KAAK,IAAA,2JAAoB;YAC/B,MAAM,MAAM,IAAA,0KAAM;YAElB,IAAI,CAAC,IAAI;gBACL,OAAO;oBAAE,UAAU,EAAE;oBAAE,OAAO;gBAA6B;YAC/D;YAEA,QAAQ,IAAI,CAAC,CAAC,kCAAkC,EAAE,IAAI,OAAO,CAAC,SAAS,EAAE;YAEzE,sCAAsC;YACtC,MAAM,gBAAgB,IAAA,0KAAK,EAAC,IAAA,oLAAe,EAAC,IAAI;YAChD,MAAM,WAAW,MAAM,IAAA,4KAAO,EAAC;YAE/B,QAAQ,IAAI,CAAC,CAAC,kCAAkC,EAAE,SAAS,IAAI,EAAE;YAEjE,IAAI,SAAS,KAAK,EAAE;gBAChB,OAAO;oBAAE,UAAU,EAAE;oBAAE,OAAO;gBAAK,GAAG,oBAAoB;YAC9D;YAEA,MAAM,WAA0B,EAAE;YAElC,SAAS,OAAO,CAAC,CAAA;gBACb,MAAM,OAAO,IAAI,IAAI;gBACrB,wDAAwD;gBACxD,MAAM,MAAM,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE;gBAEnC,IAAI,OAAO,MAAM;oBACb,MAAM,UAAU,KAAK,IAAI;oBACzB,MAAM,iBAAiB,UAAU,QAAQ,WAAW,KAAK;oBAEzD,MAAM,UAAU;wBACZ,IAAI;wBACJ,OAAO,KAAK,KAAK,IAAI;wBACrB,MAAM,KAAK,QAAQ,IAAI,KAAK,IAAI,IAAI;wBACpC,MAAM;wBACN,cAAc,KAAK,YAAY;wBAC/B,WAAW,KAAK,SAAS,IAAI;wBAC7B,WAAW,KAAK,SAAS,IAAI,KAAK,SAAS,IAAI,IAAI,OAAO,WAAW;wBACrE,UAAU,KAAK,QAAQ;oBAC3B;oBAEA,SAAS,IAAI,CAAC;gBAClB;YACJ;YAEA,iBAAiB;YACjB,MAAM,WAAW,SACZ,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,SACvB,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;YAEnF,QAAQ,IAAI,CAAC,CAAC,yBAAyB,EAAE,SAAS,MAAM,CAAC,UAAU,CAAC;YACpE,OAAO;gBAAE;gBAAU,OAAO;YAAK;QAEnC,EAAE,OAAO,OAAY;YACjB,QAAQ,KAAK,CAAC,kCAAkC;YAChD,IAAI,eAAe;YAEnB,IAAI,OAAO,SAAS,qBAAqB;gBACrC,eAAe;YACnB,OAAO;gBACH,eAAe,MAAM,OAAO,IAAI;YACpC;YAEA,OAAO;gBAAE,UAAU,EAAE;gBAAE,OAAO;YAAa;QAC/C;IACJ;IAGA,6CAA6C;IAE7C,kCAAkC;IAClC,eAAe,OAAO;QAClB,IAAI;YACA,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,KAAK;YAChE,MAAM,UAAU,MAAM;YACtB,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBAC/C,QAAQ;gBACR;gBACA,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;oBAAkB;gBAAI;YACzD;YACA,MAAM,SAAS,MAAM,SAAS,IAAI;YAClC,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;YAEjD,OAAO;gBAAE,SAAS;YAAK;QAC3B,EAAE,OAAO,GAAQ;YACb,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO;gBAAE,SAAS;gBAAO,OAAO,EAAE,OAAO;YAAC;QAC9C;IACJ;IAEA,gCAAgC;IAChC,cAAc,OAAO;QACjB,IAAI;YACA,QAAQ,IAAI,CAAC,CAAC,4CAA4C,EAAE,KAAK;YACjE,MAAM,UAAU,MAAM;YACtB,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBAC/C,QAAQ;gBACR;gBACA,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;oBAAiB;gBAAI;YACxD;YACA,MAAM,SAAS,MAAM,SAAS,IAAI;YAClC,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;YAEjD,OAAO;gBAAE,SAAS;YAAK;QAC3B,EAAE,OAAO,GAAQ;YACb,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,OAAO;gBAAE,SAAS;gBAAO,OAAO,EAAE,OAAO;YAAC;QAC9C;IACJ;IAEA,uBAAuB;IACvB,iBAAiB,OAAO;QACpB,IAAI;YACA,QAAQ,IAAI,CAAC,CAAC,4CAA4C,EAAE,KAAK;YACjE,MAAM,UAAU,MAAM;YACtB,MAAM,WAAW,MAAM,MAAM,sBAAsB;gBAC/C,QAAQ;gBACR;gBACA,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;oBAAqB;gBAAI;YAC5D;YACA,MAAM,SAAS,MAAM,SAAS,IAAI;YAClC,IAAI,CAAC,OAAO,OAAO,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;YAEjD,OAAO;gBAAE,SAAS;YAAK;QAC3B,EAAE,OAAO,GAAQ;YACb,QAAQ,KAAK,CAAC,oBAAoB;YAClC,OAAO;gBAAE,SAAS;gBAAO,OAAO,EAAE,OAAO;YAAC;QAC9C;IACJ;AACJ,GAEA,wBAAwB"}},
    {"offset": {"line": 4263, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/admin/StudentInspector.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { UserProfile } from '@/core/types';\r\nimport { X, Calendar, User, Clock, Shield, CheckCircle2, AlertCircle, AlertTriangle, PlayCircle, StopCircle, RefreshCcw, Trash2 } from 'lucide-react';\r\nimport { AdminService } from '@/core/services/AdminService';\r\n\r\ninterface StudentInspectorProps {\r\n    student: UserProfile | null;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const StudentInspector = ({ student, onClose }: StudentInspectorProps) => {\r\n    const [confirmModal, setConfirmModal] = useState<{\r\n        open: boolean;\r\n        type: 'FORCE_END' | 'RESET' | 'DELETE' | null;\r\n        action?: () => Promise<void>;\r\n    }>({ open: false, type: null });\r\n\r\n    const handleAction = async () => {\r\n        if (!confirmModal.action) return;\r\n        await confirmModal.action();\r\n        setConfirmModal({ ...confirmModal, open: false });\r\n        onClose(); // Close inspector after drastic action (optional, but cleaner for Delete/Reset)\r\n    };\r\n\r\n    // ACTION HANDLERS\r\n    const requestForceEnd = () => {\r\n        setConfirmModal({\r\n            open: true,\r\n            type: 'FORCE_END',\r\n            action: async () => {\r\n                if (student?.id) await AdminService.forceEndSession(student.id);\r\n            }\r\n        });\r\n    };\r\n\r\n    const requestReset = () => {\r\n        setConfirmModal({\r\n            open: true,\r\n            type: 'RESET',\r\n            action: async () => {\r\n                if (student?.id) await AdminService.resetStudent(student.id);\r\n            }\r\n        });\r\n    };\r\n\r\n    const requestDelete = () => {\r\n        setConfirmModal({\r\n            open: true,\r\n            type: 'DELETE',\r\n            action: async () => {\r\n                if (student?.id) await AdminService.deleteStudent(student.id);\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {student && (\r\n                <>\r\n                    {/* BACKDROP */}\r\n                    <motion.div\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={onClose}\r\n                        className=\"fixed inset-0 bg-slate-950/60 backdrop-blur-sm z-[9999]\"\r\n                    />\r\n\r\n                    {/* SLIDE-OVER PANEL */}\r\n                    <motion.div\r\n                        initial={{ x: '100%' }}\r\n                        animate={{ x: 0 }}\r\n                        exit={{ x: '100%' }}\r\n                        transition={{ type: 'spring', damping: 25, stiffness: 200 }}\r\n                        className=\"fixed inset-y-0 right-0 z-[10000] w-full max-w-md bg-[#0F172A] border-l border-white/5 shadow-2xl overflow-y-auto scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent flex flex-col\"\r\n                    >\r\n                        {/* HEADER */}\r\n                        <div className=\"sticky top-0 z-10 flex items-center justify-between px-6 py-5 bg-[#0F172A]/90 backdrop-blur-md border-b border-white/5\">\r\n                            <h2 className=\"text-lg font-semibold text-slate-100 flex items-center gap-2\">\r\n                                <span className={`w-2 h-2 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)] ${student.study?.sessionActive ? 'bg-indigo-500 shadow-indigo-500/50' : 'bg-emerald-500'}`}></span>\r\n                                Student Profile\r\n                            </h2>\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"p-2 text-slate-400 hover:text-white transition-colors rounded-full hover:bg-white/5\"\r\n                            >\r\n                                <X size={20} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* CONTENT */}\r\n                        <div className=\"p-6 space-y-8 flex-1\">\r\n\r\n                            {/* IDENTITY SECTION */}\r\n                            <div className=\"flex flex-col items-center text-center space-y-3 pb-6 border-b border-white/5\">\r\n                                <div className=\"w-20 h-20 rounded-full bg-gradient-to-tr from-indigo-500 to-violet-500 flex items-center justify-center text-2xl font-bold text-white shadow-lg relative\">\r\n                                    {student.name?.charAt(0)?.toUpperCase() || '?'}\r\n                                    {/* Presence Dot */}\r\n                                    <div className={`absolute bottom-0 right-0 w-5 h-5 rounded-full border-4 border-[#0F172A] ${(student as any).dotColor === 'green' ? 'bg-emerald-500' : (student as any).dotColor === 'blue' ? 'bg-blue-500' : (student as any).dotColor === 'purple' ? 'bg-purple-500' : (student as any).dotColor === 'red' ? 'bg-red-500' : 'bg-slate-500'}`}></div>\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-xl font-semibold text-white\">{student.name}</h3>\r\n                                    <p className=\"text-sm text-slate-400\">{student.email}</p>\r\n                                </div>\r\n                                <span className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-indigo-500/10 text-indigo-400 border border-indigo-500/20\">\r\n                                    <Shield size={12} />\r\n                                    {student.role}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* ACTIVE SESSION CONTROL (SECTION 3) */}\r\n                            {student.study?.sessionActive ? (\r\n                                <div className=\"p-4 rounded-xl bg-indigo-500/10 border border-indigo-500/20 space-y-3\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2 text-indigo-400 font-bold text-sm\">\r\n                                            <PlayCircle size={16} className=\"animate-pulse\" />\r\n                                            Active Session\r\n                                        </div>\r\n                                        <div className=\"text-xs font-mono text-indigo-300/70\">\r\n                                            Running\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-1\">\r\n                                        <div className=\"text-sm font-medium text-white\">\r\n                                            {/* We rely on what we have in metadata or show generic */}\r\n                                            Study Session\r\n                                        </div>\r\n                                        {student.study.startTime && (\r\n                                            <div className=\"text-xs text-indigo-200/50\">\r\n                                                Started: {new Date(student.study.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={requestForceEnd}\r\n                                        className=\"w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-xs font-bold transition-all shadow-lg shadow-indigo-500/20 flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        <StopCircle size={14} />\r\n                                        Force End Session\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"p-4 rounded-xl bg-slate-900/50 border border-white/5 flex items-center justify-center text-slate-500 text-xs italic\">\r\n                                    No active session\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* ACADEMIC CONTEXT */}\r\n                            <div className=\"space-y-4\">\r\n                                <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-widest pl-1\">Academic Context</h4>\r\n                                <div className=\"grid grid-cols-2 gap-3\">\r\n                                    <div className=\"p-4 rounded-xl bg-slate-900/50 border border-white/5 flex flex-col gap-1\">\r\n                                        <span className=\"text-slate-500 text-xs flex items-center gap-1\"><Calendar size={12} /> Year</span>\r\n                                        <span className=\"text-slate-200 font-medium\">{student.academicYear || \"N/A\"}</span>\r\n                                    </div>\r\n                                    <div className=\"p-4 rounded-xl bg-slate-900/50 border border-white/5 flex flex-col gap-1\">\r\n                                        <span className=\"text-slate-500 text-xs flex items-center gap-1\"><CheckCircle2 size={12} /> Status</span>\r\n                                        <span className={student.completed ? \"text-emerald-400 font-medium\" : \"text-rose-400 font-medium\"}>\r\n                                            {student.completed ? \"Active\" : \"Incomplete\"}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* SYSTEM METADATA */}\r\n                            <div className=\"space-y-4\">\r\n                                <h4 className=\"text-xs font-bold text-slate-500 uppercase tracking-widest pl-1\">System Metadata</h4>\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center justify-between p-3 rounded-lg bg-slate-900/30 border border-white/5\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 rounded bg-slate-800 text-slate-400\"><User size={14} /></div>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-xs text-slate-500\">User ID</span>\r\n                                                <span className=\"text-xs font-mono text-slate-300\">{student.id}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center justify-between p-3 rounded-lg bg-slate-900/30 border border-white/5\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 rounded bg-slate-800 text-slate-400\"><Clock size={14} /></div>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-xs text-slate-500\">Joined</span>\r\n                                                <span className=\"text-xs text-slate-300\">\r\n                                                    {student.createdAt ? new Date(student.createdAt).toLocaleDateString() : \"Unknown\"}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* ACCOUNT CONTROL (SECTIONS 1 & 2) */}\r\n                            <div className=\"pt-8 mt-4 border-t border-white/5 space-y-3\">\r\n                                <h4 className=\"text-xs font-bold text-rose-500/50 uppercase tracking-widest pl-1 mb-4\">Danger Zone</h4>\r\n\r\n                                <button\r\n                                    onClick={requestReset}\r\n                                    className=\"w-full py-3 px-4 rounded-xl bg-amber-500/5 hover:bg-amber-500/10 text-amber-500 text-sm font-medium transition-colors border border-amber-500/20 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <RefreshCcw size={16} />\r\n                                    Reset Student Data\r\n                                </button>\r\n\r\n                                <button\r\n                                    onClick={requestDelete}\r\n                                    className=\"w-full py-3 px-4 rounded-xl bg-rose-500/10 hover:bg-rose-500/20 text-rose-500 text-sm font-bold transition-colors border border-rose-500/20 flex items-center justify-center gap-2\"\r\n                                >\r\n                                    <Trash2 size={16} />\r\n                                    Delete Account Permanently\r\n                                </button>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </motion.div>\r\n\r\n                    {/* CONFIRMATION MODAL */}\r\n                    {confirmModal.open && (\r\n                        <div className=\"fixed inset-0 z-[10001] flex items-center justify-center p-4\">\r\n                            <div className=\"absolute inset-0 bg-black/80 backdrop-blur-sm\" onClick={() => setConfirmModal({ ...confirmModal, open: false })} />\r\n                            <motion.div\r\n                                initial={{ opacity: 0, scale: 0.95 }}\r\n                                animate={{ opacity: 1, scale: 1 }}\r\n                                className=\"relative bg-[#0F172A] border border-white/10 rounded-2xl p-6 max-w-sm w-full shadow-2xl space-y-4\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3 text-white\">\r\n                                    <div className={`p-3 rounded-full ${confirmModal.type === 'DELETE' ? 'bg-rose-500/20 text-rose-500' : 'bg-amber-500/20 text-amber-500'}`}>\r\n                                        <AlertTriangle size={24} />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h3 className=\"font-bold text-lg\">\r\n                                            {confirmModal.type === 'DELETE' ? 'Delete Account' : confirmModal.type === 'RESET' ? 'Reset Data' : 'End Session'}\r\n                                        </h3>\r\n                                        <p className=\"text-xs text-slate-400\">Action Required</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <p className=\"text-sm text-slate-300 leading-relaxed\">\r\n                                    {confirmModal.type === 'DELETE'\r\n                                        ? \"Are you sure you want to permanently delete this account? This will wipe all Firestore and Realtime data. This action cannot be undone.\"\r\n                                        : confirmModal.type === 'RESET'\r\n                                            ? \"This will erase all study data, metrics, and progress, but preserve the account login. The student will start fresh.\"\r\n                                            : \"Are you sure you want to force end this active session? This will stop the timer immediately.\"\r\n                                    }\r\n                                </p>\r\n\r\n                                <div className=\"p-3 rounded-lg bg-slate-900 border border-white/5 space-y-1\">\r\n                                    <div className=\"text-xs text-slate-500\">Target User</div>\r\n                                    <div className=\"text-sm font-mono text-white\">{student.name}</div>\r\n                                    <div className=\"text-xs font-mono text-slate-500\">{student.email}</div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-3 pt-2\">\r\n                                    <button\r\n                                        onClick={() => setConfirmModal({ ...confirmModal, open: false })}\r\n                                        className=\"flex-1 py-2.5 rounded-lg bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium transition-colors\"\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={handleAction}\r\n                                        className={`flex-1 py-2.5 rounded-lg text-white text-sm font-bold transition-colors ${confirmModal.type === 'DELETE' ? 'bg-rose-600 hover:bg-rose-500' :\r\n                                                confirmModal.type === 'RESET' ? 'bg-amber-600 hover:bg-amber-500' :\r\n                                                    'bg-indigo-600 hover:bg-indigo-500'\r\n                                            }`}\r\n                                    >\r\n                                        {confirmModal.type === 'DELETE' ? 'Delete Permanently' : 'Confirm'}\r\n                                    </button>\r\n                                </div>\r\n                            </motion.div>\r\n                        </div>\r\n                    )}\r\n                </>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5040, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/AdminMetricsService.ts"],"sourcesContent":["import { getFirestoreInstance, getDatabaseInstance } from \"@/core/services/firebase\";\r\nimport { collectionGroup, onSnapshot, query, doc, setDoc } from \"firebase/firestore\";\r\nimport { ref, onValue } from \"firebase/database\";\r\n\r\n\r\n\r\nexport const AdminMetricsService = {\r\n    // --- DUAL LAYER AGGREGATION SERVICE ---\r\n    subscribeToDashboard: (callback: (data: {\r\n        students: any[], // Mapped to StudentMonitorData\r\n        total: number,\r\n        subscribed: number, // Legacy field, mostly ignored now\r\n        onlineCount: number,\r\n        stats: {\r\n            onlineCount: number,\r\n            inSessionCount: number,\r\n            backgroundStudyingCount: number,\r\n            offlineRecentCount: number,\r\n            inactiveCount: number\r\n        }\r\n    }) => void) => {\r\n        // 0. Lazy Initialization (Safe)\r\n        const db = getFirestoreInstance();\r\n        const dbRTDB = getDatabaseInstance();\r\n\r\n        if (!db) {\r\n            console.error(\"[AdminMetrics] Firestore Failed to Initialize - Check Auth/Network\");\r\n            return () => { }; // Return no-op cleanup\r\n        }\r\n\r\n        // 1. Static Query (Firestore)\r\n        const profilesQuery = query(collectionGroup(db, 'profile'));\r\n\r\n        // 2. Live Query (RTDB) (Already initialized above)\r\n\r\n        // 3. Maps (In-Memory Join)\r\n        let studentsMap = new Map<string, any>();\r\n        let liveStatusMap = new Map<string, any>();\r\n\r\n        // 4. Merging Logic\r\n        const emit = () => {\r\n            const combined: any[] = [];\r\n            let onlineCount = 0;\r\n            const NOW = Date.now();\r\n            const SEVEN_DAYS_MS = 7 * 24 * 60 * 60 * 1000;\r\n\r\n            studentsMap.forEach((rawProfile, uid) => {\r\n                const profile = rawProfile;\r\n\r\n                // --- 1. PARSE FIRESTORE DATA (Fallback & Profile) ---\r\n                let lastLoginMs = 0;\r\n                if (profile.lastLoginAt) {\r\n                    try {\r\n                        const val = profile.lastLoginAt;\r\n                        lastLoginMs = typeof val === 'string' ? new Date(val).getTime() : (val.seconds * 1000);\r\n                    } catch (e) { }\r\n                }\r\n\r\n                // --- 2. PARSE RTDB DATA (Live State) ---\r\n                const rtdbStatus = liveStatusMap.get(uid);\r\n\r\n                // Active Session Logic: Presence of object = In Session\r\n                const activeSessionData = rtdbStatus?.activeSession;\r\n                const isSessionActive = !!activeSessionData;\r\n\r\n                // Presence Logic:\r\n                let rawStatus = (rtdbStatus?.state || 'offline') as 'online' | 'background' | 'offline';\r\n\r\n                // LAST SEEN FALLBACK STRATEGY\r\n                // Priority: RTDB lastChanged > Firestore lastLoginAt\r\n                let effectiveLastSeen = rtdbStatus?.lastSeenAt || lastLoginMs;\r\n\r\n                // --- 3. SESSION-CENTRIC CLASSIFICATION (STRICT FINAL) ---\r\n\r\n                let finalMode = 'none';\r\n                let sortRank = 7;\r\n\r\n                // RULE 2: STUDY STATE IS SESSION-DRIVEN (No other factor)\r\n                // This is calculated independently of Presence Group for the \"Study State\" column\r\n                const strictStudyMode = isSessionActive ? 'in_session' : 'no_session';\r\n\r\n                // STATUS DEFINITIONS (STRICT 7-TIER)\r\n                if (isSessionActive) {\r\n                    // MUST BE IN SESSION (Study State = In Session)\r\n                    if (rawStatus === 'online') {\r\n                        // 1. Online & In Session\r\n                        finalMode = 'in_session';\r\n                        sortRank = 1;\r\n                    } else if (rawStatus === 'background') {\r\n                        // 3. Background (In Session)\r\n                        finalMode = 'background_session';\r\n                        sortRank = 3;\r\n                    } else {\r\n                        // 5. Offline In Session\r\n                        // (Disconnected but session not ended)\r\n                        finalMode = 'offline_session';\r\n                        sortRank = 5;\r\n                    }\r\n                } else {\r\n                    // NO SESSION (Study State = No Session)\r\n                    if (rawStatus === 'online') {\r\n                        // 2. Online & No Session\r\n                        finalMode = 'browsing';\r\n                        sortRank = 2;\r\n                    } else if (rawStatus === 'background') {\r\n                        // 4. Background (No Session)\r\n                        finalMode = 'idle';\r\n                        sortRank = 4;\r\n                    } else {\r\n                        // OFFLINE\r\n                        if (NOW - lastLoginMs > SEVEN_DAYS_MS) {\r\n                            // 7. Inactive (> 7 Days) - RED ALERT\r\n                            finalMode = 'inactive';\r\n                            sortRank = 7;\r\n                        } else {\r\n                            // 6. Offline (Recent)\r\n                            finalMode = 'offline_recent';\r\n                            sortRank = 6;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // SAFETY FALLBACK (MANDATORY per Issue 2)\r\n                if (!sortRank) {\r\n                    console.warn(`[AdminMetrics] User ${uid} fell through logic. Defaulting to Offline Recent.`);\r\n                    finalMode = 'offline_recent';\r\n                    sortRank = 6;\r\n                }\r\n\r\n                // --- AVATAR PRESENCE DOT Logic (STRICT SINGLE SOURCE OF TRUTH) ---\r\n                // RULE: SINGLE SOURCE OF TRUTH \"presenceState\"\r\n                // Values: 'ONLINE', 'BACKGROUND', 'OFFLINE_IN_SESSION', 'OFFLINE', 'INACTIVE'\r\n\r\n                let presenceDotStatus = 'OFFLINE'; // Default\r\n                let dotColor = 'gray';             // Default\r\n\r\n                if (rawStatus === 'online') {\r\n                    presenceDotStatus = 'ONLINE';\r\n                    dotColor = 'green';\r\n                } else if (rawStatus === 'background') {\r\n                    presenceDotStatus = 'BACKGROUND';\r\n                    dotColor = 'blue';\r\n                } else {\r\n                    // OFFLINE BRANCH\r\n\r\n                    // 1. Check for Active Session (Study State Priority)\r\n                    if (isSessionActive) {\r\n                        presenceDotStatus = 'OFFLINE_IN_SESSION';\r\n                        dotColor = 'purple'; // \"Studying without connection\"\r\n                    } else {\r\n                        // 2. Check for Inactivity\r\n                        if (NOW - lastLoginMs > SEVEN_DAYS_MS) {\r\n                            presenceDotStatus = 'INACTIVE';\r\n                            dotColor = 'red';\r\n                        } else {\r\n                            presenceDotStatus = 'OFFLINE';\r\n                            dotColor = 'gray'; // Offline Recent\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // VERIFICATION CHECK:\r\n                // If dotColor is not one of green, blue, red, gray -> Something wrong.\r\n                // But logic above guarantees it.\r\n\r\n                // --- 4. COUNTERS LOGIC ---\r\n                // Online = groups (1 + 2)\r\n                if (sortRank === 1 || sortRank === 2) onlineCount++;\r\n\r\n                // --- 5. LAST SEEN TEXT ---\r\n                let lastSeenText = '';\r\n                if (sortRank >= 5) { // Offline ranks\r\n                    if (effectiveLastSeen > 0) {\r\n                        const diff = NOW - effectiveLastSeen;\r\n                        if (diff < 60000) lastSeenText = 'Just now';\r\n                        else if (diff < 3600000) lastSeenText = `${Math.floor(diff / 60000)}m ago`;\r\n                        else if (diff < 86400000) lastSeenText = `${Math.floor(diff / 3600000)}h ago`;\r\n                        else lastSeenText = `${Math.floor(diff / 86400000)}d ago`;\r\n                    } else {\r\n                        lastSeenText = 'Never';\r\n                    }\r\n                }\r\n\r\n                // --- 6. DATA PREP ---\r\n                const studyState = {\r\n                    mode: strictStudyMode, // STRICT: 'in_session' | 'no_session'\r\n                    lastInteractionAt: effectiveLastSeen,\r\n                    sessionActive: isSessionActive,\r\n                    startTime: activeSessionData?.startedAt || null,\r\n                    sessionContext: activeSessionData ? {\r\n                        id: activeSessionData.sessionId,\r\n                        lectureId: activeSessionData.lectureId,\r\n                        subjectId: activeSessionData.subjectId\r\n                    } : null\r\n                };\r\n\r\n                const presenceState = {\r\n                    status: rawStatus,\r\n                    dotStatus: presenceDotStatus, // EXPOSED SOURCE OF TRUTH\r\n                    lastSeenAt: effectiveLastSeen,\r\n                    currentPage: rtdbStatus?.currentPage || null\r\n                };\r\n\r\n                // Sorting Timestamp:\r\n                // 1) activeSession.lastHeartbeat (Not tracked explicitly? use lastSeenAt if in session)\r\n                // 2) presence.lastSeenAt\r\n                // 3) profile.lastLoginAt\r\n                const sortTimestamp = effectiveLastSeen;\r\n\r\n                combined.push({\r\n                    ...profile,\r\n                    name: profile.fullName || profile.name || profile.onboardingName || \"User\",\r\n                    presence: presenceState,\r\n                    study: studyState,\r\n                    dotColor, // Derived from strict presenceDotStatus\r\n                    lastSeenText,\r\n                    sortRank,\r\n                    sortTimestamp // Validation helper\r\n                });\r\n            });\r\n\r\n            // --- FINAL SORT ---\r\n            // 1. Sort by Rank (Ascending)\r\n            // 2. Sort by Recency (Descending) inside Rank\r\n            combined.sort((a, b) => {\r\n                if (a.sortRank !== b.sortRank) return a.sortRank - b.sortRank;\r\n                return b.sortTimestamp - a.sortTimestamp;\r\n            });\r\n\r\n            // --- AGGREGATE METRICS ---\r\n            let stats = {\r\n                onlineCount: 0,\r\n                inSessionCount: 0,\r\n                backgroundStudyingCount: 0,\r\n                offlineRecentCount: 0,\r\n                inactiveCount: 0\r\n            };\r\n\r\n            combined.forEach(s => {\r\n                // Online = groups (1 + 2)\r\n                if (s.sortRank === 1 || s.sortRank === 2) stats.onlineCount++; // Double count check? No, onlineCount var above was local. \r\n\r\n                // Studying = groups (1)\r\n                if (s.sortRank === 1) stats.inSessionCount++;\r\n\r\n                // Focusing right now = groups (3 + 5) (Background/Offline but session active)\r\n                if (s.sortRank === 3 || s.sortRank === 5) stats.backgroundStudyingCount++;\r\n\r\n                // Inactive = group (7)\r\n                if (s.sortRank === 7) stats.inactiveCount++;\r\n\r\n                // Offline Recent (6)\r\n                if (s.sortRank === 6) stats.offlineRecentCount++;\r\n            });\r\n\r\n            callback({\r\n                students: combined, // Sorted by Rank\r\n                total: combined.length,\r\n                subscribed: 0,\r\n                onlineCount: stats.onlineCount,\r\n                stats\r\n            });\r\n        };\r\n\r\n        // 5. Subscriptions\r\n\r\n        // A. Firestore Profiles (Static)\r\n        const unsubProfiles = onSnapshot(profilesQuery, (snap) => {\r\n            snap.docs.forEach(doc => {\r\n                const uid = doc.ref.parent.parent?.id;\r\n                if (uid && doc.data().role !== 'ADMIN') {\r\n                    const d = doc.data();\r\n                    studentsMap.set(uid, { id: uid, ...d, name: d.fullName || d.name });\r\n                }\r\n            });\r\n            emit();\r\n        }, (error) => {\r\n            console.error(\"[AdminMetrics] PROFILES ERROR:\", error);\r\n        });\r\n\r\n        // B. RTDB Status (Live)\r\n        let refOffWrapper = () => { };\r\n        if (dbRTDB) {\r\n            const statusRef = ref(dbRTDB, 'status');\r\n            const onStatusChange = onValue(statusRef, (snap) => {\r\n                const val = snap.val();\r\n                if (val) {\r\n                    liveStatusMap.clear();\r\n                    Object.keys(val).forEach(uid => {\r\n                        liveStatusMap.set(uid, val[uid]);\r\n                    });\r\n                } else {\r\n                    liveStatusMap.clear();\r\n                }\r\n                emit();\r\n            });\r\n            refOffWrapper = () => onStatusChange();\r\n        }\r\n\r\n        // C. Heartbeat Re-evaluator (Updates \"time ago\" text)\r\n        const reval = setInterval(emit, 5000);\r\n\r\n        return () => {\r\n            clearInterval(reval);\r\n            unsubProfiles();\r\n            refOffWrapper();\r\n        };\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5308, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/admin/AdminLayout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useStore } from '@/store/useStore';\r\nimport { Users, BarChart3, Settings, Activity, GraduationCap, Clock, AlertTriangle } from 'lucide-react';\r\nimport { useState, useEffect } from 'react';\r\nimport { StudentsTable } from './StudentsTable';\r\nimport { StudentInspector } from './StudentInspector';\r\n\r\nimport { AdminMetricsService } from '@/core/services/AdminMetricsService';\r\nimport { UserProfileWithMeta } from '@/core/types';\r\n\r\nexport const AdminLayout = () => {\r\n    const { authState, selectedStudent, selectStudent } = useStore(); // Removed fetchStudents (handled by real-time service)\r\n    const [currentView, setCurrentView] = useState<'OVERVIEW' | 'STUDENTS' | 'SYSTEM'>('STUDENTS');\r\n\r\n    // Real-Time Dashboard State\r\n    const [dashboard, setDashboard] = useState({\r\n        students: [] as UserProfileWithMeta[],\r\n        total: 0,\r\n        subscribed: 0,\r\n        onlineCount: 0,\r\n        stats: {\r\n            onlineCount: 0,\r\n            inSessionCount: 0,\r\n            backgroundStudyingCount: 0,\r\n            offlineRecentCount: 0,\r\n            inactiveCount: 0\r\n        }\r\n    });\r\n\r\n    // Real-Time Subscription\r\n    useEffect(() => {\r\n        const unsub = AdminMetricsService.subscribeToDashboard((data) => {\r\n            setDashboard(data);\r\n        });\r\n        return () => unsub();\r\n    }, []);\r\n\r\n    // Navigation Items\r\n    const navItems = [\r\n        { id: 'OVERVIEW', label: 'Overview', icon: Activity },\r\n        { id: 'STUDENTS', label: 'Students', icon: Users },\r\n        { id: 'SYSTEM', label: 'System Health', icon: BarChart3 },\r\n    ];\r\n\r\n    return (\r\n        <div className=\"flex w-full h-screen bg-[#0B1120] text-white font-sans overflow-hidden\">\r\n\r\n            {/* 1. SIDEBAR (Glass) */}\r\n            <aside className=\"w-64 border-r border-white/5 bg-slate-950/50 backdrop-blur-xl flex flex-col z-20\">\r\n                {/* Brand */}\r\n                <div className=\"h-16 flex items-center px-6 border-b border-white/5\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center shadow-lg shadow-indigo-500/20\">\r\n                            <GraduationCap className=\"text-white w-5 h-5\" />\r\n                        </div>\r\n                        <h1 className=\"text-sm font-bold tracking-wide text-slate-100\">\r\n                            ACADEMIC<span className=\"text-indigo-400\">OS</span>\r\n                        </h1>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Nav */}\r\n                <nav className=\"flex-1 px-3 py-6 space-y-1\">\r\n                    {navItems.map(item => (\r\n                        <button\r\n                            key={item.id}\r\n                            onClick={() => setCurrentView(item.id as any)}\r\n                            className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${currentView === item.id\r\n                                ? 'bg-indigo-500/10 text-indigo-400 border border-indigo-500/10 shadow-[0_0_15px_rgba(99,102,241,0.1)]'\r\n                                : 'text-slate-400 hover:text-slate-200 hover:bg-white/5'\r\n                                }`}\r\n                        >\r\n                            <item.icon size={18} />\r\n                            {item.label}\r\n                        </button>\r\n                    ))}\r\n                </nav>\r\n\r\n                {/* User */}\r\n                <div className=\"p-4 border-t border-white/5\">\r\n                    <div className=\"flex items-center gap-3 px-2 py-2\">\r\n                        <div className=\"w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-slate-400\">\r\n                            {authState.user?.name?.charAt(0) || 'A'}\r\n                        </div>\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-xs font-medium text-slate-200\">Admin Console</span>\r\n                            <span className=\"text-[10px] text-slate-500 font-mono\">v1.0.2 Stable</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* 2. MAIN CONTENT */}\r\n            <main className=\"flex-1 flex flex-col min-w-0 bg-[#0B1120] relative\">\r\n                {/* Header */}\r\n                <header className=\"h-16 border-b border-white/5 bg-slate-950/30 backdrop-blur-sm flex items-center justify-between px-8\">\r\n                    <h2 className=\"text-lg font-semibold text-white tracking-tight\">\r\n                        {navItems.find(n => n.id === currentView)?.label}\r\n                    </h2>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <span className=\"text-xs text-emerald-400 px-2 py-1 bg-emerald-500/10 rounded-full border border-emerald-500/10 flex items-center gap-1.5\">\r\n                            <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse\"></span>\r\n                            Live System\r\n                        </span>\r\n                        {/* Summary Pill for convenience */}\r\n                        <div className=\"hidden md:flex items-center gap-4 px-3 py-1 bg-white/5 rounded-full border border-white/5 text-xs text-slate-400\">\r\n                            <span>Online: <strong className=\"text-emerald-400\">{dashboard.onlineCount}</strong></span>\r\n                            <span className=\"w-px h-3 bg-white/10\"></span>\r\n                            <span>Studying: <strong className=\"text-indigo-400\">{dashboard.stats?.inSessionCount || 0}</strong></span>\r\n                            <span className=\"w-px h-3 bg-white/10\"></span>\r\n                            <span>Inactive: <strong className=\"text-red-400\">{dashboard.stats?.inactiveCount || 0}</strong></span>\r\n                            <span className=\"w-px h-3 bg-white/10\"></span>\r\n                            <span>Total Web: <strong className=\"text-slate-200\">{dashboard.total}</strong></span>\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n                {/* Content View */}\r\n                <div className=\"flex-1 p-8 overflow-hidden\">\r\n                    {currentView === 'STUDENTS' && (\r\n                        <div className=\"flex flex-col gap-6 h-full\">\r\n                            <StudentsTable students={dashboard.students} />\r\n                        </div>\r\n                    )}\r\n\r\n                    {currentView === 'OVERVIEW' && (\r\n                        <div className=\"flex flex-col gap-8\">\r\n                            {/* 1. TOP STATS ROW */}\r\n                            <div className=\"grid grid-cols-4 gap-6\">\r\n                                {/* CARD 1: ONLINE */}\r\n                                <div className=\"p-6 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex flex-col gap-2 relative overflow-hidden\">\r\n                                    <div className=\"absolute top-0 right-0 p-4 opacity-10\">\r\n                                        <Activity size={48} className=\"text-emerald-400\" />\r\n                                    </div>\r\n                                    <span className=\"text-sm font-bold text-emerald-300\">Online Now</span>\r\n                                    <div className=\"text-4xl font-bold text-emerald-400 tracking-tight\">{dashboard.stats?.onlineCount || 0}</div>\r\n                                    <div className=\"text-xs text-emerald-300/80 font-medium\">Live on Platform</div>\r\n                                </div>\r\n\r\n                                {/* CARD 2: STUDYING */}\r\n                                <div className=\"p-6 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 flex flex-col gap-2 relative overflow-hidden\">\r\n                                    <div className=\"absolute top-0 right-0 p-4 opacity-10\">\r\n                                        <Users size={48} className=\"text-indigo-400\" />\r\n                                    </div>\r\n                                    <span className=\"text-sm font-bold text-indigo-300\">Active Sessions</span>\r\n                                    <div className=\"text-4xl font-bold text-indigo-400 tracking-tight\">{dashboard.stats?.inSessionCount || 0}</div>\r\n                                    <div className=\"text-xs text-indigo-300/80 font-medium\">Focusing right now</div>\r\n                                </div>\r\n\r\n                                {/* CARD 3: OFFLINE (RECENT) */}\r\n                                <div className=\"p-6 rounded-2xl bg-slate-900/50 border border-white/5 flex flex-col gap-2 relative overflow-hidden\">\r\n                                    <span className=\"text-sm font-medium text-slate-400\">Offline (Recent)</span>\r\n                                    <div className=\"text-4xl font-bold text-slate-300 tracking-tight\">{dashboard.stats?.offlineRecentCount || 0}</div>\r\n                                    <div className=\"text-xs text-slate-500\">Active &lt; 7 days</div>\r\n                                </div>\r\n\r\n                                {/* CARD 4: INACTIVE */}\r\n                                <div className=\"p-6 rounded-2xl bg-red-500/5 border border-red-500/10 flex flex-col gap-2 relative overflow-hidden\">\r\n                                    <span className=\"text-sm font-bold text-red-400\">Inactive</span>\r\n                                    <div className=\"text-4xl font-bold text-red-500 tracking-tight\">{dashboard.stats?.inactiveCount || 0}</div>\r\n                                    <div className=\"text-xs text-red-400/80\">&gt; 7 Days Absent</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 2. SECONDARY STATS (Total/Subscribed) */}\r\n                            <div className=\"grid grid-cols-2 gap-6 w-1/2\">\r\n                                <div className=\"p-6 rounded-2xl bg-slate-900/30 border border-white/5 flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"text-sm text-slate-500\">Total Registered</div>\r\n                                        <div className=\"text-2xl font-bold text-white\">{dashboard.total}</div>\r\n                                    </div>\r\n                                    <Users size={24} className=\"text-slate-600\" />\r\n                                </div>\r\n                                <div className=\"p-6 rounded-2xl bg-slate-900/30 border border-white/5 flex items-center justify-between\">\r\n                                    <div>\r\n                                        <div className=\"text-sm text-slate-500\">Premium Members</div>\r\n                                        <div className=\"text-2xl font-bold text-amber-400\">{dashboard.subscribed}</div>\r\n                                    </div>\r\n                                    <GraduationCap size={24} className=\"text-amber-500/50\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {currentView === 'SYSTEM' && (\r\n                        <div className=\"flex flex-col items-center justify-center h-full text-slate-500 gap-4\">\r\n                            <Settings size={48} className=\"opacity-20\" />\r\n                            <p>System Configuration</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n\r\n            {/* 3. SLIDE-OVER INSPECTOR */}\r\n            <StudentInspector\r\n                student={selectedStudent}\r\n                onClose={() => selectStudent(null)}\r\n            />\r\n\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5994, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/ControlLayout.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport styles from './ControlLayout.module.css';\r\nimport {\r\n    LayoutDashboard,\r\n    BookOpen,\r\n    Activity,\r\n    Settings, // Keep one\r\n    Bell,\r\n    Sun,\r\n    Moon,\r\n    User, // Added\r\n    LogOut, // Added\r\n    Menu,\r\n    X,\r\n    ChevronsLeft,\r\n    ChevronsRight\r\n} from 'lucide-react';\r\nimport { useSystemStatus, useMediaQuery } from '@/core/hooks';\r\nimport { FlowState } from '@/core/engines/FlowEngine';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\nimport { useStore } from '@/store/useStore';\r\nimport { AuthModal } from '@/components/auth/AuthModal';\r\n\r\ninterface ControlLayoutProps {\r\n    children: React.ReactNode;\r\n    currentView: FlowState;\r\n    onNavigate: (view: FlowState) => void;\r\n    lang: Language;\r\n    onToggleLang: () => void;\r\n    theme: 'light' | 'dark';\r\n    onToggleTheme: () => void;\r\n}\r\n\r\nexport const ControlLayout: React.FC<ControlLayoutProps> = ({\r\n    children,\r\n    currentView,\r\n    onNavigate,\r\n    lang,\r\n    onToggleLang,\r\n    theme,\r\n    onToggleTheme\r\n}) => {\r\n    const systemStatus = useSystemStatus();\r\n    // REMOVED local theme state, now controlled props\r\n    const isMobile = useMediaQuery('(max-width: 768px)');\r\n\r\n    // Complex Sidebar State\r\n    // Desktop: true = Expanded, false = Mini Rail\r\n    // Mobile: true = Open (Overlay), false = Closed (Hidden)\r\n    const [sidebarLocal, setSidebarLocal] = useState(true);\r\n\r\n    // Auto-close sidebar on mobile nav\r\n    useEffect(() => {\r\n        if (isMobile) {\r\n            setSidebarLocal(false); // Default closed on mobile load\r\n        } else {\r\n            setSidebarLocal(true); // Default open on desktop\r\n        }\r\n    }, [isMobile]);\r\n\r\n    const { authState, authModal, openAuthModal, closeAuthModal, logout, isAdminMode, setAdminMode } = useStore();\r\n    const user = authState.user;\r\n    const isGuest = authState.status === 'GUEST';\r\n\r\n    const t = translations[lang];\r\n\r\n    // Toggle Handler\r\n    const toggleSidebar = () => setSidebarLocal(!sidebarLocal);\r\n\r\n    // Dynamic Classes\r\n    const sidebarClass = isMobile\r\n        ? sidebarLocal ? styles.sidebarOpen : styles.sidebarClosed\r\n        : sidebarLocal ? styles.sidebarOpen : styles.sidebarClosed; // Same naming, CSS handles diffs\r\n\r\n    const mainContentClass = isMobile\r\n        ? styles.mainContent // No margin on mobile\r\n        : `${styles.mainContent} ${sidebarLocal ? styles.withSidebar : styles.fullWidth}`;\r\n\r\n    return (\r\n        <div className={styles.layoutContainer}>\r\n\r\n            {/* MAIN CONTENT AREA */}\r\n            <main className={mainContentClass}>\r\n\r\n                {/* HEADS UP DISPLAY (Header) */}\r\n                <header className={styles.header}>\r\n                    <div className={styles.headerLeft}>\r\n                        {/* NOTIFICATIONS & USER GROUP */}\r\n                        <div className={styles.notificationArea}>\r\n                            <button className={styles.iconBtn}>\r\n                                <Bell size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <div className={styles.userSection}>\r\n                            {isGuest ? (\r\n                                <button\r\n                                    onClick={() => openAuthModal('LOGIN')}\r\n                                    className={`${styles.textBtn} bg-blue-600/20 text-blue-400 hover:bg-blue-600/30 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all`}\r\n                                    style={{ border: '1px solid rgba(59, 130, 246, 0.3)' }}\r\n                                >\r\n                                    Sign In\r\n                                </button>\r\n                            ) : (\r\n                                <>\r\n                                    <div className={styles.userAvatar}>\r\n                                        <span className={styles.avatarInitials}>{user?.name.charAt(0) || 'U'}</span>\r\n                                    </div>\r\n                                    <div className={styles.userInfo} style={isMobile ? { display: 'none' } : {}}>\r\n                                        <span className={styles.userName}>{user?.name || 'Student'}</span>\r\n                                        <span className={styles.userRole}>{user?.role || 'STUDENT'}</span>\r\n                                    </div>\r\n                                    {!isMobile && (\r\n                                        <button onClick={logout} className=\"ml-4 text-slate-500 hover:text-red-400 transition-colors\" title=\"Sign Out\">\r\n                                            <LogOut size={16} />\r\n                                        </button>\r\n                                    )}\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* CENTERED ADMIN BUTTON */}\r\n                    {user?.role === 'ADMIN' && !isMobile && (\r\n                        <div className=\"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2\">\r\n                            <button\r\n                                onClick={() => setAdminMode(true)}\r\n                                className=\"text-[10px] font-bold text-indigo-400 border border-indigo-500/30 px-6 py-2 rounded-full hover:bg-indigo-500/10 transition-colors tracking-wide animate-pulse\"\r\n                            >\r\n                                ENTER ADMIN MODE\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className={styles.headerRight}>\r\n                        {/* GLOBAL CONTROLS */}\r\n                        <div className={styles.globalControls}>\r\n                            {!isMobile && (\r\n                                <button onClick={onToggleLang} className={styles.textBtn}>\r\n                                    {lang === 'en' ? 'EN | AR' : 'AR | EN'}\r\n                                </button>\r\n                            )}\r\n                            <button onClick={onToggleTheme} className={styles.iconBtn}>\r\n                                {theme === 'dark' ? <Moon size={18} /> : <Sun size={18} />}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* MOBILE HAMBURGER */}\r\n                        {isMobile && (\r\n                            <button className={styles.mobileMenuBtn} onClick={toggleSidebar}>\r\n                                {sidebarLocal ? <X size={24} /> : <Menu size={24} />}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </header>\r\n\r\n                <div className={styles.contentViewport}>\r\n                    <div className={styles.contentWrapper}>\r\n                        {children}\r\n                    </div>\r\n                </div>\r\n            </main>\r\n\r\n            {/* MOBILE BACKDROP */}\r\n            {isMobile && sidebarLocal && (\r\n                <div className={styles.backdrop} onClick={() => setSidebarLocal(false)} />\r\n            )}\r\n\r\n            {/* CONTROL SIDEBAR (Right Side) */}\r\n            <aside className={`${styles.sidebar} ${sidebarClass}`}>\r\n\r\n                {/* DESKTOP TOGGLE BUTTON */}\r\n                {!isMobile && (\r\n                    <button className={styles.sidebarToggle} onClick={toggleSidebar}>\r\n                        {sidebarLocal ? <ChevronsRight size={20} /> : <ChevronsLeft size={20} />}\r\n                    </button>\r\n                )}\r\n\r\n                {/* LOGO AREA */}\r\n                <div className={styles.logoArea}>\r\n                    <div className={styles.logoIcon}>\r\n                        <Activity size={20} />\r\n                    </div>\r\n                    <div className={styles.logoText}>\r\n                        <div className={styles.brandName}>{t.brand_name}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <nav className={styles.navigation}>\r\n                    <div className={styles.navGroup}>\r\n                        <NavMethod\r\n                            icon={<LayoutDashboard size={20} />}\r\n                            label={t.dashboard}\r\n                            active={currentView === 'DASHBOARD_HOME'}\r\n                            onClick={() => { onNavigate('DASHBOARD_HOME'); if (isMobile) setSidebarLocal(false); }}\r\n                        />\r\n                        <NavMethod\r\n                            icon={<BookOpen size={20} />}\r\n                            label={t.sessions}\r\n                            active={currentView === 'DASHBOARD_HISTORY'}\r\n                            onClick={() => { onNavigate('DASHBOARD_HISTORY'); if (isMobile) setSidebarLocal(false); }}\r\n                        />\r\n                        <NavMethod\r\n                            icon={<Activity size={20} />}\r\n                            label={t.academic_input}\r\n                            active={currentView === 'DASHBOARD_INPUTS'}\r\n                            onClick={() => { onNavigate('DASHBOARD_INPUTS'); if (isMobile) setSidebarLocal(false); }}\r\n                        />\r\n                        <NavMethod\r\n                            icon={<Settings size={20} />}\r\n                            label={t.settings}\r\n                            active={currentView === 'DASHBOARD_CONFIG'}\r\n                            onClick={() => { onNavigate('DASHBOARD_CONFIG'); if (isMobile) setSidebarLocal(false); }}\r\n                        />\r\n\r\n                        {/* Mobile Only: Extra Actions in Sidebar */}\r\n                        {isMobile && !isGuest && (\r\n                            <button\r\n                                className={`${styles.navItem}`}\r\n                                onClick={logout}\r\n                                style={{ marginTop: 'auto', color: '#EF4444' }}\r\n                            >\r\n                                <span className={styles.navIcon}><LogOut size={20} /></span>\r\n                                <span className={styles.navLabel}>Sign Out</span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </nav>\r\n            </aside>\r\n            {/* AUTH MODAL OVERLAY */}\r\n            <AuthModal\r\n                open={authModal.isOpen}\r\n                initialMode={authModal.mode}\r\n                onClose={closeAuthModal}\r\n            />\r\n\r\n            {/* ADMIN MODE OVERLAY */}\r\n            <AdminModeOverlay isOpen={isAdminMode} onClose={() => setAdminMode(false)} />\r\n        </div>\r\n    );\r\n};\r\n\r\nconst NavMethod = ({ icon, label, active, onClick }: any) => (\r\n    <button\r\n        className={`${styles.navItem} ${active ? styles.active : ''}`}\r\n        onClick={onClick}\r\n    >\r\n        <span className={styles.navIcon}>{icon}</span>\r\n        {label && <span className={styles.navLabel}>{label}</span>}\r\n        {active && <div className={styles.activeIndicator} />}\r\n    </button>\r\n);\r\n\r\n// INTERNAL COMPONENT FOR ANIMATION\r\nimport { AdminLayout } from '@/components/admin/AdminLayout';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nconst AdminModeOverlay = ({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) => {\r\n    return (\r\n        <AnimatePresence>\r\n            {isOpen && (\r\n                <motion.div\r\n                    initial={{ x: '100%' }}\r\n                    animate={{ x: 0 }}\r\n                    exit={{ x: '100%' }}\r\n                    transition={{ type: 'spring', damping: 25, stiffness: 200 }}\r\n                    style={{\r\n                        position: 'fixed',\r\n                        inset: 0,\r\n                        zIndex: 9999, // Above everything\r\n                        background: '#020617', // Match theme\r\n                        display: 'flex'\r\n                    }}\r\n                >\r\n                    {/* EXIT BUTTON (Floating - Centered) */}\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"fixed top-4 left-1/2 -translate-x-1/2 z-[10000] text-[10px] font-bold text-indigo-400 border border-indigo-500/30 px-6 py-2 rounded-full hover:bg-indigo-500/10 transition-colors tracking-wide animate-pulse bg-[#020617]\"\r\n                    >\r\n                        EXIT ADMIN MODE\r\n                    </button>\r\n\r\n                    <AdminLayout />\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6606, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/dashboard/Dashboard.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"actionBtn\": \"Dashboard-module__Rm6JEq__actionBtn\",\n  \"addSubjectButton\": \"Dashboard-module__Rm6JEq__addSubjectButton\",\n  \"backBtn\": \"Dashboard-module__Rm6JEq__backBtn\",\n  \"briefingCard\": \"Dashboard-module__Rm6JEq__briefingCard\",\n  \"briefingList\": \"Dashboard-module__Rm6JEq__briefingList\",\n  \"cardBottom\": \"Dashboard-module__Rm6JEq__cardBottom\",\n  \"cardTop\": \"Dashboard-module__Rm6JEq__cardTop\",\n  \"detailHeader\": \"Dashboard-module__Rm6JEq__detailHeader\",\n  \"detailView\": \"Dashboard-module__Rm6JEq__detailView\",\n  \"dimmedCard\": \"Dashboard-module__Rm6JEq__dimmedCard\",\n  \"emptyBriefing\": \"Dashboard-module__Rm6JEq__emptyBriefing\",\n  \"emptyBriefingTitle\": \"Dashboard-module__Rm6JEq__emptyBriefingTitle\",\n  \"examCountdown\": \"Dashboard-module__Rm6JEq__examCountdown\",\n  \"fadeInBounce\": \"Dashboard-module__Rm6JEq__fadeInBounce\",\n  \"headerInfo\": \"Dashboard-module__Rm6JEq__headerInfo\",\n  \"headerStats\": \"Dashboard-module__Rm6JEq__headerStats\",\n  \"heroCard\": \"Dashboard-module__Rm6JEq__heroCard\",\n  \"heroContentRight\": \"Dashboard-module__Rm6JEq__heroContentRight\",\n  \"heroGrid\": \"Dashboard-module__Rm6JEq__heroGrid\",\n  \"heroIconBox\": \"Dashboard-module__Rm6JEq__heroIconBox\",\n  \"heroLabel\": \"Dashboard-module__Rm6JEq__heroLabel\",\n  \"heroSubtext\": \"Dashboard-module__Rm6JEq__heroSubtext\",\n  \"heroUnit\": \"Dashboard-module__Rm6JEq__heroUnit\",\n  \"heroValue\": \"Dashboard-module__Rm6JEq__heroValue\",\n  \"iconBtn\": \"Dashboard-module__Rm6JEq__iconBtn\",\n  \"inspectBtn\": \"Dashboard-module__Rm6JEq__inspectBtn\",\n  \"logIcon\": \"Dashboard-module__Rm6JEq__logIcon\",\n  \"logInfo\": \"Dashboard-module__Rm6JEq__logInfo\",\n  \"logMain\": \"Dashboard-module__Rm6JEq__logMain\",\n  \"logMeta\": \"Dashboard-module__Rm6JEq__logMeta\",\n  \"logStatus\": \"Dashboard-module__Rm6JEq__logStatus\",\n  \"logTitle\": \"Dashboard-module__Rm6JEq__logTitle\",\n  \"metaBadge\": \"Dashboard-module__Rm6JEq__metaBadge\",\n  \"metaRow\": \"Dashboard-module__Rm6JEq__metaRow\",\n  \"metricGroup\": \"Dashboard-module__Rm6JEq__metricGroup\",\n  \"metricValue\": \"Dashboard-module__Rm6JEq__metricValue\",\n  \"miniBarBg\": \"Dashboard-module__Rm6JEq__miniBarBg\",\n  \"miniBarFill\": \"Dashboard-module__Rm6JEq__miniBarFill\",\n  \"miniLabel\": \"Dashboard-module__Rm6JEq__miniLabel\",\n  \"orangeIcon\": \"Dashboard-module__Rm6JEq__orangeIcon\",\n  \"overviewSection\": \"Dashboard-module__Rm6JEq__overviewSection\",\n  \"purpleIcon\": \"Dashboard-module__Rm6JEq__purpleIcon\",\n  \"readinessBlock\": \"Dashboard-module__Rm6JEq__readinessBlock\",\n  \"readinessDot\": \"Dashboard-module__Rm6JEq__readinessDot\",\n  \"readinessLabel\": \"Dashboard-module__Rm6JEq__readinessLabel\",\n  \"scrollIndicator\": \"Dashboard-module__Rm6JEq__scrollIndicator\",\n  \"sectionTitle\": \"Dashboard-module__Rm6JEq__sectionTitle\",\n  \"statBlock\": \"Dashboard-module__Rm6JEq__statBlock\",\n  \"statLabel\": \"Dashboard-module__Rm6JEq__statLabel\",\n  \"statVal\": \"Dashboard-module__Rm6JEq__statVal\",\n  \"statusMastered\": \"Dashboard-module__Rm6JEq__statusMastered\",\n  \"statusPending\": \"Dashboard-module__Rm6JEq__statusPending\",\n  \"statusReview\": \"Dashboard-module__Rm6JEq__statusReview\",\n  \"subjectCard\": \"Dashboard-module__Rm6JEq__subjectCard\",\n  \"subjectGrid\": \"Dashboard-module__Rm6JEq__subjectGrid\",\n  \"subjectHeader\": \"Dashboard-module__Rm6JEq__subjectHeader\",\n  \"subjectName\": \"Dashboard-module__Rm6JEq__subjectName\",\n  \"subjectTitle\": \"Dashboard-module__Rm6JEq__subjectTitle\",\n  \"tealIcon\": \"Dashboard-module__Rm6JEq__tealIcon\",\n  \"titleBlock\": \"Dashboard-module__Rm6JEq__titleBlock\",\n  \"toolbar\": \"Dashboard-module__Rm6JEq__toolbar\",\n  \"unit\": \"Dashboard-module__Rm6JEq__unit\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 6674, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/DashboardView.tsx"],"sourcesContent":["import React from 'react';\r\nimport styles from './Dashboard.module.css';\r\nimport {\r\n    Clock,\r\n    Brain,\r\n    Zap,\r\n    Play\r\n} from 'lucide-react';\r\nimport { useStudentProfile, useDailyLoad, useSubjectList } from '@/core/hooks';\r\n\r\nimport { translations, Language } from '@/core/i18n/translations';\r\n\r\ninterface DashboardViewProps {\r\n    onSelectSubject: (id: string) => void;\r\n    onAddSubject: () => void;\r\n    lang: Language;\r\n}\r\n\r\nexport const DashboardView: React.FC<DashboardViewProps> = ({\r\n    onSelectSubject,\r\n    onAddSubject,\r\n    lang\r\n}) => {\r\n    const profile = useStudentProfile();\r\n    const dailyLoad = useDailyLoad();\r\n    const subjects = useSubjectList();\r\n    const t = translations[lang];\r\n\r\n    // -- Derived Visuals --\r\n    const capacityColor = profile.currentCapacity > 50 ? '#10B981' : profile.currentCapacity > 20 ? '#F59E0B' : '#EF4444';\r\n\r\n    // Helper to get translated dynamic values\r\n    const getTranslatedStatus = (status: string) => {\r\n        const key = status.toLowerCase();\r\n        // @ts-ignore\r\n        return t[key] || status;\r\n    };\r\n\r\n    const getTranslatedDifficulty = (diff: string) => {\r\n        const key = diff.toLowerCase();\r\n        // @ts-ignore\r\n        return t[key] || diff;\r\n    };\r\n\r\n    return (\r\n        <div className={styles.dashboardContainer}> {/* Wrapper for max-width */}\r\n\r\n            {/* HERO ROW: TELEMETRY */}\r\n            <section className={styles.heroGrid}>\r\n                {/* METRIC 1: CAPACITY */}\r\n                <div className={styles.heroCard}>\r\n                    <div className={styles.heroHeader}>\r\n                        <div className={`${styles.heroIconBox} ${styles.tealIcon}`}>\r\n                            <Zap size={24} />\r\n                        </div>\r\n                        <span className={styles.heroLabel}>{t.system_capacity}</span>\r\n                    </div>\r\n                    <div className={styles.heroMainContent}>\r\n                        <span className={styles.heroValue} style={{ color: capacityColor }}>\r\n                            {profile.currentCapacity}%\r\n                        </span>\r\n                        <span className={styles.heroSubtext}>\r\n                            {profile.currentCapacity > 80 ? t.nominal_state : t.depleted_state}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* METRIC 2: LOAD */}\r\n                <div className={styles.heroCard}>\r\n                    <div className={styles.heroHeader}>\r\n                        <div className={`${styles.heroIconBox} ${styles.purpleIcon}`}>\r\n                            <Brain size={24} />\r\n                        </div>\r\n                        <span className={styles.heroLabel}>{t.cognitive_load}</span>\r\n                    </div>\r\n                    <div className={styles.heroMainContent}>\r\n                        <div className={styles.heroValueRow}>\r\n                            <span className={styles.heroValue}>{dailyLoad.totalCognitiveCost}</span>\r\n                            <span className={styles.heroUnit}>{t.units}</span>\r\n                        </div>\r\n                        <span className={styles.heroSubtext}>\r\n                            {t.status}: {getTranslatedStatus(dailyLoad.status).toUpperCase()}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* METRIC 3: VELOCITY */}\r\n                <div className={styles.heroCard}>\r\n                    <div className={styles.heroHeader}>\r\n                        <div className={`${styles.heroIconBox} ${styles.orangeIcon}`}>\r\n                            <Clock size={24} />\r\n                        </div>\r\n                        <span className={styles.heroLabel}>{t.velocity}</span>\r\n                    </div>\r\n                    <div className={styles.heroMainContent}>\r\n                        <div className={styles.heroValueRow}>\r\n                            <span className={styles.heroValue}>{profile.totalSessions}</span>\r\n                            <span className={styles.heroUnit}>{t.cycles}</span>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </section>\r\n\r\n            {/* OVERVIEW SECTION & ACTION */}\r\n            <div className={styles.overviewSection}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h3 className={styles.sectionTitle}>{t.active_subjects}</h3>\r\n                    <button className={styles.addSubjectButton} onClick={onAddSubject}>\r\n                        + {t.add_subject}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* CONTENT GRID */}\r\n            <section className={styles.subjectGrid}>\r\n                {subjects.map(subject => (\r\n                    <div\r\n                        key={subject.id}\r\n                        className={styles.subjectCard}\r\n                        onClick={() => onSelectSubject(subject.id)}\r\n                    >\r\n                        <div className={styles.cardTop}>\r\n                            <div className={styles.subjectHeader}>\r\n                                <div className={styles.titleBlock}>\r\n                                    <span className={styles.subjectName}>{subject.name}</span>\r\n                                    {/* Countdown removed */}\r\n                                </div>\r\n                                <div className={styles.readinessBlock}>\r\n                                    <span className={styles.readinessLabel}>{t.stability}</span>\r\n                                    <div\r\n                                        className={styles.readinessDot}\r\n                                        style={{ backgroundColor: (subject.metrics?.stability ?? 0) > 75 ? '#10B981' : '#F59E0B' }}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* ACTION ZONE */}\r\n                        <div className={styles.cardBottom}>\r\n                            <button className={styles.inspectBtn}>\r\n                                {t.inspect} <Play size={14} fill=\"currentColor\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </section>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7102, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/dashboard/SessionIntelligenceTable.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"actionIcon\": \"SessionIntelligenceTable-module__8cpmBa__actionIcon\",\n  \"childRow\": \"SessionIntelligenceTable-module__8cpmBa__childRow\",\n  \"colActions\": \"SessionIntelligenceTable-module__8cpmBa__colActions\",\n  \"colDifficulty\": \"SessionIntelligenceTable-module__8cpmBa__colDifficulty\",\n  \"colDuration\": \"SessionIntelligenceTable-module__8cpmBa__colDuration\",\n  \"colEffort\": \"SessionIntelligenceTable-module__8cpmBa__colEffort\",\n  \"colName\": \"SessionIntelligenceTable-module__8cpmBa__colName\",\n  \"colStatus\": \"SessionIntelligenceTable-module__8cpmBa__colStatus\",\n  \"colType\": \"SessionIntelligenceTable-module__8cpmBa__colType\",\n  \"container\": \"SessionIntelligenceTable-module__8cpmBa__container\",\n  \"diffBadge\": \"SessionIntelligenceTable-module__8cpmBa__diffBadge\",\n  \"diffHigh\": \"SessionIntelligenceTable-module__8cpmBa__diffHigh\",\n  \"diffLow\": \"SessionIntelligenceTable-module__8cpmBa__diffLow\",\n  \"diffMed\": \"SessionIntelligenceTable-module__8cpmBa__diffMed\",\n  \"effortEasier\": \"SessionIntelligenceTable-module__8cpmBa__effortEasier\",\n  \"effortHarder\": \"SessionIntelligenceTable-module__8cpmBa__effortHarder\",\n  \"effortNeutral\": \"SessionIntelligenceTable-module__8cpmBa__effortNeutral\",\n  \"emptyState\": \"SessionIntelligenceTable-module__8cpmBa__emptyState\",\n  \"metricBlock\": \"SessionIntelligenceTable-module__8cpmBa__metricBlock\",\n  \"metricLabel\": \"SessionIntelligenceTable-module__8cpmBa__metricLabel\",\n  \"metricUnit\": \"SessionIntelligenceTable-module__8cpmBa__metricUnit\",\n  \"metricValue\": \"SessionIntelligenceTable-module__8cpmBa__metricValue\",\n  \"metricsHeader\": \"SessionIntelligenceTable-module__8cpmBa__metricsHeader\",\n  \"parentRow\": \"SessionIntelligenceTable-module__8cpmBa__parentRow\",\n  \"stackCell\": \"SessionIntelligenceTable-module__8cpmBa__stackCell\",\n  \"stackLabel\": \"SessionIntelligenceTable-module__8cpmBa__stackLabel\",\n  \"stackValue\": \"SessionIntelligenceTable-module__8cpmBa__stackValue\",\n  \"statusCompleted\": \"SessionIntelligenceTable-module__8cpmBa__statusCompleted\",\n  \"statusInterrupted\": \"SessionIntelligenceTable-module__8cpmBa__statusInterrupted\",\n  \"statusPending\": \"SessionIntelligenceTable-module__8cpmBa__statusPending\",\n  \"statusPill\": \"SessionIntelligenceTable-module__8cpmBa__statusPill\",\n  \"statusProgress\": \"SessionIntelligenceTable-module__8cpmBa__statusProgress\",\n  \"tableGrid\": \"SessionIntelligenceTable-module__8cpmBa__tableGrid\",\n  \"tableHeader\": \"SessionIntelligenceTable-module__8cpmBa__tableHeader\",\n  \"tableRow\": \"SessionIntelligenceTable-module__8cpmBa__tableRow\",\n  \"treeLine\": \"SessionIntelligenceTable-module__8cpmBa__treeLine\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 7144, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/SessionIntelligenceTable.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\r\nimport { Lecture, StudySession } from '@/core/types';\r\nimport styles from './SessionIntelligenceTable.module.css';\r\nimport {\r\n    Clock,\r\n    Flame,\r\n    Layers,\r\n    Eye,\r\n    Trash2,\r\n    Play,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Minus,\r\n    CornerDownRight,\r\n    Square,\r\n    PauseCircle\r\n} from 'lucide-react';\r\nimport { useStore } from '@/store/useStore';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\n\r\ninterface SessionIntelligenceTableProps {\r\n    subjectId: string;\r\n    lectures: Lecture[];\r\n    sessions: StudySession[];\r\n    onStartSession: (lectureId: string) => void;\r\n    lang: Language;\r\n}\r\n\r\nexport const SessionIntelligenceTable: React.FC<SessionIntelligenceTableProps> = ({\r\n    subjectId,\r\n    lectures,\r\n    sessions,\r\n    onStartSession,\r\n    lang\r\n}) => {\r\n    const { activeSession, deleteLecture } = useStore();\r\n\r\n    // Helper for Translation\r\n    const t = translations[lang] || translations.en;\r\n\r\n    // --- 1. METRICS COMPUTE (Global Subject Level) ---\r\n    const metrics = useMemo(() => {\r\n        const completedSessions = sessions.filter(s => s.status === 'COMPLETED' || s.status === 'INTERRUPTED');\r\n        const count = completedSessions.length;\r\n\r\n        if (count === 0) return { avgTime: 0, avgDiff: \"0.0\", total: 0, baseline: 0 };\r\n\r\n        const totalDuration = completedSessions.reduce((acc, s) => acc + s.actualDuration, 0);\r\n\r\n        let totalDiff = 0;\r\n        let diffCount = 0;\r\n\r\n        completedSessions.forEach(s => {\r\n            const lecture = lectures.find(l => l.id === s.lectureId);\r\n            if (lecture) {\r\n                // Fix potential NaN if relativeDifficulty is missing\r\n                const diff = lecture.relativeDifficulty ?? 0;\r\n                totalDiff += diff;\r\n                diffCount++;\r\n            }\r\n        });\r\n\r\n        const avgTime = Math.round(totalDuration / count);\r\n        // Fix NaN: Check diffCount > 0 AND totalDiff is not NaN\r\n        const avgDiffVal = diffCount > 0 ? (totalDiff / diffCount) : 0;\r\n        const avgDiff = isNaN(avgDiffVal) ? \"0.0\" : avgDiffVal.toFixed(1);\r\n\r\n        return {\r\n            avgTime,\r\n            avgDiff,\r\n            total: count,\r\n            baseline: avgTime || 60\r\n        };\r\n    }, [sessions, lectures]);\r\n\r\n    // --- 2. HIERARCHY BUILDER (Aggregates) ---\r\n    const tableRows = useMemo(() => {\r\n        const rows: any[] = [];\r\n\r\n        const theorystreams = lectures.filter(l => l.type === 'Theory');\r\n        const sectionStreams = lectures.filter(l => l.type !== 'Theory');\r\n\r\n        const processStream = (stream: Lecture[], prefix: string) => {\r\n            stream.forEach((lecture, index) => {\r\n                const autoName = `${prefix}_${(lecture.index || index + 1)}`; // Support stored index\r\n\r\n                // Find Children\r\n                const children = sessions\r\n                    .filter(s => s.lectureId === lecture.id)\r\n                    .sort((a, b) => new Date(b.date!).getTime() - new Date(a.date!).getTime());\r\n\r\n                // Compute Parent Aggregates\r\n                const completedChildren = children.filter(s => s.status !== 'IN_PROGRESS');\r\n                const totalDuration = completedChildren.reduce((acc, s) => acc + s.actualDuration, 0);\r\n\r\n                const showDiff = true; // Always show diff as it is calculated on creation\r\n                const displayDiff = lecture.relativeDifficulty ?? 0;\r\n\r\n                // Status\r\n                const isRunning = activeSession?.lectureId === lecture.id;\r\n                const hasHistory = completedChildren.length > 0;\r\n\r\n                let status = t.status_ready;\r\n                let statusKey = 'READY';\r\n                if (isRunning) { status = t.status_progress; statusKey = 'IN PROGRESS'; }\r\n                else if (hasHistory) { status = t.status_completed; statusKey = 'COMPLETED'; }\r\n\r\n                // Add Parent\r\n                rows.push({\r\n                    id: lecture.id,\r\n                    isParent: true,\r\n                    name: autoName,\r\n                    type: lecture.type === 'Theory' ? t.lecture_label : t.section_label,\r\n                    duration: hasHistory ? totalDuration : 0,\r\n                    difficulty: displayDiff,\r\n                    statusLabel: status, // Localized\r\n                    statusKey: statusKey, // Logic\r\n                    showZeroState: !hasHistory && !isRunning,\r\n                    original: lecture,\r\n                    indent: 0\r\n                });\r\n\r\n                // Add Children (Sessions)\r\n                children.forEach(session => {\r\n                    let childStatus = t.status_completed;\r\n                    let childStatusKey = session.status || 'COMPLETED';\r\n\r\n                    if (session.status === 'INTERRUPTED') childStatus = t.status_interrupted;\r\n                    if (session.status === 'IN_PROGRESS') childStatus = t.status_progress; // Should match parent active\r\n\r\n                    const dateObj = new Date(session.startTime);\r\n                    const dateStr = dateObj.toLocaleDateString('en-GB'); // DD/MM/YYYY format preference\r\n\r\n                    rows.push({\r\n                        id: session.id,\r\n                        isParent: false,\r\n                        name: dateStr, // Show Date instead of \"Study Session\"\r\n                        type: t.study_session_label,\r\n                        duration: session.actualDuration,\r\n                        difficulty: displayDiff, // Inherit\r\n                        statusLabel: childStatus,\r\n                        statusKey: childStatusKey,\r\n                        original: session,\r\n                        indent: 1\r\n                    });\r\n                });\r\n            });\r\n        };\r\n\r\n        processStream(theorystreams, 'LEC');\r\n        processStream(sectionStreams, 'SEC');\r\n\r\n        return rows;\r\n    }, [lectures, sessions, activeSession, t]);\r\n\r\n    // --- 3. HELPER: Effort Delta ---\r\n    const getEffortDelta = (duration: number, isZeroState: boolean) => {\r\n        return { text: \"\", class: styles.effortNeutral };\r\n    };\r\n\r\n    // Child Delta Helper\r\n    const getSessionDelta = (duration: number) => {\r\n        if (metrics.baseline === 0) return { text: \"\", class: styles.effortNeutral };\r\n        const delta = duration - metrics.baseline;\r\n        const percent = Math.round((delta / metrics.baseline) * 100);\r\n\r\n        if (percent > 5) return { text: `+${percent}%`, class: styles.effortHarder, icon: <TrendingUp size={14} /> };\r\n        if (percent < -5) return { text: `${percent}%`, class: styles.effortEasier, icon: <TrendingDown size={14} /> };\r\n        return { text: t.diff_avg, class: styles.effortNeutral, icon: <Minus size={14} /> };\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {/* HEADER METRICS */}\r\n            <div className={styles.metricsHeader}>\r\n                <div className={styles.metricBlock}>\r\n                    <div className={styles.metricLabel}><Clock size={16} /> {t.avg_session}</div>\r\n                    <div className={styles.metricValue}>\r\n                        {metrics.avgTime}<span className={styles.metricUnit}>min</span>\r\n                    </div>\r\n                </div>\r\n                <div className={styles.metricBlock}>\r\n                    <div className={styles.metricLabel}><Flame size={16} /> {t.avg_diff}</div>\r\n                    <div className={styles.metricValue}>{metrics.avgDiff}</div>\r\n                </div>\r\n                <div className={styles.metricBlock}>\r\n                    <div className={styles.metricLabel}><Layers size={16} /> {t.total_sessions}</div>\r\n                    <div className={styles.metricValue}>{metrics.total}</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* TABLE */}\r\n            <div className={styles.tableGrid}>\r\n                <div className={styles.tableHeader}>\r\n                    <span>{t.col_item}</span>\r\n                    <span>{t.col_type}</span>\r\n                    <span>{t.col_duration}</span>\r\n                    <span>{t.col_diff}</span>\r\n                    <span>{t.col_delta}</span>\r\n                    <span>Grade</span>\r\n                    <span>Index</span>\r\n                    <span>{t.col_status}</span>\r\n                    <span>{t.col_actions}</span>\r\n                </div>\r\n\r\n                {tableRows.length === 0 && (\r\n                    <div className={styles.emptyState}>\r\n                        {t.empty_state}\r\n                    </div>\r\n                )}\r\n\r\n                {tableRows.map((row, idx) => {\r\n                    const isParent = row.isParent;\r\n                    const delta = isParent ? { text: \"\", class: styles.effortNeutral } : getSessionDelta(row.duration);\r\n\r\n                    // Difficulty Class\r\n                    let diffClass = styles.diffMed;\r\n                    if (row.difficulty <= 3) diffClass = styles.diffLow;\r\n                    if (row.difficulty >= 7) diffClass = styles.diffHigh;\r\n\r\n                    // Zero State Rendering\r\n                    const showZero = row.showZeroState;\r\n\r\n                    // Status Styles (Based on Key, not Label)\r\n                    let statusClass = styles.statusPending; // Gray\r\n                    if (row.statusKey === 'IN PROGRESS') statusClass = styles.statusProgress; // Blue\r\n                    if (row.statusKey === 'COMPLETED') statusClass = styles.statusCompleted; // Green\r\n                    if (row.statusKey === 'INTERRUPTED') statusClass = styles.statusInterrupted; // Yellow\r\n\r\n                    return (\r\n                        <div key={`${row.id}_${idx}`} className={`${styles.tableRow} ${isParent ? styles.parentRow : styles.childRow}`}>\r\n\r\n                            {/* NAME */}\r\n                            <div className={styles.colName}>\r\n                                {!isParent && <div className={styles.treeLine}></div>}\r\n                                {isParent && <Layers size={16} color=\"#64748B\" />}\r\n                                {!isParent && <CornerDownRight size={14} color=\"#64748B\" />}\r\n                                {row.name}\r\n                            </div>\r\n\r\n                            {/* TYPE */}\r\n                            <div className={styles.colType}>\r\n                                {row.type}\r\n                            </div>\r\n\r\n                            {/* DURATION */}\r\n                            <div className={styles.colDuration}>\r\n                                {showZero ? <span style={{ opacity: 0.3 }}></span> : `${row.duration} min`}\r\n                            </div>\r\n\r\n                            {/* DIFFICULTY (Stacked) */}\r\n                            <div className={styles.colDifficulty}>\r\n                                <div className={styles.stackCell}>\r\n                                    {isParent ? (\r\n                                        <span className={`${styles.diffBadge} ${diffClass}`}>\r\n                                            {row.difficulty}\r\n                                        </span>\r\n                                    ) : (\r\n                                        <span className={`${styles.diffBadge} ${diffClass}`} style={{ opacity: 0.5 }}>\r\n                                            {row.difficulty}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* DELTA */}\r\n                            <div className={`${styles.colEffort} ${delta.class}`} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                                {delta.icon} {delta.text}\r\n                            </div>\r\n\r\n                            {/* GRADE */}\r\n                            <div className={styles.colDuration}>\r\n                                {row.original.grade || ''}\r\n                            </div>\r\n\r\n                            {/* INDEX */}\r\n                            <div className={styles.colDuration} style={{ fontSize: '0.8rem', opacity: 0.7 }}>\r\n                                {row.original.cognitiveIndex?.toFixed(1) || ''}\r\n                            </div>\r\n\r\n                            {/* STATUS (Stacked) */}\r\n                            <div className={styles.colStatus}>\r\n                                <div className={styles.stackCell}>\r\n                                    {isParent && row.statusKey === 'READY' ? (\r\n                                        <span className={styles.statusPending}>{row.statusLabel}</span>\r\n                                    ) : (\r\n                                        <span className={`${styles.statusPill} ${statusClass}`}>\r\n                                            {row.statusLabel}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* ACTIONS */}\r\n                            <div className={styles.colActions}>\r\n                                {isParent && (\r\n                                    <>\r\n                                        {row.statusKey === 'IN PROGRESS' ? (\r\n                                            <div title=\"Starting... (Go to Timer)\">\r\n                                                <PauseCircle size={18} color=\"#60A5FA\" />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div\r\n                                                className={styles.actionIcon}\r\n                                                onClick={() => onStartSession(row.id)}\r\n                                                title={t.sess_start}\r\n                                            >\r\n                                                <Play size={18} />\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        <div className={styles.actionIcon} title={t.sess_scan}>\r\n                                            <Eye size={18} />\r\n                                        </div>\r\n                                        <div\r\n                                            className={styles.actionIcon}\r\n                                            title={t.sess_del}\r\n                                            onClick={() => deleteLecture(row.id)}\r\n                                        >\r\n                                            <Trash2 size={18} />\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7814, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/CognitiveLoadEngine.ts"],"sourcesContent":["import { DailyLoad, SubjectConfig, Lecture, StudySession } from '../types';\r\n\r\n/**\r\n * ENGINEERING: COGNITIVE LOAD ENGINE\r\n * Reference: PHASE_3_LOGIC_SPECIFICATION.md (Section 3)\r\n * \r\n * ROLE:\r\n * The \"Hydraulic System\" of the platform.\r\n * Tracks mental fatigue accumulation and enforces Lockouts.\r\n * \r\n * INPUTS:\r\n * - Session Data (Duration, Focus)\r\n * - SubjectConfig (Thresholds)\r\n * - Current DailyLoad\r\n * \r\n * OUTPUTS:\r\n * - Calculated Session Cost\r\n * - Updated DailyLoad Status (Safe/Warning/Risk)\r\n */\r\nexport const CognitiveLoadEngine = {\r\n\r\n    /**\r\n     * Calculates the \"Cost\" of a specific session.\r\n     * Logic: Cost = (Duration * Strictness) * (Weight / 5)\r\n     */\r\n    calculateSessionCost: (\r\n        session: StudySession,\r\n        lecture: Lecture,\r\n        config: SubjectConfig\r\n    ): number => {\r\n        let cost = session.actualDuration;\r\n\r\n        // 1. Strictness Impact\r\n        // High strictness implies high intensity per minute\r\n        if (config.strictnessLevel === 'Military') cost *= 1.2;\r\n        if (config.strictnessLevel === 'Relaxed') cost *= 0.8;\r\n\r\n        // 2. Cognitive Weight Scaling\r\n        // Weight 5 is baseline. Weight 10 is double cost.\r\n        cost *= (lecture.relativeDifficulty / 5);\r\n\r\n        // 3. Treatment Scaling\r\n        if (config.lectureTreatment === 'Intensive') cost *= 1.5;\r\n\r\n        // 4. Focus Performance Impact\r\n        // Low focus (<50%) actually INCREASES cognitive cost (fighting distractions is expensive)\r\n        // High focus (>90%) is efficient (Net zero or slight reduction)\r\n        if (session.focusPerformance < 50) cost *= 1.2;\r\n        if (session.focusPerformance > 90) cost *= 0.95;\r\n\r\n        return Math.round(cost);\r\n    },\r\n\r\n    /**\r\n     * Updates the Daily Load accumulator and determines System Status.\r\n     * Enforces the \"Safety Valve\".\r\n     */\r\n    analyzeLoadState: (\r\n        currentLoad: DailyLoad,\r\n        addedCost: number,\r\n        subjectConfig: SubjectConfig\r\n    ): DailyLoad => {\r\n        const newTotal = currentLoad.totalCognitiveCost + addedCost;\r\n\r\n        // Base System Capacity is 100 \"Standard Units\" (approx 4 hours of intense work)\r\n        // This can be scaled by the subject's MaxDailyLoad setting.\r\n        let systemLimit = 240; // Minutes equivalent baseline\r\n\r\n        switch (subjectConfig.maxDailyLoad) {\r\n            case 'Low': systemLimit = 120; break;\r\n            case 'Medium': systemLimit = 240; break;\r\n            case 'High': systemLimit = 360; break;\r\n        }\r\n\r\n        // Apply Personal Threshold (e.g., Stop at 80% of Max)\r\n        const safetyValve = systemLimit * (subjectConfig.cognitiveThreshold / 100);\r\n\r\n        // Status Determination\r\n        let status: DailyLoad['status'] = 'Safe';\r\n\r\n        if (newTotal > safetyValve) {\r\n            // Critical Breach -> Soft Lockout\r\n            status = 'Risk';\r\n        } else if (newTotal > (safetyValve * 0.8)) {\r\n            // Warning Zone\r\n            status = 'Warning';\r\n        }\r\n\r\n        return {\r\n            ...currentLoad,\r\n            totalCognitiveCost: newTotal,\r\n            status\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Checks if a specific action is blocked by the regulator.\r\n     * [PRODUCT CHANGE]: ALWAYS FALSE. Analytics only.\r\n     */\r\n    isLockedOut: (currentLoad: DailyLoad): boolean => {\r\n        return false;\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAmBO,MAAM,sBAAsB;IAE/B;;;KAGC,GACD,sBAAsB,CAClB,SACA,SACA;QAEA,IAAI,OAAO,QAAQ,cAAc;QAEjC,uBAAuB;QACvB,oDAAoD;QACpD,IAAI,OAAO,eAAe,KAAK,YAAY,QAAQ;QACnD,IAAI,OAAO,eAAe,KAAK,WAAW,QAAQ;QAElD,8BAA8B;QAC9B,kDAAkD;QAClD,QAAS,QAAQ,kBAAkB,GAAG;QAEtC,uBAAuB;QACvB,IAAI,OAAO,gBAAgB,KAAK,aAAa,QAAQ;QAErD,8BAA8B;QAC9B,0FAA0F;QAC1F,gEAAgE;QAChE,IAAI,QAAQ,gBAAgB,GAAG,IAAI,QAAQ;QAC3C,IAAI,QAAQ,gBAAgB,GAAG,IAAI,QAAQ;QAE3C,OAAO,KAAK,KAAK,CAAC;IACtB;IAEA;;;KAGC,GACD,kBAAkB,CACd,aACA,WACA;QAEA,MAAM,WAAW,YAAY,kBAAkB,GAAG;QAElD,gFAAgF;QAChF,4DAA4D;QAC5D,IAAI,cAAc,KAAK,8BAA8B;QAErD,OAAQ,cAAc,YAAY;YAC9B,KAAK;gBAAO,cAAc;gBAAK;YAC/B,KAAK;gBAAU,cAAc;gBAAK;YAClC,KAAK;gBAAQ,cAAc;gBAAK;QACpC;QAEA,sDAAsD;QACtD,MAAM,cAAc,cAAc,CAAC,cAAc,kBAAkB,GAAG,GAAG;QAEzE,uBAAuB;QACvB,IAAI,SAA8B;QAElC,IAAI,WAAW,aAAa;YACxB,kCAAkC;YAClC,SAAS;QACb,OAAO,IAAI,WAAY,cAAc,KAAM;YACvC,eAAe;YACf,SAAS;QACb;QAEA,OAAO;YACH,GAAG,WAAW;YACd,oBAAoB;YACpB;QACJ;IACJ;IAEA;;;KAGC,GACD,aAAa,CAAC;QACV,OAAO;IACX;AACJ"}},
    {"offset": {"line": 7887, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/CapacityEngine.ts"],"sourcesContent":["import { StudentProfile, DailyLoad } from '../types';\r\n\r\n/**\r\n * ENGINEERING: CAPACITY ENGINE\r\n * Reference: PHASE_3_LOGIC_SPECIFICATION.md (Section 5)\r\n * \r\n * ROLE:\r\n * Tracks the user's \"Battery Level\" (0-100).\r\n * Determines \"Cognitive Bankruptcy\".\r\n * \r\n * INPUTS:\r\n * - StudentProfile (Current State)\r\n * - DailyLoad (Fatigue)\r\n * \r\n * OUTPUTS:\r\n * - CurrentCapacity (0-100)\r\n * - Recommendation String\r\n */\r\nexport const CapacityEngine = {\r\n\r\n    /**\r\n     * Re-calculates the Student's Capacity based on today's load.\r\n     * Should be called after every Session.\r\n     */\r\n    calculateCurrentCapacity: (\r\n        profile: StudentProfile,\r\n        dailyLoad: DailyLoad\r\n    ): number => {\r\n        // 1. Start with Profile Max (Conceptually 100%)\r\n        let capacity = 100;\r\n\r\n        // 2. Subtract Daily Load Impact\r\n        // We normalize Load Units to Capacity Percentage.\r\n        // Assuming 240 Load Units = 100% depletion.\r\n        const depletion = (dailyLoad.totalCognitiveCost / 240) * 100;\r\n        capacity -= depletion;\r\n\r\n        // 3. Consistency Bonus (Recovery Efficiency)\r\n        // High consistency users recover faster / resist fatigue better.\r\n        // Bonus: up to +10% resilience.\r\n        if (profile.consistencyIndex > 80) capacity += 5;\r\n\r\n        // 4. Circadian Factor (Time of Day)\r\n        // Late night (post 10 PM) incurs extra penalty\r\n        const hour = new Date().getHours();\r\n        if (hour >= 22 || hour < 5) {\r\n            capacity -= 15; // \"The Sleep Tax\"\r\n        }\r\n\r\n        // 5. Clamp\r\n        return Math.max(0, Math.min(100, Math.round(capacity)));\r\n    },\r\n\r\n    /**\r\n     * Determines if the user is Bankrupt.\r\n     * Triggers \"Hard Lockout\".\r\n     */\r\n    isBankrupt: (capacity: number): boolean => {\r\n        return capacity <= 5; // 5% buffer is functionally dead\r\n    },\r\n\r\n    /**\r\n     * Generates the system's voice based on capacity.\r\n     */\r\n    getConsultation: (capacity: number): string => {\r\n        if (capacity > 80) return \"Systems Nominal. Ready for Heavy Load.\";\r\n        if (capacity > 50) return \"Capacity Sustained. Proceed with Caution.\";\r\n        if (capacity > 20) return \"Reserves Critical. Recommendation: Review Only.\";\r\n        return \"SYSTEM FAILURE. IMMEDIATE RECOVERY REQUIRED.\";\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAkBO,MAAM,iBAAiB;IAE1B;;;KAGC,GACD,0BAA0B,CACtB,SACA;QAEA,gDAAgD;QAChD,IAAI,WAAW;QAEf,gCAAgC;QAChC,kDAAkD;QAClD,4CAA4C;QAC5C,MAAM,YAAY,AAAC,UAAU,kBAAkB,GAAG,MAAO;QACzD,YAAY;QAEZ,6CAA6C;QAC7C,iEAAiE;QACjE,gCAAgC;QAChC,IAAI,QAAQ,gBAAgB,GAAG,IAAI,YAAY;QAE/C,oCAAoC;QACpC,+CAA+C;QAC/C,MAAM,OAAO,IAAI,OAAO,QAAQ;QAChC,IAAI,QAAQ,MAAM,OAAO,GAAG;YACxB,YAAY,IAAI,kBAAkB;QACtC;QAEA,WAAW;QACX,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,KAAK,KAAK,CAAC;IAChD;IAEA;;;KAGC,GACD,YAAY,CAAC;QACT,OAAO,YAAY,GAAG,iCAAiC;IAC3D;IAEA;;KAEC,GACD,iBAAiB,CAAC;QACd,IAAI,WAAW,IAAI,OAAO;QAC1B,IAAI,WAAW,IAAI,OAAO;QAC1B,IAAI,WAAW,IAAI,OAAO;QAC1B,OAAO;IACX;AACJ"}},
    {"offset": {"line": 7935, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/SystemOrchestrator.ts"],"sourcesContent":["import { useStore } from '../store/useStore';\r\nimport { TimePredictionEngine } from './engines/TimePredictionEngine';\r\nimport { CognitiveLoadEngine } from './engines/CognitiveLoadEngine';\r\nimport { CapacityEngine } from './engines/CapacityEngine';\r\nimport { StudySession, Lecture, StudentProfile, SubjectConfig } from './types';\r\n\r\n/**\r\n * ENGINEERING: SYSTEM ORCHESTRATOR\r\n * Reference: PHASE_1_SYSTEM_ARCHITECTURE.md (Layer 2)\r\n * \r\n * ROLE:\r\n * The \"Traffic Controller\" of the system.\r\n * It is the ONLY module authorized to trigger complex state mutations involving multiple engines.\r\n * It enforces the \"System Authority\" by applying Guard Logic before allowing actions.\r\n */\r\nexport const SystemOrchestrator = {\r\n\r\n    // --- 1. GUARDS (The Gatekeepers) ---\r\n\r\n    /**\r\n     * Checks if a session can legally start.\r\n     * Enforces: Hard Lockouts, Bankruptcies, and Stability Gates.\r\n     */\r\n    canStartSession: (lectureId: string): { allowed: boolean; reason?: string; overrideRequired?: boolean } => {\r\n        // [PRODUCT CHANGE] 2024-01-XX\r\n        // Guards removed. Analytics only.\r\n        return { allowed: true };\r\n    },\r\n\r\n    // --- 2. ORCHESTRATION EVENT: SESSION START ---\r\n\r\n    /**\r\n     * Prepares the system for a session.\r\n     * Calculates predictions and sets execution context.\r\n     */\r\n    prepareSession: (lectureId: string) => {\r\n        const state = useStore.getState();\r\n        const lecture = state.lectures.find(l => l.id === lectureId);\r\n        const subject = state.subjects.find(s => s.id === lecture?.subjectId);\r\n        const profile = state.profile;\r\n\r\n        if (!lecture || !subject) throw new Error(\"Invalid Session Context\");\r\n\r\n        // 1. Run Prediction Engine\r\n        // [REFACTOR] Single Source of Truth: Use stored expectedDuration.\r\n        // We DO NOT recalculate this at session start.\r\n        const predictedDuration = lecture.expectedDuration;\r\n\r\n        // 2. Return the Contract\r\n        return {\r\n            lecture,\r\n            subject,\r\n            predictedDuration,\r\n            strictness: subject.config.strictnessLevel\r\n        };\r\n    },\r\n\r\n    // --- 3. ORCHESTRATION EVENT: SESSION END ---\r\n\r\n    /**\r\n     * The atomic commit of a study session.\r\n     * Chains: Load Analysis -> Store Update -> Capacity Recalculation -> Persistence.\r\n     */\r\n    finalizeSession: (\r\n        sessionBase: Omit<StudySession, 'cognitiveCost' | 'id'>,\r\n        config: SubjectConfig\r\n    ) => {\r\n        const state = useStore.getState();\r\n        const engine = CognitiveLoadEngine;\r\n\r\n        // 1. Calculate the Biological Cost\r\n        const lecture = state.lectures.find(l => l.id === sessionBase.lectureId)!;\r\n\r\n        // We reconstruct a temporary session object for the engine\r\n        const tempSessionForCalc = { ...sessionBase, id: 'temp', cognitiveCost: 0 } as StudySession;\r\n\r\n        const cost = engine.calculateSessionCost(\r\n            tempSessionForCalc,\r\n            lecture,\r\n            config\r\n        );\r\n\r\n        // 2. Construct Final Session Object\r\n        const finalSession: StudySession = {\r\n            ...sessionBase,\r\n            id: crypto.randomUUID(),\r\n            cognitiveCost: cost\r\n        };\r\n\r\n        // 3. ATOMIC UPDATE: Register Session\r\n        // This updates 'sessions' log AND 'dailyLoad' accumulator\r\n        state.registerSession(finalSession);\r\n\r\n        // 4. SIDE EFFECT: Recalculate Capacity\r\n        // We must fetch the *new* state because registerSession just mutated it\r\n        const nextState = useStore.getState();\r\n        const newCapacity = CapacityEngine.calculateCurrentCapacity(\r\n            nextState.profile,\r\n            nextState.dailyLoad\r\n        );\r\n\r\n        // 5. Update Profile with new Capacity\r\n        state.updateCapacity(newCapacity);\r\n\r\n        // 6. SIDE EFFECT: Update Logic Stability (Forgetting Curve Reset)\r\n        // If focus was high enough (>50), we consider it a successful review\r\n        if (sessionBase.focusPerformance > 50) {\r\n            state.updateLectureStability(lecture.id, 100);\r\n        }\r\n\r\n        return {\r\n            success: true,\r\n            costIncurred: cost,\r\n            remainingCapacity: newCapacity\r\n        };\r\n    },\r\n\r\n    // --- 4. ORCHESTRATION EVENT: DAY ROLLOVER ---\r\n\r\n    /**\r\n     * Handles the \"Sleep\" cycle.\r\n     * Resets DailyLoad, decays consistency if idle, calculates recovery.\r\n     */\r\n    processRecovery: () => {\r\n        const state = useStore.getState();\r\n\r\n        // 1. Reset Daily Load\r\n        state.resetDailyLoad();\r\n\r\n        // 2. Apply \"Sleep\" Recovery to Capacity\r\n        // (Simple reset to 100 for now, could be logic based on sleep duration later)\r\n        state.updateCapacity(100);\r\n\r\n        // 3. Decay Stability on all Lectures (The Forgetting Curve)\r\n        // This is a heavy operation, effectively \"Aging\" the database.\r\n        // We'll iterate all lectures and apply a decay factor.\r\n        state.lectures.forEach(lecture => {\r\n            // Decay 5% per day by default\r\n            // This should ideally use an action that batch updates, \r\n            // but for now we'll iterate.\r\n            const newStab = Math.max(0, lecture.stability * 0.95);\r\n            state.updateLectureStability(lecture.id, newStab);\r\n        });\r\n\r\n        console.log(\"SYSTEM: Recovery Cycle Complete. Day Reset.\");\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAEA;AACA;;;;AAYO,MAAM,qBAAqB;IAE9B,sCAAsC;IAEtC;;;KAGC,GACD,iBAAiB,CAAC;QACd,8BAA8B;QAC9B,kCAAkC;QAClC,OAAO;YAAE,SAAS;QAAK;IAC3B;IAEA,gDAAgD;IAEhD;;;KAGC,GACD,gBAAgB,CAAC;QACb,MAAM,QAAQ,oIAAQ,CAAC,QAAQ;QAC/B,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAClD,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,SAAS;QAC3D,MAAM,UAAU,MAAM,OAAO;QAE7B,IAAI,CAAC,WAAW,CAAC,SAAS,MAAM,IAAI,MAAM;QAE1C,2BAA2B;QAC3B,kEAAkE;QAClE,+CAA+C;QAC/C,MAAM,oBAAoB,QAAQ,gBAAgB;QAElD,yBAAyB;QACzB,OAAO;YACH;YACA;YACA;YACA,YAAY,QAAQ,MAAM,CAAC,eAAe;QAC9C;IACJ;IAEA,8CAA8C;IAE9C;;;KAGC,GACD,iBAAiB,CACb,aACA;QAEA,MAAM,QAAQ,oIAAQ,CAAC,QAAQ;QAC/B,MAAM,SAAS,oKAAmB;QAElC,mCAAmC;QACnC,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,YAAY,SAAS;QAEvE,2DAA2D;QAC3D,MAAM,qBAAqB;YAAE,GAAG,WAAW;YAAE,IAAI;YAAQ,eAAe;QAAE;QAE1E,MAAM,OAAO,OAAO,oBAAoB,CACpC,oBACA,SACA;QAGJ,oCAAoC;QACpC,MAAM,eAA6B;YAC/B,GAAG,WAAW;YACd,IAAI,OAAO,UAAU;YACrB,eAAe;QACnB;QAEA,qCAAqC;QACrC,0DAA0D;QAC1D,MAAM,eAAe,CAAC;QAEtB,uCAAuC;QACvC,wEAAwE;QACxE,MAAM,YAAY,oIAAQ,CAAC,QAAQ;QACnC,MAAM,cAAc,0JAAc,CAAC,wBAAwB,CACvD,UAAU,OAAO,EACjB,UAAU,SAAS;QAGvB,sCAAsC;QACtC,MAAM,cAAc,CAAC;QAErB,kEAAkE;QAClE,qEAAqE;QACrE,IAAI,YAAY,gBAAgB,GAAG,IAAI;YACnC,MAAM,sBAAsB,CAAC,QAAQ,EAAE,EAAE;QAC7C;QAEA,OAAO;YACH,SAAS;YACT,cAAc;YACd,mBAAmB;QACvB;IACJ;IAEA,+CAA+C;IAE/C;;;KAGC,GACD,iBAAiB;QACb,MAAM,QAAQ,oIAAQ,CAAC,QAAQ;QAE/B,sBAAsB;QACtB,MAAM,cAAc;QAEpB,wCAAwC;QACxC,8EAA8E;QAC9E,MAAM,cAAc,CAAC;QAErB,4DAA4D;QAC5D,+DAA+D;QAC/D,uDAAuD;QACvD,MAAM,QAAQ,CAAC,OAAO,CAAC,CAAA;YACnB,8BAA8B;YAC9B,yDAAyD;YACzD,6BAA6B;YAC7B,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG,QAAQ,SAAS,GAAG;YAChD,MAAM,sBAAsB,CAAC,QAAQ,EAAE,EAAE;QAC7C;QAEA,QAAQ,GAAG,CAAC;IAChB;AACJ"}},
    {"offset": {"line": 8049, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/TimePredictionEngine.ts"],"sourcesContent":["import { Lecture, StudentProfile, SubjectConfig } from '../types';\r\nimport { CognitiveEngine } from './CognitiveEngine';\r\n\r\n/**\r\n * ENGINEERING: TIME PREDICTION ENGINE\r\n * Reference: PHASE_3_LOGIC_SPECIFICATION.md (Section 2)\r\n * \r\n * ROLE:\r\n * Deterministic calculation of expected study duration.\r\n * It enforces \"Time Dilation\" or \"Compression\" based on the Subject's Strictness.\r\n * \r\n * INPUTS:\r\n * - Lecture (Base Duration, Complexity)\r\n * - SubjectConfig (Strictness Level, Treatment)\r\n * - StudentProfile (Consistency Index)\r\n * \r\n * OUTPUTS:\r\n * - Predicted Time (Minutes)\r\n */\r\nexport const TimePredictionEngine = {\r\n\r\n    predictDuration: (\r\n        lecture: Lecture,\r\n        profile: StudentProfile,\r\n        config: SubjectConfig,\r\n        pastSessions: any[] = [] // Typed as any[] to avoid circular dependency, cast to StudySession internally\r\n    ): number => {\r\n        // 1. Determine Effective Student Index for Cognitive Engine\r\n        // CRITICAL FIX: If totalSessions is 0, explicitly pass 0 to trigger \"First-Time Rule\" (x2 Base).\r\n        // Otherwise, use the Lecture's mastery index if available.\r\n        const effectiveIndex = (profile.totalSessions === 0)\r\n            ? 0\r\n            : (lecture.cognitiveIndex ?? null);\r\n\r\n        // 2. Get Deterministic Base from Cognitive Engine (The \"Truth\")\r\n        let projectedMinutes = CognitiveEngine.calculateExpectedStudyTime(\r\n            lecture.duration,\r\n            lecture.relativeDifficulty,\r\n            effectiveIndex\r\n        );\r\n\r\n        // 3. Apply Historical Correction (Optional / Advanced)\r\n        // If we have history, maybe we average the \"Cognitive Base\" with \"Historical Actuals\"?\r\n        // For now, let's trust the Cognitive Engine as the Primary Logic per the Critical Fix prompt.\r\n        // We will Apply the PHYSICS factors (Strictness, Treatment) to this base.\r\n\r\n        // 3. Strictness Physics (The Global Variable)\r\n        // See Phase 3 Spec: \"Time Dilation\" vs \"Compression\"\r\n        switch (config.strictnessLevel) {\r\n            case 'Relaxed':\r\n                // The Exploratory State: +20% buffer for tangents\r\n                projectedMinutes *= 1.2;\r\n                break;\r\n            case 'Standard':\r\n                // The Baseline State: 1.0x\r\n                projectedMinutes *= 1.0;\r\n                break;\r\n            case 'Military':\r\n                // The Compression State: -15% forced efficiency\r\n                // \"Cram Mode\" operationalized.\r\n                projectedMinutes *= 0.85;\r\n                break;\r\n        }\r\n\r\n        // 4. Lecture Treatment (Type Specifics)\r\n        switch (config.lectureTreatment) {\r\n            case 'Intensive':\r\n                // Deep Dive: Requires 50% more time\r\n                projectedMinutes *= 1.5;\r\n                break;\r\n            case 'Review-Only':\r\n                // Skimming: Requires 50% less time\r\n                projectedMinutes *= 0.5;\r\n                break;\r\n            case 'Standard':\r\n            default:\r\n                break;\r\n        }\r\n\r\n        // 5. Student Speed Factor (The Biological Variable)\r\n        // High Consistency (>80) implies flow state capability -> 10% speed bonus\r\n        // Low Consistency (<40) implies distraction -> 10% penalty\r\n        if (profile.consistencyIndex > 80) projectedMinutes *= 0.9;\r\n        if (profile.consistencyIndex < 40) projectedMinutes *= 1.1;\r\n\r\n        // Round to nearest minute to avoid fractional display\r\n        return Math.round(projectedMinutes);\r\n    },\r\n\r\n    /**\r\n     * Calculates the confidence interval (Margin of Error).\r\n     * Returns the +/- minutes range.\r\n     * Military strictness tightens this window.\r\n     */\r\n    calculateConfidence: (predicted: number, config: SubjectConfig): number => {\r\n        switch (config.strictnessLevel) {\r\n            case 'Military': return 0; // No margin allowed.\r\n            case 'Standard': return Math.round(predicted * 0.1); // +/- 10%\r\n            case 'Relaxed': return Math.round(predicted * 0.2); // +/- 20%\r\n        }\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AACA;;AAkBO,MAAM,uBAAuB;IAEhC,iBAAiB,CACb,SACA,SACA,QACA,eAAsB,EAAE,CAAC,+EAA+E;IAAhF;QAExB,4DAA4D;QAC5D,iGAAiG;QACjG,2DAA2D;QAC3D,MAAM,iBAAiB,AAAC,QAAQ,aAAa,KAAK,IAC5C,IACC,QAAQ,cAAc,IAAI;QAEjC,gEAAgE;QAChE,IAAI,mBAAmB,4JAAe,CAAC,0BAA0B,CAC7D,QAAQ,QAAQ,EAChB,QAAQ,kBAAkB,EAC1B;QAGJ,uDAAuD;QACvD,uFAAuF;QACvF,8FAA8F;QAC9F,0EAA0E;QAE1E,8CAA8C;QAC9C,qDAAqD;QACrD,OAAQ,OAAO,eAAe;YAC1B,KAAK;gBACD,kDAAkD;gBAClD,oBAAoB;gBACpB;YACJ,KAAK;gBACD,2BAA2B;gBAC3B,oBAAoB;gBACpB;YACJ,KAAK;gBACD,gDAAgD;gBAChD,+BAA+B;gBAC/B,oBAAoB;gBACpB;QACR;QAEA,wCAAwC;QACxC,OAAQ,OAAO,gBAAgB;YAC3B,KAAK;gBACD,oCAAoC;gBACpC,oBAAoB;gBACpB;YACJ,KAAK;gBACD,mCAAmC;gBACnC,oBAAoB;gBACpB;YACJ,KAAK;YACL;gBACI;QACR;QAEA,oDAAoD;QACpD,0EAA0E;QAC1E,2DAA2D;QAC3D,IAAI,QAAQ,gBAAgB,GAAG,IAAI,oBAAoB;QACvD,IAAI,QAAQ,gBAAgB,GAAG,IAAI,oBAAoB;QAEvD,sDAAsD;QACtD,OAAO,KAAK,KAAK,CAAC;IACtB;IAEA;;;;KAIC,GACD,qBAAqB,CAAC,WAAmB;QACrC,OAAQ,OAAO,eAAe;YAC1B,KAAK;gBAAY,OAAO,GAAG,qBAAqB;YAChD,KAAK;gBAAY,OAAO,KAAK,KAAK,CAAC,YAAY,MAAM,UAAU;YAC/D,KAAK;gBAAW,OAAO,KAAK,KAAK,CAAC,YAAY,MAAM,UAAU;QAClE;IACJ;AACJ"}},
    {"offset": {"line": 8126, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/EndSessionEngine.ts"],"sourcesContent":["import { StudySession } from '../types';\r\n\r\nexport const EndSessionEngine = {\r\n    /**\r\n     * Completes a session and calculates the Performance Index.\r\n     */\r\n    evaluateSession: (\r\n        session: StudySession,\r\n        actualDuration: number\r\n    ): StudySession => {\r\n        // Basic validation\r\n        if (actualDuration < 0) throw new Error(\"Duration cannot be negative\");\r\n\r\n        const expected = session.expectedDuration || actualDuration; // Fallback if 0\r\n\r\n        // --- PERFORMANCE INDEX CALCULATION ---\r\n        // Definition:\r\n        // Index = Efficiency Score (0-100)\r\n\r\n        let performanceIndex = 0;\r\n\r\n        if (expected <= 0) {\r\n            // Edge case: No expectation set. Neutral score.\r\n            performanceIndex = 50;\r\n        } else {\r\n            if (actualDuration <= expected) {\r\n                // Efficient!\r\n                // Ratio > 1.0 implies we were faster than expected.\r\n                // However, user spec says: PerformanceRatio = Same / Same\r\n                // Wait, spec logic:\r\n                // \"PerformanceRatio = ExpectedTime / ActualTime\"\r\n                // If Actual=30, Expected=60 -> Ratio=2.0 -> Score=200?? Clamp to 100.\r\n\r\n                const ratio = expected / Math.max(1, actualDuration);\r\n                performanceIndex = Math.min(100, ratio * 100);\r\n\r\n                // Correction per spec:\r\n                // \"If ActualTime <= ExpectedTime: Index = min(100, PerformanceRatio * 100)\"\r\n                // Example: Exp 60, Act 30. Ratio = 2. Index = 200 -> 100.\r\n                // Example: Exp 60, Act 50. Ratio = 1.2. Index = 120 -> 100.\r\n                // Example: Exp 60, Act 60. Ratio = 1. Index = 100.\r\n                // This implies ANY time faster than expected is 100% score?\r\n                // Spec say: \"Do NOT gamify. Do NOT reward.\" \r\n                // But logically, finishing early is good?\r\n                // Yes, clamp to 100.\r\n\r\n            } else {\r\n                // Slower than expected (Overtime)\r\n                // \"If ActualTime > ExpectedTime: Index = max(0, 100 - ((ActualTime - ExpectedTime) / ExpectedTime) * 100)\"\r\n\r\n                const overtime = actualDuration - expected;\r\n                const penaltyPercentage = (overtime / expected) * 100;\r\n                performanceIndex = Math.max(0, 100 - penaltyPercentage);\r\n\r\n                // Example: Exp 60, Act 90. Overtime 30. Penalty 50%. Index = 50.\r\n                // Example: Exp 60, Act 120. Overtime 60. Penalty 100%. Index = 0.\r\n            }\r\n        }\r\n\r\n        return {\r\n            ...session,\r\n            actualDuration,\r\n            performanceIndex: Math.round(performanceIndex),\r\n            // postUnderstanding removed as it requires user input not present in this flow yet\r\n        };\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAEO,MAAM,mBAAmB;IAC5B;;KAEC,GACD,iBAAiB,CACb,SACA;QAEA,mBAAmB;QACnB,IAAI,iBAAiB,GAAG,MAAM,IAAI,MAAM;QAExC,MAAM,WAAW,QAAQ,gBAAgB,IAAI,gBAAgB,gBAAgB;QAE7E,wCAAwC;QACxC,cAAc;QACd,mCAAmC;QAEnC,IAAI,mBAAmB;QAEvB,IAAI,YAAY,GAAG;YACf,gDAAgD;YAChD,mBAAmB;QACvB,OAAO;YACH,IAAI,kBAAkB,UAAU;gBAC5B,aAAa;gBACb,oDAAoD;gBACpD,0DAA0D;gBAC1D,oBAAoB;gBACpB,iDAAiD;gBACjD,sEAAsE;gBAEtE,MAAM,QAAQ,WAAW,KAAK,GAAG,CAAC,GAAG;gBACrC,mBAAmB,KAAK,GAAG,CAAC,KAAK,QAAQ;YAEzC,uBAAuB;YACvB,4EAA4E;YAC5E,0DAA0D;YAC1D,4DAA4D;YAC5D,mDAAmD;YACnD,4DAA4D;YAC5D,6CAA6C;YAC7C,0CAA0C;YAC1C,qBAAqB;YAEzB,OAAO;gBACH,kCAAkC;gBAClC,2GAA2G;gBAE3G,MAAM,WAAW,iBAAiB;gBAClC,MAAM,oBAAoB,AAAC,WAAW,WAAY;gBAClD,mBAAmB,KAAK,GAAG,CAAC,GAAG,MAAM;YAErC,iEAAiE;YACjE,kEAAkE;YACtE;QACJ;QAEA,OAAO;YACH,GAAG,OAAO;YACV;YACA,kBAAkB,KAAK,KAAK,CAAC;QAEjC;IACJ;AACJ"}},
    {"offset": {"line": 8184, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/SystemAPI.ts"],"sourcesContent":["import { SystemOrchestrator } from './SystemOrchestrator';\r\nimport { useStore } from '../store/useStore';\r\nimport { Lecture, SubjectConfig, StudySession } from './types';\r\nimport { TimePredictionEngine } from './engines/TimePredictionEngine';\r\nimport { EndSessionEngine } from './engines/EndSessionEngine';\r\n\r\n/**\r\n * ENGINEERING: PUBLIC SYSTEM API\r\n * Reference: PHASE_1_SYSTEM_ARCHITECTURE.md\r\n * \r\n * ROLE:\r\n * The \"Control Panel\" interface.\r\n * UI Components MUST use this API for all state mutations.\r\n * Direct access to Store.setState or Engine logic from UI is FORBIDDEN.\r\n */\r\nexport const SystemAPI = {\r\n\r\n    // --- 1. OPERATIONAL COMMANDS ---\r\n\r\n    /**\r\n     * Attempts to initiate a study session.\r\n     * @returns Promise resolving to the session context or rejecting with a Lockout reason.\r\n     */\r\n    requestSessionStart: async (lectureId: string) => {\r\n        // 1. Run Guards\r\n        const check = SystemOrchestrator.canStartSession(lectureId);\r\n\r\n        if (!check.allowed) {\r\n            // UI Handler should catch this and display the Lockout/Override Modal\r\n            return Promise.reject({\r\n                reason: check.reason,\r\n                canOverride: check.overrideRequired\r\n            });\r\n        }\r\n\r\n        // 2. Prepare Context (Predictions)\r\n        return SystemOrchestrator.prepareSession(lectureId);\r\n    },\r\n\r\n    /**\r\n     * Commits a finished session to the permanent log.\r\n     */\r\n    submitSession: (data: {\r\n        lectureId: string;\r\n        subjectId: string;\r\n        actualDuration: number;\r\n        focusPerformance: number;\r\n    }) => {\r\n        const state = useStore.getState();\r\n        const subject = state.subjects.find(s => s.id === data.subjectId);\r\n        const lecture = state.lectures.find(l => l.id === data.lectureId);\r\n        const profile = state.profile;\r\n\r\n        if (!subject || !lecture) throw new Error(\"System Error: Subject context lost during session.\");\r\n\r\n        // Re-calculate expectation to grade performance\r\n        // (We do this here to keep the API stateless, trusting the Engine's determinism)\r\n        const expectedDuration = TimePredictionEngine.predictDuration(lecture, profile, subject.config);\r\n\r\n        const endTime = Date.now();\r\n        // Infer start time (minutes -> ms)\r\n        const startTime = endTime - (data.actualDuration * 60 * 1000);\r\n\r\n        // Construct Base Session\r\n        const sessionBase: StudySession = {\r\n            id: 'temp', // Will be replaced by Finalizer\r\n            lectureId: data.lectureId,\r\n            parentId: data.lectureId, // Defaulting parent to lecture\r\n            subjectId: data.subjectId,\r\n            date: new Date(endTime).toISOString(),\r\n\r\n            startTime,\r\n            endTime,\r\n            status: 'COMPLETED',\r\n\r\n            expectedDuration,\r\n            actualDuration: data.actualDuration,\r\n\r\n            cognitiveCost: 0, // Will be calculated by Finalizer\r\n            performanceIndex: 0, // Will be calculated by EndSessionEngine\r\n            focusPerformance: data.focusPerformance\r\n        };\r\n\r\n        // Calculate Performance Index\r\n        const scoredSession = EndSessionEngine.evaluateSession(sessionBase, data.actualDuration);\r\n\r\n        // Atomic commit via Orchestrator\r\n        return SystemOrchestrator.finalizeSession(\r\n            scoredSession,\r\n            subject.config\r\n        );\r\n    },\r\n\r\n    /**\r\n     * Signals the end of the academic day.\r\n     * Triggers Sleep Cycle and Recovery logic.\r\n     */\r\n    performDailyRecovery: () => {\r\n        SystemOrchestrator.processRecovery();\r\n    },\r\n\r\n    // --- 2. INVENTORY COMMANDS ---\r\n\r\n    /**\r\n     * Registers a new academic input (Lecture) into the system.\r\n     */\r\n    registerInput: (\r\n        subjectId: string,\r\n        input: Omit<Lecture, 'id' | 'status' | 'stability' | 'subjectId' | 'createdAt'>\r\n    ) => {\r\n        const state = useStore.getState();\r\n        const subject = state.subjects.find(s => s.id === subjectId);\r\n\r\n        // Validation: Cannot add input to a locked subject? \r\n        // Logic Phase 3 Spec: \"Gatekeeper Logic\" could go here or in store.\r\n\r\n        const newLecture: Lecture = {\r\n            id: crypto.randomUUID(),\r\n            subjectId,\r\n            status: 'Pending',\r\n            stability: 0, // Brand new\r\n            createdAt: new Date().toISOString(),\r\n            ...input\r\n        };\r\n\r\n        state.addLecture(newLecture);\r\n    },\r\n\r\n    // --- 3. CONFIGURATION COMMANDS ---\r\n\r\n    /**\r\n     * Adjusts the \"Physics\" of a specific Subject.\r\n     * High strictness changes will immediately affect future predictions.\r\n     */\r\n    configureSubject: (subjectId: string, config: Partial<SubjectConfig>) => {\r\n        useStore.getState().updateSubjectConfig(subjectId, config);\r\n    },\r\n\r\n    /**\r\n     * Creates a new Subject Container.\r\n     */\r\n    initializeSubject: (name: string, difficulty: 'Easy' | 'Medium' | 'Hard') => {\r\n        const newSubject = {\r\n            id: crypto.randomUUID(),\r\n            name,\r\n            examDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString(), // Mock 90 days\r\n            difficulty,\r\n            config: {\r\n                // Default \"Standard\" Physics\r\n                lectureTreatment: 'Standard',\r\n                cognitiveThreshold: 100,\r\n                revisionRule: 'Spaced-Repetition',\r\n                strictnessLevel: 'Standard',\r\n                maxDailyLoad: 'Medium'\r\n            },\r\n            metrics: {\r\n                stability: 0,\r\n                readiness: 0,\r\n                totalWeight: 0,\r\n                nextExamCountdown: 90\r\n            }\r\n        };\r\n\r\n        // @ts-ignore - TS types mismatch between 'Subject' partials in store vs strict here?\r\n        // Actually types should align.\r\n        useStore.getState().addSubject(newSubject as any);\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;AACA;;;;;AAWO,MAAM,YAAY;IAErB,kCAAkC;IAElC;;;KAGC,GACD,qBAAqB,OAAO;QACxB,gBAAgB;QAChB,MAAM,QAAQ,uJAAkB,CAAC,eAAe,CAAC;QAEjD,IAAI,CAAC,MAAM,OAAO,EAAE;YAChB,sEAAsE;YACtE,OAAO,QAAQ,MAAM,CAAC;gBAClB,QAAQ,MAAM,MAAM;gBACpB,aAAa,MAAM,gBAAgB;YACvC;QACJ;QAEA,mCAAmC;QACnC,OAAO,uJAAkB,CAAC,cAAc,CAAC;IAC7C;IAEA;;KAEC,GACD,eAAe,CAAC;QAMZ,MAAM,QAAQ,oIAAQ,CAAC,QAAQ;QAC/B,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,SAAS;QAChE,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,SAAS;QAChE,MAAM,UAAU,MAAM,OAAO;QAE7B,IAAI,CAAC,WAAW,CAAC,SAAS,MAAM,IAAI,MAAM;QAE1C,gDAAgD;QAChD,iFAAiF;QACjF,MAAM,mBAAmB,sKAAoB,CAAC,eAAe,CAAC,SAAS,SAAS,QAAQ,MAAM;QAE9F,MAAM,UAAU,KAAK,GAAG;QACxB,mCAAmC;QACnC,MAAM,YAAY,UAAW,KAAK,cAAc,GAAG,KAAK;QAExD,yBAAyB;QACzB,MAAM,cAA4B;YAC9B,IAAI;YACJ,WAAW,KAAK,SAAS;YACzB,UAAU,KAAK,SAAS;YACxB,WAAW,KAAK,SAAS;YACzB,MAAM,IAAI,KAAK,SAAS,WAAW;YAEnC;YACA;YACA,QAAQ;YAER;YACA,gBAAgB,KAAK,cAAc;YAEnC,eAAe;YACf,kBAAkB;YAClB,kBAAkB,KAAK,gBAAgB;QAC3C;QAEA,8BAA8B;QAC9B,MAAM,gBAAgB,8JAAgB,CAAC,eAAe,CAAC,aAAa,KAAK,cAAc;QAEvF,iCAAiC;QACjC,OAAO,uJAAkB,CAAC,eAAe,CACrC,eACA,QAAQ,MAAM;IAEtB;IAEA;;;KAGC,GACD,sBAAsB;QAClB,uJAAkB,CAAC,eAAe;IACtC;IAEA,gCAAgC;IAEhC;;KAEC,GACD,eAAe,CACX,WACA;QAEA,MAAM,QAAQ,oIAAQ,CAAC,QAAQ;QAC/B,MAAM,UAAU,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAElD,qDAAqD;QACrD,oEAAoE;QAEpE,MAAM,aAAsB;YACxB,IAAI,OAAO,UAAU;YACrB;YACA,QAAQ;YACR,WAAW;YACX,WAAW,IAAI,OAAO,WAAW;YACjC,GAAG,KAAK;QACZ;QAEA,MAAM,UAAU,CAAC;IACrB;IAEA,oCAAoC;IAEpC;;;KAGC,GACD,kBAAkB,CAAC,WAAmB;QAClC,oIAAQ,CAAC,QAAQ,GAAG,mBAAmB,CAAC,WAAW;IACvD;IAEA;;KAEC,GACD,mBAAmB,CAAC,MAAc;QAC9B,MAAM,aAAa;YACf,IAAI,OAAO,UAAU;YACrB;YACA,UAAU,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,WAAW;YACrE;YACA,QAAQ;gBACJ,6BAA6B;gBAC7B,kBAAkB;gBAClB,oBAAoB;gBACpB,cAAc;gBACd,iBAAiB;gBACjB,cAAc;YAClB;YACA,SAAS;gBACL,WAAW;gBACX,WAAW;gBACX,aAAa;gBACb,mBAAmB;YACvB;QACJ;QAEA,qFAAqF;QACrF,+BAA+B;QAC/B,oIAAQ,CAAC,QAAQ,GAAG,UAAU,CAAC;IACnC;AACJ"}},
    {"offset": {"line": 8312, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/SubjectDetailView.tsx"],"sourcesContent":["import React from 'react';\r\nimport styles from './Dashboard.module.css'; // Shared styles\r\nimport {\r\n    ArrowLeft,\r\n    Book,\r\n    Clock,\r\n    Play,\r\n    PlusCircle,\r\n    CheckCircle,\r\n    ChevronDown,\r\n    Edit,\r\n    Trash2\r\n} from 'lucide-react';\r\nimport { useStore } from '@/store/useStore';\r\nimport { SessionIntelligenceTable } from './SessionIntelligenceTable';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\nimport { useSubject, useSubjectLectures } from '@/core/hooks';\r\nimport { SystemAPI } from '@/core/SystemAPI';\r\n\r\ninterface SubjectDetailViewProps {\r\n    subjectId: string;\r\n    onBack: () => void;\r\n    onQuestionFlowStart: (flowType: 'LECTURE_INTENT' | 'SESSION_START', contextId?: string, predictedDuration?: number) => void;\r\n}\r\n\r\nexport const SubjectDetailView: React.FC<SubjectDetailViewProps> = ({\r\n    subjectId,\r\n    onBack,\r\n    onQuestionFlowStart\r\n}) => {\r\n    const subject = useSubject(subjectId);\r\n    const lectures = useSubjectLectures(subjectId);\r\n\r\n    // --- CONNECT TO STORE FOR SESSIONS ---\r\n    const { sessions, authState, openAuthModal, renameSubject, deleteSubject } = useStore();\r\n    const subjectSessions = sessions.filter(s => s.subjectId === subjectId);\r\n\r\n    // Guard: Subject missing\r\n    if (!subject) return <div className={styles.errorState}>Subject Not Found</div>;\r\n\r\n    const handleRename = () => {\r\n        const newName = prompt(\"Rename Subject:\", subject.name);\r\n        if (newName && newName.trim() !== \"\") {\r\n            renameSubject(subject.id, newName.trim());\r\n        }\r\n    };\r\n\r\n    const handleDelete = () => {\r\n        if (confirm(`Are you sure you want to delete \"${subject.name}\"? This cannot be undone.`)) {\r\n            deleteSubject(subject.id);\r\n            onBack(); // Return to dashboard\r\n        }\r\n    };\r\n\r\n    const handleStartSession = async (lectureId: string) => {\r\n        try {\r\n            const context = await SystemAPI.requestSessionStart(lectureId);\r\n            onQuestionFlowStart('SESSION_START', lectureId, context.predictedDuration);\r\n        } catch (e: any) {\r\n            alert(`SYSTEM LOCKOUT: ${e.reason}`);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.detailView}>\r\n\r\n            {/* Header with Metrics */}\r\n            <div className={styles.detailHeader}>\r\n                <button onClick={onBack} className={styles.backBtn}>\r\n                    <ArrowLeft size={20} />\r\n                </button>\r\n                <div className={styles.headerInfo}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n                        <h1 className={styles.subjectTitle}>{subject.name}</h1>\r\n                        <button onClick={handleRename} className={styles.iconBtn} title=\"Rename Subject\">\r\n                            <Edit size={16} />\r\n                        </button>\r\n                        <button onClick={handleDelete} className={styles.iconBtn} style={{ color: '#EF4444' }} title=\"Delete Subject\">\r\n                            <Trash2 size={16} />\r\n                        </button>\r\n                    </div>\r\n                    <div className={styles.metaRow}>\r\n                        <span className={`${styles.metaBadge} ${styles.strictnessBadge}`}>\r\n                            {subject.config?.strictnessLevel ?? 0}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                {/* Stats removed as per user request */}\r\n            </div>\r\n\r\n            {/* Control Toolbar */}\r\n            <div className={styles.toolbar}>\r\n                <span className={styles.sectionTitle}>ACADEMIC INPUTS</span>\r\n                <button\r\n                    className={styles.actionBtn}\r\n                    onClick={() => onQuestionFlowStart('LECTURE_INTENT', subjectId)}\r\n                >\r\n                    <PlusCircle size={16} /> INJECT INPUT\r\n                </button>\r\n            </div>\r\n\r\n            {/* NEW: SESSION INTELLIGENCE TABLE */}\r\n            <SessionIntelligenceTable\r\n                subjectId={subjectId}\r\n                lectures={lectures}\r\n                sessions={subjectSessions}\r\n                onStartSession={handleStartSession}\r\n                lang={'en'} // Should be prop, but for now hardcoded or passed from parent? passed props don't have it.\r\n            // Actually SubjectDetailView doesn't receive lang. I should use default or get from somewhere.\r\n            // Assuming 'en' for now or context.\r\n            />\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA,yQAA6C,gBAAgB;AAC7D;AAAA;AAAA;AAAA;AAWA;AACA;AAEA;AACA;;;;;;;;AAQO,MAAM,oBAAsD,CAAC,EAChE,SAAS,EACT,MAAM,EACN,mBAAmB,EACtB;IACG,MAAM,UAAU,IAAA,kIAAU,EAAC;IAC3B,MAAM,WAAW,IAAA,0IAAkB,EAAC;IAEpC,wCAAwC;IACxC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,aAAa,EAAE,aAAa,EAAE,aAAa,EAAE,GAAG,IAAA,oIAAQ;IACrF,MAAM,kBAAkB,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;IAE7D,yBAAyB;IACzB,IAAI,CAAC,SAAS,qBAAO,8OAAC;QAAI,WAAW,kKAAM,CAAC,UAAU;kBAAE;;;;;;IAExD,MAAM,eAAe;QACjB,MAAM,UAAU,OAAO,mBAAmB,QAAQ,IAAI;QACtD,IAAI,WAAW,QAAQ,IAAI,OAAO,IAAI;YAClC,cAAc,QAAQ,EAAE,EAAE,QAAQ,IAAI;QAC1C;IACJ;IAEA,MAAM,eAAe;QACjB,IAAI,QAAQ,CAAC,iCAAiC,EAAE,QAAQ,IAAI,CAAC,yBAAyB,CAAC,GAAG;YACtF,cAAc,QAAQ,EAAE;YACxB,UAAU,sBAAsB;QACpC;IACJ;IAEA,MAAM,qBAAqB,OAAO;QAC9B,IAAI;YACA,MAAM,UAAU,MAAM,qIAAS,CAAC,mBAAmB,CAAC;YACpD,oBAAoB,iBAAiB,WAAW,QAAQ,iBAAiB;QAC7E,EAAE,OAAO,GAAQ;YACb,MAAM,CAAC,gBAAgB,EAAE,EAAE,MAAM,EAAE;QACvC;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAW,kKAAM,CAAC,UAAU;;0BAG7B,8OAAC;gBAAI,WAAW,kKAAM,CAAC,YAAY;;kCAC/B,8OAAC;wBAAO,SAAS;wBAAQ,WAAW,kKAAM,CAAC,OAAO;kCAC9C,cAAA,8OAAC,6NAAS;4BAAC,MAAM;;;;;;;;;;;kCAErB,8OAAC;wBAAI,WAAW,kKAAM,CAAC,UAAU;;0CAC7B,8OAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAQ,YAAY;oCAAU,KAAK;gCAAO;;kDAC7D,8OAAC;wCAAG,WAAW,kKAAM,CAAC,YAAY;kDAAG,QAAQ,IAAI;;;;;;kDACjD,8OAAC;wCAAO,SAAS;wCAAc,WAAW,kKAAM,CAAC,OAAO;wCAAE,OAAM;kDAC5D,cAAA,8OAAC,mNAAI;4CAAC,MAAM;;;;;;;;;;;kDAEhB,8OAAC;wCAAO,SAAS;wCAAc,WAAW,kKAAM,CAAC,OAAO;wCAAE,OAAO;4CAAE,OAAO;wCAAU;wCAAG,OAAM;kDACzF,cAAA,8OAAC,oNAAM;4CAAC,MAAM;;;;;;;;;;;;;;;;;0CAGtB,8OAAC;gCAAI,WAAW,kKAAM,CAAC,OAAO;0CAC1B,cAAA,8OAAC;oCAAK,WAAW,GAAG,kKAAM,CAAC,SAAS,CAAC,CAAC,EAAE,kKAAM,CAAC,eAAe,EAAE;8CAC3D,QAAQ,MAAM,EAAE,mBAAmB;;;;;;;;;;;;;;;;;;;;;;;0BAQpD,8OAAC;gBAAI,WAAW,kKAAM,CAAC,OAAO;;kCAC1B,8OAAC;wBAAK,WAAW,kKAAM,CAAC,YAAY;kCAAE;;;;;;kCACtC,8OAAC;wBACG,WAAW,kKAAM,CAAC,SAAS;wBAC3B,SAAS,IAAM,oBAAoB,kBAAkB;;0CAErD,8OAAC,gOAAU;gCAAC,MAAM;;;;;;4BAAM;;;;;;;;;;;;;0BAKhC,8OAAC,uLAAwB;gBACrB,WAAW;gBACX,UAAU;gBACV,UAAU;gBACV,gBAAgB;gBAChB,MAAM;;;;;;;;;;;;AAMtB"}},
    {"offset": {"line": 8532, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/SubjectSettingsView.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { Subject, SubjectConfig } from '@/core/types';\r\nimport { Settings, Save, AlertTriangle, Shield, Zap } from 'lucide-react';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\n\r\ninterface SubjectSettingsProps {\r\n    subject: Subject;\r\n    onSave: (config: SubjectConfig) => void;\r\n    onCancel: () => void;\r\n    lang: Language;\r\n}\r\n\r\nexport function SubjectSettingsView({ subject, onSave, onCancel, lang }: SubjectSettingsProps) {\r\n    const t = translations[lang];\r\n    const isRtl = lang === 'ar';\r\n\r\n    const [config, setConfig] = useState<SubjectConfig>(subject.config || {\r\n        lectureTreatment: 'Standard',\r\n        cognitiveThreshold: 75,\r\n        revisionRule: 'Spaced-Repetition',\r\n        strictnessLevel: 'Standard',\r\n        maxDailyLoad: 'Medium'\r\n    });\r\n\r\n    const handleChange = (field: keyof SubjectConfig, value: any) => {\r\n        setConfig(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    return (\r\n        <div style={{ padding: '2rem', color: '#F8FAFC', maxWidth: '800px', margin: '0 auto', direction: isRtl ? 'rtl' : 'ltr' }}>\r\n            {/* Header */}\r\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1 style={{ fontSize: '1.5rem', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                        <Settings size={22} color=\"#94A3B8\" />\r\n                        {t.physio_config}\r\n                    </h1>\r\n                    <p style={{ color: '#64748B', fontSize: '0.9rem', marginTop: '0.25rem' }}>\r\n                        {t.sys_regulation}\r\n                    </p>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: '1rem' }}>\r\n                    <button\r\n                        onClick={onCancel}\r\n                        style={{ background: 'transparent', border: '1px solid #334155', color: '#94A3B8', padding: '0.5rem 1rem', borderRadius: '8px', cursor: 'pointer' }}\r\n                    >\r\n                        {t.cancel}\r\n                    </button>\r\n                    <button\r\n                        onClick={() => onSave(config)}\r\n                        style={{\r\n                            background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',\r\n                            border: 'none',\r\n                            color: 'white',\r\n                            padding: '0.5rem 1.5rem',\r\n                            borderRadius: '8px',\r\n                            display: 'flex', alignItems: 'center', gap: '0.5rem',\r\n                            fontWeight: 500,\r\n                            cursor: 'pointer'\r\n                        }}\r\n                    >\r\n                        <Save size={16} /> {t.save_changes}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Panels */}\r\n            <div style={{ display: 'grid', gap: '1.5rem' }}>\r\n\r\n                {/* Strictness Panel */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Shield size={20} color=\"#F59E0B\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.sys_strictness}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '1rem' }}>\r\n                        {[\r\n                            { id: 'Relaxed', label: t.level_relaxed },\r\n                            { id: 'Standard', label: t.level_standard },\r\n                            { id: 'Military', label: t.level_military }\r\n                        ].map((item) => (\r\n                            <div\r\n                                key={item.id}\r\n                                onClick={() => handleChange('strictnessLevel', item.id)}\r\n                                style={{\r\n                                    padding: '1rem',\r\n                                    borderRadius: '12px',\r\n                                    border: config.strictnessLevel === item.id ? '1px solid #F59E0B' : '1px solid rgba(255,255,255,0.05)',\r\n                                    background: config.strictnessLevel === item.id ? 'rgba(245, 158, 11, 0.1)' : 'rgba(255,255,255,0.02)',\r\n                                    cursor: 'pointer',\r\n                                    textAlign: 'center',\r\n                                    transition: 'all 0.2s'\r\n                                }}\r\n                            >\r\n                                <div style={{ fontSize: '0.9rem', fontWeight: 500, color: config.strictnessLevel === item.id ? '#F59E0B' : '#94A3B8' }}>\r\n                                    {item.label}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Cognitive Load Limits */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Zap size={20} color=\"#3B82F6\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.cog_thresholds}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ marginBottom: '1.5rem' }}>\r\n                        <label style={{ display: 'block', fontSize: '0.9rem', color: '#94A3B8', marginBottom: '0.75rem' }}>\r\n                            {t.load_limit_label}\r\n                        </label>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"50\"\r\n                            max=\"100\"\r\n                            value={config.cognitiveThreshold}\r\n                            onChange={(e) => handleChange('cognitiveThreshold', parseInt(e.target.value))}\r\n                            style={{ width: '100%', marginBottom: '0.5rem', direction: 'ltr' }}\r\n                        />\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.8rem', color: '#64748B', direction: 'ltr' }}>\r\n                            <span>{t.limit_conservative}</span>\r\n                            <span style={{ color: '#3B82F6', fontWeight: 600 }}>{config.cognitiveThreshold}%</span>\r\n                            <span>{t.limit_none}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label style={{ display: 'block', fontSize: '0.9rem', color: '#94A3B8', marginBottom: '0.75rem' }}>\r\n                            {t.revision_strategy}\r\n                        </label>\r\n                        <select\r\n                            value={config.revisionRule}\r\n                            onChange={(e) => handleChange('revisionRule', e.target.value)}\r\n                            style={{\r\n                                width: '100%',\r\n                                padding: '0.75rem',\r\n                                background: '#0F172A',\r\n                                border: '1px solid #334155',\r\n                                borderRadius: '8px',\r\n                                color: '#F8FAFC',\r\n                                outline: 'none'\r\n                            }}\r\n                        >\r\n                            <option value=\"Spaced-Repetition\">{t.strat_spaced}</option>\r\n                            <option value=\"Just-in-Time\">{t.strat_jit}</option>\r\n                            <option value=\"Aggressive\">{t.strat_aggressive}</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Alert Area */}\r\n                <div style={{\r\n                    background: 'rgba(239, 68, 68, 0.1)',\r\n                    border: '1px solid rgba(239, 68, 68, 0.2)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem',\r\n                    display: 'flex',\r\n                    alignItems: 'flex-start',\r\n                    gap: '1rem'\r\n                }}>\r\n                    <AlertTriangle size={20} color=\"#EF4444\" style={{ marginTop: '0.2rem', minWidth: '20px' }} />\r\n                    <div>\r\n                        <h4 style={{ color: '#EF4444', fontWeight: 600, fontSize: '0.95rem' }}>{t.sys_override}</h4>\r\n                        <p style={{ color: '#FECACA', fontSize: '0.85rem', marginTop: '0.25rem' }}>\r\n                            {t.override_warning}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9065, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/layout/SessionTimerView.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"btnPause\": \"SessionTimerView-module__7K-8ea__btnPause\",\n  \"btnStart\": \"SessionTimerView-module__7K-8ea__btnStart\",\n  \"btnStop\": \"SessionTimerView-module__7K-8ea__btnStop\",\n  \"container\": \"SessionTimerView-module__7K-8ea__container\",\n  \"controlBtn\": \"SessionTimerView-module__7K-8ea__controlBtn\",\n  \"controls\": \"SessionTimerView-module__7K-8ea__controls\",\n  \"dismissBtn\": \"SessionTimerView-module__7K-8ea__dismissBtn\",\n  \"expectedTime\": \"SessionTimerView-module__7K-8ea__expectedTime\",\n  \"fadeInGlow\": \"SessionTimerView-module__7K-8ea__fadeInGlow\",\n  \"gradeDisplay\": \"SessionTimerView-module__7K-8ea__gradeDisplay\",\n  \"gradeLabel\": \"SessionTimerView-module__7K-8ea__gradeLabel\",\n  \"gradeValue\": \"SessionTimerView-module__7K-8ea__gradeValue\",\n  \"indexDisplay\": \"SessionTimerView-module__7K-8ea__indexDisplay\",\n  \"indexLabel\": \"SessionTimerView-module__7K-8ea__indexLabel\",\n  \"indexValue\": \"SessionTimerView-module__7K-8ea__indexValue\",\n  \"reportCard\": \"SessionTimerView-module__7K-8ea__reportCard\",\n  \"reportHeader\": \"SessionTimerView-module__7K-8ea__reportHeader\",\n  \"statsRow\": \"SessionTimerView-module__7K-8ea__statsRow\",\n  \"timerDisplay\": \"SessionTimerView-module__7K-8ea__timerDisplay\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 9090, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/layout/SessionTimerView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport styles from './SessionTimerView.module.css'; // NEW MODULE\r\nimport { translations, Language } from '@/core/i18n/translations';\r\nimport { useStore } from '@/store/useStore';\r\nimport { Play, Pause, Square } from 'lucide-react';\r\n\r\ninterface SessionTimerViewProps {\r\n    allocatedMinutes: number;\r\n    // We pass lectureId now for persistence\r\n    lectureId: string;\r\n    subjectId: string; // New Prop\r\n    onComplete: (actualMinutes: number) => void;\r\n    lang: Language;\r\n}\r\n\r\nexport const SessionTimerView: React.FC<SessionTimerViewProps> = ({\r\n    allocatedMinutes,\r\n    lectureId,\r\n    subjectId,\r\n    onComplete,\r\n    lang\r\n}) => {\r\n    const t = translations[lang];\r\n    const { activeSession, startActiveSession, pauseActiveSession, resumeActiveSession, endActiveSession } = useStore();\r\n\r\n    // Local display state to avoid jitter from store subscription, although store is fast.\r\n    const [displayTime, setDisplayTime] = useState<number>(0); // ms, start at 00:00:00\r\n    const [isPaused, setIsPaused] = useState(false);\r\n    const [hasStarted, setHasStarted] = useState(false);\r\n\r\n    // Initialize or Sync with Store\r\n    useEffect(() => {\r\n        if (!activeSession) {\r\n            // No active session. Reset to 00:00:00\r\n            setHasStarted(false);\r\n            setDisplayTime(0);\r\n        } else {\r\n            // Resuming existing session\r\n            setHasStarted(true);\r\n            setIsPaused(!!activeSession.pausedAt);\r\n\r\n            // Calculate current elapsed time\r\n            // Logic: current elapsed = now - start - totalPaused\r\n            // If paused, elapsed = pausedAt - start - totalPaused (captured at pause moment)\r\n\r\n            const now = Date.now();\r\n            const effectiveEnd = activeSession.pausedAt || now;\r\n            const elapsed = effectiveEnd - activeSession.startTime - activeSession.totalPausedTime;\r\n\r\n            setDisplayTime(Math.max(0, elapsed));\r\n        }\r\n    }, [activeSession, allocatedMinutes]);\r\n\r\n    // Timer Loop\r\n    useEffect(() => {\r\n        if (!hasStarted || isPaused || !activeSession) return;\r\n\r\n        const interval = setInterval(() => {\r\n            const now = Date.now();\r\n            const elapsed = now - activeSession.startTime - activeSession.totalPausedTime;\r\n\r\n            // Stopwatch Mode: Count Up\r\n            setDisplayTime(elapsed);\r\n\r\n            // 12-Hour Limit Check (43,200,000 ms)\r\n            if (elapsed > 43200000) {\r\n                // Trigger Penalty End\r\n                endActiveSession(true);\r\n                if (typeof window !== 'undefined') {\r\n                    window.alert(\"Session exceeded 12 hours limit! You forgot the timer. (Grade C Assigned)\");\r\n                }\r\n            }\r\n        }, 200); // 5Hz update\r\n\r\n        return () => clearInterval(interval);\r\n    }, [hasStarted, isPaused, activeSession]);\r\n\r\n    // Format HH:MM:SS\r\n    const formatTime = (ms: number) => {\r\n        const totalSeconds = Math.ceil(ms / 1000);\r\n        const h = Math.floor(totalSeconds / 3600);\r\n        const m = Math.floor((totalSeconds % 3600) / 60);\r\n        const s = totalSeconds % 60;\r\n\r\n        const timeString = `${h.toString().padStart(2, '0')} : ${m.toString().padStart(2, '0')} : ${s.toString().padStart(2, '0')}`;\r\n\r\n        if (lang === 'ar') {\r\n            return timeString.replace(/\\d/g, d => ''[parseInt(d)]);\r\n        }\r\n        return timeString;\r\n    };\r\n\r\n\r\n\r\n    // Results State\r\n    const [sessionResult, setSessionResult] = useState<{ grade: string; index: number; duration: number } | null>(null);\r\n\r\n    // [HARDENING] Immediate React to Termination State\r\n    // If the store says \"Terminated\", we MUST show the screen, even if activeSession is null.\r\n    // The previous logic relied on local `sessionResult`. We need to hydrate it.\r\n    const { terminationState } = useStore();\r\n\r\n    useEffect(() => {\r\n        if (terminationState) {\r\n            // Force Show Result Screen\r\n            setSessionResult({\r\n                grade: 'N/A', // Default for interrupted\r\n                index: 0.0,\r\n                duration: Math.max(1, Math.round(displayTime / 1000 / 60))\r\n            });\r\n            setHasStarted(false);\r\n            setIsPaused(false);\r\n        }\r\n    }, [terminationState, displayTime]);\r\n\r\n\r\n    // Format Expected Time\r\n    const formatExpectedTime = (minutes: number) => {\r\n        const h = Math.floor(minutes / 60);\r\n        const m = minutes % 60;\r\n        let timePart = '';\r\n        if (h > 0) timePart += `${h} ${t.hours || 'hours'} `;\r\n        if (m > 0 || h === 0) timePart += `${m} ${t.minutes || 'minutes'}`;\r\n        return `Expected study time for this lecture is '${timePart.trim()}'`;\r\n    };\r\n\r\n    // Actions\r\n    const handleStart = () => {\r\n        if (activeSession) {\r\n            resumeActiveSession();\r\n        } else {\r\n            startActiveSession(lectureId, allocatedMinutes, subjectId);\r\n        }\r\n        setHasStarted(true);\r\n        setIsPaused(false);\r\n    };\r\n\r\n    const handlePause = () => {\r\n        if (activeSession && !activeSession.pausedAt) {\r\n            pauseActiveSession();\r\n            setIsPaused(true);\r\n        }\r\n    };\r\n\r\n    const handleStop = () => {\r\n        if (!activeSession) return;\r\n\r\n        // 1. Calculate final actual duration (Local Display)\r\n        const now = Date.now();\r\n        let endTime = now;\r\n        let finalPaused = activeSession.totalPausedTime;\r\n        if (activeSession.pausedAt) endTime = activeSession.pausedAt;\r\n        const actualDurationMs = endTime - activeSession.startTime - finalPaused;\r\n        const actualMinutes = Math.max(1, Math.round(actualDurationMs / 1000 / 60));\r\n\r\n        // 2. Persist to Store\r\n        endActiveSession();\r\n\r\n        // 3. Display Result (Delayed for store update simulation)\r\n        setTimeout(() => {\r\n            const currentSessions = useStore.getState().sessions;\r\n            const lastSession = currentSessions[currentSessions.length - 1];\r\n            if (lastSession) {\r\n                setSessionResult({\r\n                    grade: (lastSession as any).grade || 'B',\r\n                    index: (lastSession as any).performanceIndex ? (lastSession as any).performanceIndex / 10 : 8.5,\r\n                    duration: actualMinutes\r\n                });\r\n            }\r\n        }, 50);\r\n    };\r\n\r\n    const handleDismissReport = () => {\r\n        if (sessionResult) {\r\n            onComplete(sessionResult.duration);\r\n        }\r\n    };\r\n\r\n    if (sessionResult) {\r\n        return (\r\n            <div className={styles.container}>\r\n                <div className={styles.reportCard}>\r\n\r\n                    {/* [HARDENING] RED WARNING BANNER */}\r\n                    {terminationState && (\r\n                        <div style={{\r\n                            backgroundColor: '#EF4444',\r\n                            color: 'white',\r\n                            padding: '12px',\r\n                            borderRadius: '8px',\r\n                            marginBottom: '16px',\r\n                            fontSize: '13px',\r\n                            fontWeight: 'bold',\r\n                            textAlign: 'center',\r\n                            border: '1px solid #B91C1C',\r\n                            boxShadow: '0 4px 6px -1px rgba(220, 38, 38, 0.3)'\r\n                        }}>\r\n                            <div> SESSION NOTICE</div>\r\n                            <div style={{ fontSize: '11px', fontWeight: 'normal', marginTop: '4px' }}>\r\n                                {terminationState.message}\r\n                            </div>\r\n                            <div style={{ fontSize: '10px', marginTop: '4px', opacity: 0.9 }}>\r\n                                Progress saved. No penalties applied.\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className={styles.reportHeader}>SESSION COMPLETE</div>\r\n\r\n                    <div className={styles.gradeDisplay}>\r\n                        <span className={styles.gradeLabel}>PERFORMANCE GRADE</span>\r\n                        <span className={styles.gradeValue}>{sessionResult.grade}</span>\r\n                    </div>\r\n\r\n                    <div className={styles.indexDisplay}>\r\n                        <span className={styles.indexLabel}>COGNITIVE INDEX</span>\r\n                        <span className={styles.indexValue}>{sessionResult.index.toFixed(1)}</span>\r\n                    </div>\r\n\r\n                    <div className={styles.statsRow}>\r\n                        <div> {sessionResult.duration} min</div>\r\n                        <div> Target: {allocatedMinutes} min</div>\r\n                    </div>\r\n\r\n                    <button className={styles.dismissBtn} onClick={handleDismissReport}>\r\n                        RETURN TO DASHBOARD\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {/* TIMER DISPLAY */}\r\n            <div className={styles.timerDisplay}>\r\n                {formatTime(displayTime)}\r\n            </div>\r\n\r\n            {/* EXECUTIVE CONTROLS */}\r\n            <div className={styles.controls}>\r\n\r\n                {/* GREEN: START / RESUME */}\r\n                <button\r\n                    onClick={handleStart}\r\n                    disabled={hasStarted && !isPaused}\r\n                    className={`${styles.controlBtn} ${styles.btnStart}`}\r\n                    style={{\r\n                        cursor: (hasStarted && !isPaused) ? 'not-allowed' : 'pointer',\r\n                        opacity: (hasStarted && !isPaused) ? 0.3 : 1,\r\n                        transform: (hasStarted && !isPaused) ? 'scale(0.9)' : 'scale(1)'\r\n                    }}\r\n                >\r\n                    <Play fill=\"currentColor\" />\r\n                </button>\r\n\r\n                {/* YELLOW: PAUSE */}\r\n                <button\r\n                    onClick={handlePause}\r\n                    disabled={!hasStarted || isPaused}\r\n                    className={`${styles.controlBtn} ${styles.btnPause}`}\r\n                    style={{\r\n                        cursor: (!hasStarted || isPaused) ? 'not-allowed' : 'pointer',\r\n                        opacity: (!hasStarted || isPaused) ? 0.3 : 1,\r\n                    }}\r\n                >\r\n                    <Pause fill=\"currentColor\" />\r\n                </button>\r\n\r\n                {/* RED: STOP */}\r\n                <button\r\n                    onClick={handleStop}\r\n                    disabled={!hasStarted}\r\n                    className={`${styles.controlBtn} ${styles.btnStop}`}\r\n                    style={{\r\n                        cursor: !hasStarted ? 'not-allowed' : 'pointer',\r\n                        opacity: !hasStarted ? 0.3 : 1,\r\n                    }}\r\n                >\r\n                    <Square fill=\"currentColor\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* EXPECTED TIME DISPLAY (Moved Below Controls) */}\r\n            <div className={styles.expectedTime}>\r\n                {displayTime > allocatedMinutes * 60 * 1000 ? (\r\n                    <span style={{ color: '#F87171', fontWeight: 600, animation: 'pulse 2s infinite' }}>\r\n                        Expected time finished. Continue studying freely  time is still recorded.\r\n                    </span>\r\n                ) : (\r\n                    formatExpectedTime(allocatedMinutes)\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9524, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/HistoryEngine.ts"],"sourcesContent":["import { Lecture, StudySession, Subject } from '../types';\r\n\r\nexport interface StudyRecord {\r\n    id: string;\r\n    subjectId: string;\r\n    subjectName: string;\r\n    itemType: 'LECTURE' | 'SECTION' | 'REVISION' | 'SESSION';\r\n    itemName: string;\r\n    durationMinutes: number;\r\n    difficulty: number;\r\n    grade?: string; // e.g. 'A+', 'B'\r\n    cognitiveIndex?: number; // 0-10\r\n    status: 'COMPLETED' | 'PENDING' | 'IN_PROGRESS';\r\n    dateMeta: {\r\n        fullDate: string; // YYYY-MM-DD\r\n        dayName: string;\r\n        weekIndex: number;\r\n        timestamp: number;\r\n    };\r\n    rawDate: string; // ISO\r\n}\r\n\r\nexport interface WeeklyBlock {\r\n    weekIndex: number;\r\n    label: string; // \"Week 1\"\r\n    startDate: string; // YYYY-MM-DD (Saturday)\r\n    endDate: string; // YYYY-MM-DD (Friday)\r\n    isCurrentWeek: boolean;\r\n    records: StudyRecord[];\r\n    isCompleted: boolean; // All items in this week are green\r\n}\r\n\r\nconst DAY_NAMES = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\n/**\r\n * HISTORY ENGINE\r\n * Aggregates Sessions and Lectures into a unified Weekly Timeline.\r\n * Enforces Saturday -> Friday week logic.\r\n */\r\nexport const HistoryEngine = {\r\n\r\n    /**\r\n     * Main aggregator function.\r\n     */\r\n    getWeeklyHistory: (\r\n        sessions: StudySession[],\r\n        lectures: Lecture[],\r\n        subjects: Subject[]\r\n    ): WeeklyBlock[] => {\r\n        // 1. Flatten all entities into StudyRecords\r\n        const allRecords: StudyRecord[] = [];\r\n\r\n        // A. Process Sessions (Completed Study)\r\n        sessions.forEach(session => {\r\n            const subject = subjects.find(s => s.id === session.subjectId);\r\n\r\n            // Robust Date Handling\r\n            let dateVal = new Date();\r\n            if (session.date) {\r\n                // Handle Firestore Timestamp (if not converted yet)\r\n                if (typeof session.date === 'object' && 'seconds' in (session.date as any)) {\r\n                    dateVal = new Date((session.date as any).seconds * 1000);\r\n                } else {\r\n                    const parsed = new Date(session.date);\r\n                    if (!isNaN(parsed.getTime())) dateVal = parsed;\r\n                }\r\n            } else if (session.startTime) {\r\n                dateVal = new Date(session.startTime);\r\n            }\r\n\r\n            const meta = getDateMeta(dateVal);\r\n\r\n            // Fetch Parent Item Name if possible\r\n            let itemName = 'Study Session';\r\n            let itemType: any = 'SESSION';\r\n\r\n            // Try to resolve parent name\r\n            if (session.lectureId) {\r\n                const parent = lectures.find(l => l.id === session.lectureId);\r\n                if (parent) {\r\n                    itemName = parent.title;\r\n                    itemType = 'SESSION'; // Could display as \"Session: [Lecture Title]\"\r\n                }\r\n            }\r\n\r\n            allRecords.push({\r\n                id: session.id,\r\n                subjectId: session.subjectId,\r\n                subjectName: subject ? subject.name : 'Unknown Subject',\r\n                itemType: itemType,\r\n                itemName: itemName,\r\n                durationMinutes: session.actualDuration || 0,\r\n                difficulty: 5, // Default\r\n                grade: calculateGrade(session.performanceIndex || 0),\r\n                cognitiveIndex: (session.performanceIndex || 0) / 10,\r\n                status: 'COMPLETED',\r\n                dateMeta: meta,\r\n                rawDate: session.date || dateVal.toISOString()\r\n            });\r\n        });\r\n\r\n        // B. Process Lectures (The Content Registry)\r\n        // Lectures technically \"happen\" when created (Registered), or when completed.\r\n        // Rule: Show them on their Creation Date as PENDING.\r\n        // If they have a completed session, they might be marked completed?\r\n        // Requirement: \"Lecture becomes COMPLETED automatically when a session inside is completed\"\r\n        // For history view, we want to see the \"Task\" of the lecture.\r\n\r\n        lectures.forEach(lecture => {\r\n            const subject = subjects.find(s => s.id === lecture.subjectId);\r\n            // Use creation date if available, else fallback to something (or exclude old ones?)\r\n            const dateStr = lecture.createdAt || new Date().toISOString();\r\n            const date = new Date(dateStr);\r\n            const meta = getDateMeta(date);\r\n\r\n            // Determine Status\r\n            // Check if any session exists for this lecture\r\n            const hasCompletedSession = sessions.some(s => s.lectureId === lecture.id && s.status === 'COMPLETED');\r\n            const status = hasCompletedSession ? 'COMPLETED' : 'PENDING';\r\n\r\n            allRecords.push({\r\n                id: lecture.id,\r\n                subjectId: lecture.subjectId,\r\n                subjectName: subject ? subject.name : 'Unknown Subject',\r\n                itemType: 'LECTURE', // Or map from lecture.type\r\n                itemName: lecture.title,\r\n                durationMinutes: lecture.duration,\r\n                difficulty: lecture.relativeDifficulty,\r\n                grade: lecture.grade,\r\n                cognitiveIndex: lecture.cognitiveIndex,\r\n                status: status,\r\n                dateMeta: meta,\r\n                rawDate: dateStr\r\n            });\r\n        });\r\n\r\n        // 2. Group by Week Index\r\n        const flowStart = getSystemStartDate(allRecords); // Find oldest record\r\n        const groups = new Map<number, StudyRecord[]>();\r\n\r\n        allRecords.forEach(record => {\r\n            // Re-calc week index relative to system start to ensure continuity?\r\n            // Actually, simpler: Use absolute week number from epoch or Year?\r\n            // Let's use \"Weeks since System Start\" for now to keep it relative and clean 1, 2, 3...\r\n\r\n            // To do this robustly:\r\n            // Calculate diff in days between record date and flowStart (normalized to previous Saturday)\r\n            const diffTime = Math.abs(record.dateMeta.timestamp - flowStart.getTime());\r\n            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n            const weekIdx = Math.floor(diffDays / 7) + 1;\r\n\r\n            if (!groups.has(weekIdx)) groups.set(weekIdx, []);\r\n            groups.get(weekIdx)!.push(record);\r\n        });\r\n\r\n        // 3. Construct Blocks\r\n        const blocks: WeeklyBlock[] = [];\r\n        const sortedWeekIndices = Array.from(groups.keys()).sort((a, b) => a - b);\r\n\r\n        sortedWeekIndices.forEach(idx => {\r\n            const records = groups.get(idx)!.sort((a, b) => b.dateMeta.timestamp - a.dateMeta.timestamp); // Newest first within week? Or Chronological? Requirement: \"Weeks appear oldest -> newest\". Items inside? Usually chronological.\r\n\r\n            // Re-sort items inside chronological (Sat -> Fri)\r\n            records.sort((a, b) => a.dateMeta.timestamp - b.dateMeta.timestamp);\r\n\r\n            const weekStart = new Date(flowStart);\r\n            weekStart.setDate(flowStart.getDate() + (idx - 1) * 7);\r\n\r\n            const weekEnd = new Date(weekStart);\r\n            weekEnd.setDate(weekStart.getDate() + 6);\r\n\r\n            const isAllCompleted = records.every(r => r.status === 'COMPLETED');\r\n\r\n            blocks.push({\r\n                weekIndex: idx,\r\n                label: `Week ${idx}`,\r\n                startDate: formatDate(weekStart),\r\n                endDate: formatDate(weekEnd),\r\n                isCurrentWeek: isDateInRange(new Date(), weekStart, weekEnd),\r\n                records,\r\n                isCompleted: isAllCompleted\r\n            });\r\n        });\r\n\r\n        return blocks;\r\n    }\r\n};\r\n\r\n// --- HELPERS ---\r\n\r\n// Enforce Saturday Start\r\nfunction getDateMeta(date: Date) {\r\n    return {\r\n        fullDate: date.toISOString().split('T')[0],\r\n        dayName: DAY_NAMES[date.getDay()],\r\n        weekIndex: 0, // Placeholder, calculated later\r\n        timestamp: date.getTime()\r\n    };\r\n}\r\n\r\nfunction getSystemStartDate(records: StudyRecord[]): Date {\r\n    if (records.length === 0) {\r\n        const now = new Date();\r\n        return getPreviousSaturday(now);\r\n    }\r\n\r\n    // Find earliest timestamp\r\n    const stamps = records.map(r => r.dateMeta.timestamp).filter(t => !isNaN(t));\r\n    if (stamps.length === 0) return getPreviousSaturday(new Date());\r\n\r\n    const minTs = Math.min(...stamps);\r\n    return getPreviousSaturday(new Date(minTs));\r\n}\r\n\r\nfunction getPreviousSaturday(date: Date): Date {\r\n    const d = new Date(date);\r\n    const day = d.getDay(); // Sun=0, Sat=6\r\n    // If Sat (6), diff is 0.\r\n    // If Fri (5), diff is 6 (go back 6 days to Sat)\r\n    // If Sun (0), diff is 1 (go back 1 day to Sat)\r\n\r\n    // Target: 6 (Sat). \r\n    // (day + 1) % 7 calculates days passed since Saturday? \r\n    // Sat(6) + 1 = 7 % 7 = 0. Correct.\r\n    // Sun(0) + 1 = 1. Back 1. Correct.\r\n    // Fri(5) + 1 = 6. Back 6. Correct.\r\n\r\n    const diff = (day + 1) % 7;\r\n    d.setDate(d.getDate() - diff);\r\n    d.setHours(0, 0, 0, 0);\r\n    return d;\r\n}\r\n\r\nfunction formatDate(date: Date): string {\r\n    const d = new Date(date);\r\n    const month = d.toLocaleString('default', { month: 'short' });\r\n    const day = d.getDate();\r\n    return `${day} ${month}`;\r\n}\r\n\r\n\r\nfunction isDateInRange(target: Date, start: Date, end: Date) {\r\n    return target >= start && target <= end;\r\n}\r\n\r\nfunction calculateGrade(index: number): string {\r\n    // Index is 0-100 (PerformanceIndex)\r\n    const val = index / 10; // Convert to 0-10\r\n    if (val >= 9.7) return 'A+';\r\n    if (val >= 9.0) return 'A';\r\n    if (val >= 8.5) return 'B+';\r\n    if (val >= 8.0) return 'B';\r\n    if (val >= 7.5) return 'C+';\r\n    if (val >= 7.0) return 'C';\r\n    return 'D';\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9719, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/components/history/HistoryView.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"container\": \"HistoryView-module__rCOO6q__container\",\n  \"currentBadge\": \"HistoryView-module__rCOO6q__currentBadge\",\n  \"dateRange\": \"HistoryView-module__rCOO6q__dateRange\",\n  \"dayCell\": \"HistoryView-module__rCOO6q__dayCell\",\n  \"dayName\": \"HistoryView-module__rCOO6q__dayName\",\n  \"emptyState\": \"HistoryView-module__rCOO6q__emptyState\",\n  \"expanded\": \"HistoryView-module__rCOO6q__expanded\",\n  \"fullDate\": \"HistoryView-module__rCOO6q__fullDate\",\n  \"header\": \"HistoryView-module__rCOO6q__header\",\n  \"historyTable\": \"HistoryView-module__rCOO6q__historyTable\",\n  \"pendingCount\": \"HistoryView-module__rCOO6q__pendingCount\",\n  \"recordRow\": \"HistoryView-module__rCOO6q__recordRow\",\n  \"subjectBadge\": \"HistoryView-module__rCOO6q__subjectBadge\",\n  \"subtitle\": \"HistoryView-module__rCOO6q__subtitle\",\n  \"timeline\": \"HistoryView-module__rCOO6q__timeline\",\n  \"title\": \"HistoryView-module__rCOO6q__title\",\n  \"weekBlock\": \"HistoryView-module__rCOO6q__weekBlock\",\n  \"weekContent\": \"HistoryView-module__rCOO6q__weekContent\",\n  \"weekHeader\": \"HistoryView-module__rCOO6q__weekHeader\",\n  \"weekIndex\": \"HistoryView-module__rCOO6q__weekIndex\",\n  \"weekInfo\": \"HistoryView-module__rCOO6q__weekInfo\",\n  \"weekLabel\": \"HistoryView-module__rCOO6q__weekLabel\",\n  \"weekStatus\": \"HistoryView-module__rCOO6q__weekStatus\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 9748, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/history/HistoryView.tsx"],"sourcesContent":["import React, { useMemo, useState } from 'react';\r\nimport { useStore } from '@/store/useStore';\r\nimport { HistoryEngine, WeeklyBlock, StudyRecord } from '@/core/engines/HistoryEngine';\r\nimport styles from './HistoryView.module.css';\r\nimport { ChevronDown, ChevronRight, CheckCircle, Clock, Calendar } from 'lucide-react';\r\n\r\nexport const HistoryView: React.FC = () => {\r\n    const { sessions, lectures, subjects } = useStore();\r\n\r\n    const weeklyHistory = useMemo(() => {\r\n        return HistoryEngine.getWeeklyHistory(sessions, lectures, subjects);\r\n    }, [sessions, lectures, subjects]);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <header className={styles.header}>\r\n                <h1 className={styles.title}>Academic Timeline</h1>\r\n                <p className={styles.subtitle}>Track your regulation across time.</p>\r\n            </header>\r\n\r\n            <div className={styles.timeline}>\r\n                {weeklyHistory.length === 0 ? (\r\n                    <div className={styles.emptyState}>\r\n                        <Clock size={48} className=\"text-slate-600 mb-4\" />\r\n                        <p>No study history yet. Start your first session to build your academic timeline.</p>\r\n                    </div>\r\n                ) : (\r\n                    weeklyHistory.map(block => (\r\n                        <WeekBlock key={block.weekIndex} block={block} />\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst WeekBlock: React.FC<{ block: WeeklyBlock }> = ({ block }) => {\r\n    const [expanded, setExpanded] = useState(block.isCurrentWeek);\r\n\r\n    return (\r\n        <div className={`${styles.weekBlock} ${expanded ? styles.expanded : ''}`}>\r\n            <div\r\n                className={styles.weekHeader}\r\n                onClick={() => setExpanded(!expanded)}\r\n            >\r\n                <div className={styles.weekInfo}>\r\n                    <div className={styles.weekLabel}>\r\n                        <span className={styles.weekIndex}>{block.label}</span>\r\n                        {block.isCurrentWeek && <span className={styles.currentBadge}>CURRENT</span>}\r\n                    </div>\r\n                    <div className={styles.dateRange}>\r\n                        <Calendar size={14} className=\"mr-2 opacity-50\" />\r\n                        {block.startDate} - {block.endDate}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.weekStatus}>\r\n                    {block.isCompleted ? (\r\n                        <CheckCircle size={20} className=\"text-emerald-500\" />\r\n                    ) : (\r\n                        <div className={styles.pendingCount}>\r\n                            {block.records.filter(r => r.status !== 'COMPLETED').length} Pending\r\n                        </div>\r\n                    )}\r\n                    {expanded ? <ChevronDown size={18} /> : <ChevronRight size={18} />}\r\n                </div>\r\n            </div>\r\n\r\n            {expanded && (\r\n                <div className={styles.weekContent}>\r\n                    <table className={styles.historyTable}>\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Day</th>\r\n                                <th>Subject</th>\r\n                                <th>Item</th>\r\n                                <th>Duration</th>\r\n                                <th>Grade</th>\r\n                                <th>Index</th>\r\n                                <th>Status</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {block.records.map(record => (\r\n                                <tr key={record.id} className={styles.recordRow}>\r\n                                    <td className={styles.dayCell}>\r\n                                        <div className={styles.dayName}>{record.dateMeta.dayName}</div>\r\n                                        <div className={styles.fullDate}>{record.dateMeta.fullDate}</div>\r\n                                    </td>\r\n                                    <td>\r\n                                        <span className={styles.subjectBadge}>{record.subjectName}</span>\r\n                                    </td>\r\n                                    <td>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className={getTypeBadgeClass(record.itemType)}>\r\n                                                {record.itemType}\r\n                                            </span>\r\n                                            <span className=\"font-medium\">{record.itemName}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"font-mono text-sm opacity-70\">\r\n                                        {record.durationMinutes}m\r\n                                    </td>\r\n                                    <td className=\"font-bold text-sm\">\r\n                                        {record.grade || '-'}\r\n                                    </td>\r\n                                    <td className=\"font-mono text-xs opacity-60\">\r\n                                        {record.cognitiveIndex?.toFixed(1) || '-'}\r\n                                    </td>\r\n                                    <td>\r\n                                        <StatusBadge status={record.status} />\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst StatusBadge = ({ status }: { status: string }) => {\r\n    const colors = {\r\n        'COMPLETED': 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',\r\n        'PENDING': 'bg-rose-500/10 text-rose-400 border-rose-500/20',\r\n        'IN_PROGRESS': 'bg-amber-500/10 text-amber-400 border-amber-500/20'\r\n    };\r\n\r\n    // @ts-ignore\r\n    const css = colors[status] || colors['PENDING'];\r\n\r\n    return (\r\n        <span className={`px-2 py-1 rounded text-[10px] font-bold border ${css}`}>\r\n            {status}\r\n        </span>\r\n    );\r\n};\r\n\r\nconst getTypeBadgeClass = (type: string) => {\r\n    // Just returning a class string or inline style for simplicity in this demo\r\n    return \"text-[10px] uppercase tracking-wider opacity-60 mr-2\";\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10194, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/dashboard/SystemConfigView.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { Settings, Save, Smartphone, Shield, Globe, Database, Zap, AlertTriangle } from 'lucide-react';\r\n\r\ninterface SystemConfigViewProps {\r\n    lang: 'en' | 'ar';\r\n}\r\n\r\nexport function SystemConfigView({ lang }: SystemConfigViewProps) {\r\n    const isRtl = lang === 'ar';\r\n    const t = {\r\n        title: lang === 'en' ? 'System Configuration' : ' ',\r\n        subtitle: lang === 'en' ? 'Global settings and system detection' : '    ',\r\n        detect_device: lang === 'en' ? 'Device Detection' : ' ',\r\n        device_status: lang === 'en' ? 'System Status: Optimal' : ' : ',\r\n        sync_status: lang === 'en' ? 'Cloud Sync: Active' : ' : ',\r\n        version: lang === 'en' ? 'Version 1.0.0-PROD' : ' 1.0.0-PROD',\r\n        data_management: lang === 'en' ? 'Data Management' : ' ',\r\n        clear_cache: lang === 'en' ? 'Clear Local Cache' : '  ',\r\n        reset_system: lang === 'en' ? 'Reset System State' : '  ',\r\n\r\n        // Study Logic\r\n        sys_strictness: lang === 'en' ? 'System Strictness' : ' ',\r\n        level_relaxed: lang === 'en' ? 'Relaxed' : '',\r\n        level_standard: lang === 'en' ? 'Standard' : '',\r\n        level_military: lang === 'en' ? 'Military' : '',\r\n        cog_thresholds: lang === 'en' ? 'Cognitive Thresholds' : ' ',\r\n        load_limit_label: lang === 'en' ? 'Daily Load Limit' : '  ',\r\n        limit_conservative: lang === 'en' ? 'Conservative' : '',\r\n        limit_none: lang === 'en' ? 'No Limit' : ' ',\r\n        revision_strategy: lang === 'en' ? 'Revision Strategy' : ' ',\r\n        strat_spaced: lang === 'en' ? 'Spaced Repetition' : ' ',\r\n        strat_jit: lang === 'en' ? 'Just-in-Time' : '  ',\r\n        strat_aggressive: lang === 'en' ? 'Aggressive' : '',\r\n        sys_override: lang === 'en' ? 'System Override Zone' : '  ',\r\n        override_warning: lang === 'en' ? 'Modifying these presets affects the core algorithm of the Agent. Proceed with caution.' : '        .  .'\r\n    };\r\n\r\n    const [deviceStatus, setDeviceStatus] = useState(t.device_status);\r\n\r\n    // Mock Config State for UI Demo\r\n    const [config, setConfig] = useState({\r\n        strictnessLevel: 'Standard',\r\n        cognitiveThreshold: 75,\r\n        revisionRule: 'Spaced-Repetition'\r\n    });\r\n\r\n    const handleChange = (field: string, value: any) => {\r\n        setConfig(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleClearCache = () => {\r\n        if (confirm('Are you sure you want to clear local storage? This will reset your session history.')) {\r\n            localStorage.clear();\r\n            window.location.reload();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{ padding: '2rem', color: '#F8FAFC', maxWidth: '800px', margin: '0 auto', direction: isRtl ? 'rtl' : 'ltr' }}>\r\n            <div style={{ marginBottom: '2rem' }}>\r\n                <h1 style={{ fontSize: '1.5rem', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                    <Settings size={22} color=\"#94A3B8\" />\r\n                    {t.title}\r\n                </h1>\r\n                <p style={{ color: '#64748B', fontSize: '0.9rem', marginTop: '0.25rem' }}>\r\n                    {t.subtitle}\r\n                </p>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gap: '1.5rem' }}>\r\n\r\n                {/* System Status Panel */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Smartphone size={20} color=\"#3B82F6\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.detect_device}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ fontSize: '0.9rem', color: '#CBD5E1', marginBottom: '0.5rem' }}>\r\n                        {deviceStatus}\r\n                    </div>\r\n                    <div style={{ fontSize: '0.8rem', color: '#64748B' }}>\r\n                        User Agent: {typeof navigator !== 'undefined' ? navigator.userAgent : 'Server'}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Strictness Panel */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Shield size={20} color=\"#F59E0B\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.sys_strictness}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '1rem' }}>\r\n                        {[\r\n                            { id: 'Relaxed', label: t.level_relaxed },\r\n                            { id: 'Standard', label: t.level_standard },\r\n                            { id: 'Military', label: t.level_military }\r\n                        ].map((item) => (\r\n                            <div\r\n                                key={item.id}\r\n                                onClick={() => handleChange('strictnessLevel', item.id)}\r\n                                style={{\r\n                                    padding: '1rem',\r\n                                    borderRadius: '12px',\r\n                                    border: config.strictnessLevel === item.id ? '1px solid #F59E0B' : '1px solid rgba(255,255,255,0.05)',\r\n                                    background: config.strictnessLevel === item.id ? 'rgba(245, 158, 11, 0.1)' : 'rgba(255,255,255,0.02)',\r\n                                    cursor: 'pointer',\r\n                                    textAlign: 'center',\r\n                                    transition: 'all 0.2s'\r\n                                }}\r\n                            >\r\n                                <div style={{ fontSize: '0.9rem', fontWeight: 500, color: config.strictnessLevel === item.id ? '#F59E0B' : '#94A3B8' }}>\r\n                                    {item.label}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Cognitive Load Limits */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Zap size={20} color=\"#3B82F6\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.cog_thresholds}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ marginBottom: '1.5rem' }}>\r\n                        <label style={{ display: 'block', fontSize: '0.9rem', color: '#94A3B8', marginBottom: '0.75rem' }}>\r\n                            {t.load_limit_label}\r\n                        </label>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"50\"\r\n                            max=\"100\"\r\n                            value={config.cognitiveThreshold}\r\n                            onChange={(e) => handleChange('cognitiveThreshold', parseInt(e.target.value))}\r\n                            style={{ width: '100%', marginBottom: '0.5rem', direction: 'ltr' }}\r\n                        />\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.8rem', color: '#64748B', direction: 'ltr' }}>\r\n                            <span>{t.limit_conservative}</span>\r\n                            <span style={{ color: '#3B82F6', fontWeight: 600 }}>{config.cognitiveThreshold}%</span>\r\n                            <span>{t.limit_none}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label style={{ display: 'block', fontSize: '0.9rem', color: '#94A3B8', marginBottom: '0.75rem' }}>\r\n                            {t.revision_strategy}\r\n                        </label>\r\n                        <select\r\n                            value={config.revisionRule}\r\n                            onChange={(e) => handleChange('revisionRule', e.target.value)}\r\n                            style={{\r\n                                width: '100%',\r\n                                padding: '0.75rem',\r\n                                background: '#0F172A',\r\n                                border: '1px solid #334155',\r\n                                borderRadius: '8px',\r\n                                color: '#F8FAFC',\r\n                                outline: 'none'\r\n                            }}\r\n                        >\r\n                            <option value=\"Spaced-Repetition\">{t.strat_spaced}</option>\r\n                            <option value=\"Just-in-Time\">{t.strat_jit}</option>\r\n                            <option value=\"Aggressive\">{t.strat_aggressive}</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Alert Area */}\r\n                <div style={{\r\n                    background: 'rgba(239, 68, 68, 0.1)',\r\n                    border: '1px solid rgba(239, 68, 68, 0.2)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem',\r\n                    display: 'flex',\r\n                    alignItems: 'flex-start',\r\n                    gap: '1rem'\r\n                }}>\r\n                    <AlertTriangle size={20} color=\"#EF4444\" style={{ marginTop: '0.2rem', minWidth: '20px' }} />\r\n                    <div>\r\n                        <h4 style={{ color: '#EF4444', fontWeight: 600, fontSize: '0.95rem' }}>{t.sys_override}</h4>\r\n                        <p style={{ color: '#FECACA', fontSize: '0.85rem', marginTop: '0.25rem' }}>\r\n                            {t.override_warning}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Data Management */}\r\n                <div style={{\r\n                    background: 'rgba(30, 41, 59, 0.4)',\r\n                    border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                    borderRadius: '16px',\r\n                    padding: '1.5rem'\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1.5rem' }}>\r\n                        <Database size={20} color=\"#F59E0B\" />\r\n                        <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{t.data_management}</h3>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'flex', gap: '1rem' }}>\r\n                        <button\r\n                            onClick={handleClearCache}\r\n                            style={{\r\n                                background: 'rgba(239, 68, 68, 0.1)',\r\n                                color: '#EF4444',\r\n                                border: '1px solid rgba(239, 68, 68, 0.2)',\r\n                                padding: '0.5rem 1rem',\r\n                                borderRadius: '8px',\r\n                                cursor: 'pointer',\r\n                                fontSize: '0.85rem'\r\n                            }}\r\n                        >\r\n                            {t.clear_cache}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Version Info */}\r\n                <div style={{ textAlign: 'center', marginTop: '2rem', color: '#475569', fontSize: '0.8rem' }}>\r\n                    {t.version}\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10849, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/AcademicStructureEngine.ts"],"sourcesContent":["import { Subject, Lecture, Difficulty, MentalLoad, LectureType } from '../types';\r\nimport { CognitiveEngine } from './CognitiveEngine';\r\n\r\nexport const AcademicStructureEngine = {\r\n    createSubject: (name: string, examDate: string, difficulty: Difficulty): Subject => {\r\n        if (!name) throw new Error(\"Subject name is required\");\r\n        if (!examDate) throw new Error(\"Exam date is required\");\r\n\r\n        return {\r\n            id: crypto.randomUUID(),\r\n            name,\r\n            examDate,\r\n            difficulty, // Normalized from globalDifficulty matching strict types\r\n            config: {\r\n                lectureTreatment: 'Standard',\r\n                cognitiveThreshold: 100,\r\n                revisionRule: 'Spaced-Repetition',\r\n                strictnessLevel: 'Standard',\r\n                maxDailyLoad: 'Medium'\r\n            },\r\n            metrics: {\r\n                stability: 0,\r\n                readiness: 0,\r\n                totalWeight: 0,\r\n                nextExamCountdown: 90 // Default mock\r\n            }\r\n        };\r\n    },\r\n\r\n    createLecture: (\r\n        subjectId: string,\r\n        title: string,\r\n        duration: number,\r\n        understandingScore: number, // 1-10\r\n        mentalLoad: MentalLoad,\r\n        type: LectureType,\r\n        studentState: { phase: 'INIT' | 'NOVICE' | 'ADAPTIVE', index: number }\r\n    ): Lecture => {\r\n        // Basic validation\r\n        if (duration <= 0) throw new Error(\"Duration must be positive\");\r\n\r\n        // --- 1. DURATION SCORE NORMALIZATION ---\r\n        // Step = 1.667 per 15 min block\r\n        let durationScore = 0;\r\n        if (duration <= 15) durationScore = 1.667;\r\n        else if (duration <= 30) durationScore = 3.334;\r\n        else if (duration <= 45) durationScore = 5.001;\r\n        else if (duration <= 60) durationScore = 6.668;\r\n        else if (duration <= 75) durationScore = 8.335;\r\n        else if (duration <= 90) durationScore = 10.002;\r\n        else durationScore = 10; // Cap at 10\r\n\r\n        // Cap strict inputs if needed, though logic above handles ranges\r\n        if (durationScore > 10) durationScore = 10;\r\n\r\n        // --- 2. DIFF CALCULATION ---\r\n        // Diff = (durationScore + (11 - understandingScore)) / 2\r\n        // understandingScore is 1-10 (1=Low understanding/High Diff, 10=High understanding/Low Diff)\r\n\r\n        // Guard understandingScore bounds\r\n        const safeUnderstanding = Math.max(1, Math.min(10, understandingScore));\r\n\r\n        // Invert Scale: 1 -> 10, 10 -> 1 using (11 - score)\r\n        const understandingDifficulty = 11 - safeUnderstanding;\r\n\r\n        const rawDiff = (durationScore + understandingDifficulty) / 2;\r\n\r\n        console.log(\"[DEBUG] CreateLecture Calc:\", {\r\n            duration,\r\n            durationScore,\r\n            understandingScore,\r\n            understandingDifficulty,\r\n            rawDiff\r\n        });\r\n\r\n        // Round to 1 decimal place and clamp\r\n        const relativeDifficulty = Math.max(0, Math.min(10, Math.round(rawDiff * 10) / 10));\r\n\r\n        // Calculate basic weight\r\n        const weight = duration * relativeDifficulty;\r\n\r\n        // --- 3. EXPECTED STUDY TIME (PERSISTENT PHASE) ---\r\n        let expectedDuration = 0;\r\n\r\n        switch (studentState.phase) {\r\n            case 'INIT':\r\n                // [INIT] Pure Safety Rule\r\n                expectedDuration = duration * 2;\r\n                break;\r\n            case 'NOVICE':\r\n                // [NOVICE] Soft Adaptation\r\n                expectedDuration = duration * 2.5;\r\n                break;\r\n            case 'ADAPTIVE':\r\n                // [ADAPTIVE] Engine Calculation\r\n                expectedDuration = CognitiveEngine.calculateExpectedStudyTime(\r\n                    duration,\r\n                    relativeDifficulty,\r\n                    studentState.index\r\n                );\r\n                break;\r\n            default:\r\n                expectedDuration = duration * 2; // Fallback\r\n        }\r\n\r\n        return {\r\n            id: crypto.randomUUID(),\r\n            subjectId,\r\n            title,\r\n            duration,\r\n            type,\r\n            status: 'Pending',\r\n            cognitiveWeight: weight,\r\n            stability: 0,\r\n            relativeDifficulty, // Persisted Strictly\r\n            expectedDuration,\r\n            createdAt: new Date().toISOString()\r\n        };\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AACA;;AAEO,MAAM,0BAA0B;IACnC,eAAe,CAAC,MAAc,UAAkB;QAC5C,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;QAC3B,IAAI,CAAC,UAAU,MAAM,IAAI,MAAM;QAE/B,OAAO;YACH,IAAI,OAAO,UAAU;YACrB;YACA;YACA;YACA,QAAQ;gBACJ,kBAAkB;gBAClB,oBAAoB;gBACpB,cAAc;gBACd,iBAAiB;gBACjB,cAAc;YAClB;YACA,SAAS;gBACL,WAAW;gBACX,WAAW;gBACX,aAAa;gBACb,mBAAmB,GAAG,eAAe;YACzC;QACJ;IACJ;IAEA,eAAe,CACX,WACA,OACA,UACA,oBACA,YACA,MACA;QAEA,mBAAmB;QACnB,IAAI,YAAY,GAAG,MAAM,IAAI,MAAM;QAEnC,0CAA0C;QAC1C,gCAAgC;QAChC,IAAI,gBAAgB;QACpB,IAAI,YAAY,IAAI,gBAAgB;aAC/B,IAAI,YAAY,IAAI,gBAAgB;aACpC,IAAI,YAAY,IAAI,gBAAgB;aACpC,IAAI,YAAY,IAAI,gBAAgB;aACpC,IAAI,YAAY,IAAI,gBAAgB;aACpC,IAAI,YAAY,IAAI,gBAAgB;aACpC,gBAAgB,IAAI,YAAY;QAErC,iEAAiE;QACjE,IAAI,gBAAgB,IAAI,gBAAgB;QAExC,8BAA8B;QAC9B,yDAAyD;QACzD,6FAA6F;QAE7F,kCAAkC;QAClC,MAAM,oBAAoB,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI;QAEnD,oDAAoD;QACpD,MAAM,0BAA0B,KAAK;QAErC,MAAM,UAAU,CAAC,gBAAgB,uBAAuB,IAAI;QAE5D,QAAQ,GAAG,CAAC,+BAA+B;YACvC;YACA;YACA;YACA;YACA;QACJ;QAEA,qCAAqC;QACrC,MAAM,qBAAqB,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,CAAC,UAAU,MAAM;QAE/E,yBAAyB;QACzB,MAAM,SAAS,WAAW;QAE1B,oDAAoD;QACpD,IAAI,mBAAmB;QAEvB,OAAQ,aAAa,KAAK;YACtB,KAAK;gBACD,0BAA0B;gBAC1B,mBAAmB,WAAW;gBAC9B;YACJ,KAAK;gBACD,2BAA2B;gBAC3B,mBAAmB,WAAW;gBAC9B;YACJ,KAAK;gBACD,gCAAgC;gBAChC,mBAAmB,4JAAe,CAAC,0BAA0B,CACzD,UACA,oBACA,aAAa,KAAK;gBAEtB;YACJ;gBACI,mBAAmB,WAAW,GAAG,WAAW;QACpD;QAEA,OAAO;YACH,IAAI,OAAO,UAAU;YACrB;YACA;YACA;YACA;YACA,QAAQ;YACR,iBAAiB;YACjB,WAAW;YACX;YACA;YACA,WAAW,IAAI,OAAO,WAAW;QACrC;IACJ;AACJ"}},
    {"offset": {"line": 10950, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/PreStudyEngine.ts"],"sourcesContent":["import { Lecture, StudySession, MentalLoad } from '../types';\r\nimport { CognitiveEngine } from './CognitiveEngine';\r\n\r\nexport const PreStudyEngine = {\r\n    /**\r\n     * Helper: Converts numerical difficulty (0-10) to MentalLoad category.\r\n     */\r\n    getMentalLoad: (difficulty: number): MentalLoad => {\r\n        if (difficulty >= 8) return 'High';\r\n        if (difficulty >= 4) return 'Medium';\r\n        return 'Low';\r\n    },\r\n\r\n    /**\r\n     * Calculates the Initial Cognitive Resistance (ICR).\r\n     * Range: 0 (No resistance) to 1.0 (Maximum resistance/friction)\r\n     * High resistance means the student is likely to procrastinate or find it hard to start.\r\n     */\r\n    calculateInitialResistance: (\r\n        attentionLevel: 'Low' | 'Medium' | 'High',\r\n        lectureMentalLoad: MentalLoad\r\n    ): number => {\r\n        let resistance = 0.5; // Base friction\r\n\r\n        // Mental Load Impact\r\n        if (lectureMentalLoad === 'High') resistance += 0.2;\r\n        if (lectureMentalLoad === 'Low') resistance -= 0.1;\r\n\r\n        // Attention Impact (Inverse: Low attention = High resistance)\r\n        if (attentionLevel === 'Low') resistance += 0.3; // Hard to study what you ignored\r\n        if (attentionLevel === 'High') resistance -= 0.2; // Easy to study what you focused on\r\n\r\n        return Math.min(Math.max(resistance, 0.1), 1.0);\r\n    },\r\n\r\n    /**\r\n     * Registers a session and returns the valid session object.\r\n     * Throws error if pre-conditions are not met.\r\n     */\r\n    registerSession: (\r\n        lecture: Lecture,\r\n        preUnderstanding: number, // 0-100\r\n        attentionLevel: 'Low' | 'Medium' | 'High'\r\n    ): StudySession => {\r\n        if (preUnderstanding < 0 || preUnderstanding > 100) {\r\n            throw new Error(\"Understanding must be 0-100\");\r\n        }\r\n\r\n        // Logic: If resistance is too high, maybe warn? (Handled by UI/Smart Warning Engine)\r\n\r\n        // Derive Mental Load\r\n        const mentalLoad = PreStudyEngine.getMentalLoad(lecture.relativeDifficulty);\r\n\r\n        // We calculate these for the predictive engines later\r\n        const resistance = PreStudyEngine.calculateInitialResistance(attentionLevel, mentalLoad);\r\n\r\n        const startTime = Date.now();\r\n\r\n        return {\r\n            id: crypto.randomUUID(),\r\n            lectureId: lecture.id,\r\n            parentId: lecture.id,\r\n            subjectId: lecture.subjectId,\r\n            date: new Date(startTime).toISOString(), // Temporary, usually completion date\r\n\r\n            startTime: startTime,\r\n            endTime: null,\r\n            status: 'IN_PROGRESS',\r\n\r\n            expectedDuration: CognitiveEngine.calculateExpectedStudyTime(lecture.duration, lecture.relativeDifficulty),\r\n            actualDuration: 0,\r\n            cognitiveCost: 0,\r\n            performanceIndex: 0,\r\n            focusPerformance: 0,\r\n\r\n            preUnderstanding,\r\n            // focusWindowAttempted: 25, // Removed as it is not in StudySession type\r\n        };\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AACA;;AAEO,MAAM,iBAAiB;IAC1B;;KAEC,GACD,eAAe,CAAC;QACZ,IAAI,cAAc,GAAG,OAAO;QAC5B,IAAI,cAAc,GAAG,OAAO;QAC5B,OAAO;IACX;IAEA;;;;KAIC,GACD,4BAA4B,CACxB,gBACA;QAEA,IAAI,aAAa,KAAK,gBAAgB;QAEtC,qBAAqB;QACrB,IAAI,sBAAsB,QAAQ,cAAc;QAChD,IAAI,sBAAsB,OAAO,cAAc;QAE/C,8DAA8D;QAC9D,IAAI,mBAAmB,OAAO,cAAc,KAAK,iCAAiC;QAClF,IAAI,mBAAmB,QAAQ,cAAc,KAAK,oCAAoC;QAEtF,OAAO,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,YAAY,MAAM;IAC/C;IAEA;;;KAGC,GACD,iBAAiB,CACb,SACA,kBACA;QAEA,IAAI,mBAAmB,KAAK,mBAAmB,KAAK;YAChD,MAAM,IAAI,MAAM;QACpB;QAEA,qFAAqF;QAErF,qBAAqB;QACrB,MAAM,aAAa,eAAe,aAAa,CAAC,QAAQ,kBAAkB;QAE1E,sDAAsD;QACtD,MAAM,aAAa,eAAe,0BAA0B,CAAC,gBAAgB;QAE7E,MAAM,YAAY,KAAK,GAAG;QAE1B,OAAO;YACH,IAAI,OAAO,UAAU;YACrB,WAAW,QAAQ,EAAE;YACrB,UAAU,QAAQ,EAAE;YACpB,WAAW,QAAQ,SAAS;YAC5B,MAAM,IAAI,KAAK,WAAW,WAAW;YAErC,WAAW;YACX,SAAS;YACT,QAAQ;YAER,kBAAkB,4JAAe,CAAC,0BAA0B,CAAC,QAAQ,QAAQ,EAAE,QAAQ,kBAAkB;YACzG,gBAAgB;YAChB,eAAe;YACf,kBAAkB;YAClB,kBAAkB;YAElB;QAEJ;IACJ;AACJ"}},
    {"offset": {"line": 11013, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/engines/StudentProfilerEngine.ts"],"sourcesContent":["import { StudentProfile, StudySession } from '../types';\r\n\r\nexport const StudentProfilerEngine = {\r\n    /**\r\n     * Updates the invisible profile stats based on the last session.\r\n     * \"Build an internal, invisible profile including: Study speed, Efficiency, etc.\"\r\n     */\r\n    updateProfile: (profile: StudentProfile, session: StudySession): StudentProfile => {\r\n        // 1. Consistency Index Update\r\n        // If session completed -> +0.02\r\n        // If session abandoned -> -0.05\r\n        let newConsistency = profile.consistencyIndex;\r\n        if (session.endTime) {\r\n            newConsistency = Math.min(newConsistency + 0.02, 1.0);\r\n        } else {\r\n            newConsistency = Math.max(newConsistency - 0.05, 0.0);\r\n        }\r\n\r\n        // 2. Base Speed / Efficiency Update (Simplistic for now)\r\n        // If actualDuration < predicted -> Speed might be higher\r\n        // Need access to lecture duration/weights to calculate true speed.\r\n\r\n        // 3. Fatigue Recovery Rate\r\n        // Dynamic adjustment based on consecutive sessions?\r\n\r\n        return {\r\n            ...profile,\r\n            consistencyIndex: Number(newConsistency.toFixed(3))\r\n        };\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAEO,MAAM,wBAAwB;IACjC;;;KAGC,GACD,eAAe,CAAC,SAAyB;QACrC,8BAA8B;QAC9B,gCAAgC;QAChC,gCAAgC;QAChC,IAAI,iBAAiB,QAAQ,gBAAgB;QAC7C,IAAI,QAAQ,OAAO,EAAE;YACjB,iBAAiB,KAAK,GAAG,CAAC,iBAAiB,MAAM;QACrD,OAAO;YACH,iBAAiB,KAAK,GAAG,CAAC,iBAAiB,MAAM;QACrD;QAEA,yDAAyD;QACzD,yDAAyD;QACzD,mEAAmE;QAEnE,2BAA2B;QAC3B,oDAAoD;QAEpD,OAAO;YACH,GAAG,OAAO;YACV,kBAAkB,OAAO,eAAe,OAAO,CAAC;QACpD;IACJ;AACJ"}},
    {"offset": {"line": 11046, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/layout/MainApp.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { FlowEngine, FlowContext } from '@/core/engines/FlowEngine';\r\nimport { SingleQuestionView } from '@/components/layout/SingleQuestionView';\r\nimport { ControlLayout } from '@/components/dashboard/ControlLayout';\r\nimport { DashboardView } from '@/components/dashboard/DashboardView';\r\nimport { SubjectDetailView } from '@/components/dashboard/SubjectDetailView';\r\nimport { SubjectSettingsView } from '@/components/dashboard/SubjectSettingsView';\r\nimport { SessionTimerView } from '@/components/layout/SessionTimerView';\r\nimport { HistoryView } from '@/components/history/HistoryView';\r\nimport { SystemConfigView } from '@/components/dashboard/SystemConfigView';\r\nimport { AcademicStructureEngine } from '@/core/engines/AcademicStructureEngine';\r\nimport { PreStudyEngine } from '@/core/engines/PreStudyEngine';\r\nimport { StudentProfilerEngine } from '@/core/engines/StudentProfilerEngine';\r\nimport { EndSessionEngine } from '@/core/engines/EndSessionEngine';\r\nimport { CapacityEngine } from '@/core/engines/CapacityEngine';\r\nimport { useStore } from '@/store/useStore';\r\nimport { translations, Language } from '@/core/i18n/translations';\r\nimport { Lecture } from '@/core/types';\r\n\r\n// Helper to get translated string\r\nconst t = (key: string, lang: Language) => {\r\n    // @ts-ignore\r\n    return translations[lang][key] || key;\r\n};\r\n\r\nexport function MainApp() {\r\n    const [context, setContext] = useState<FlowContext>(FlowEngine.getInitialState());\r\n    const [inputValue, setInputValue] = useState<any>(null);\r\n\r\n    // App State\r\n    const [language, setLanguage] = useState<Language>('en');\r\n    const [theme, setTheme] = useState<'light' | 'dark'>('dark');\r\n\r\n    // Zustand Store\r\n    const { subjects, lectures, addSubject, registerSession, setProfile, profile, sessions, dailyLoad, addLecture, syncAuth } = useStore();\r\n\r\n    // Theme Effect\r\n    useEffect(() => {\r\n        document.documentElement.setAttribute('data-theme', theme);\r\n        document.documentElement.setAttribute('dir', language === 'ar' ? 'rtl' : 'ltr');\r\n    }, [theme, language]);\r\n\r\n    // Timeout Modal State\r\n    const [timeoutModal, setTimeoutModal] = useState(false);\r\n\r\n    // Active Session Persistence Check & GLOBAL GUARD\r\n    const { activeSession, endActiveSession } = useStore();\r\n    useEffect(() => {\r\n        // 1. Navigation Logic (If active, force Execution View)\r\n        if (activeSession && activeSession.isActive && context.currentState !== 'STUDY_EXECUTION') {\r\n            setContext(prev => ({\r\n                ...prev,\r\n                currentState: 'STUDY_EXECUTION',\r\n                selectedSubjectId: activeSession.lectureId\r\n            }));\r\n        }\r\n\r\n        // 2. SAFETY GUARD: 12-Hour Limit Check (Global)\r\n        let interval: NodeJS.Timeout;\r\n        if (activeSession && activeSession.isActive) {\r\n            // Initial check immediately\r\n            const check = () => {\r\n                const now = Date.now();\r\n                const elapsed = now - activeSession.startTime - activeSession.totalPausedTime;\r\n                // 12 Hours = 43,200,000 ms\r\n                if (elapsed > 43200000) {\r\n                    console.warn(\"[Global Guard] Session exceeded 12 hours. Force closing.\");\r\n                    endActiveSession(true); // Persists to Firestore now\r\n                    setTimeoutModal(true); // Show UI Overlay\r\n\r\n                    // Force Context Reset to Dashboard\r\n                    setContext(prev => ({ ...prev, currentState: 'DASHBOARD_HOME' }));\r\n\r\n                    return true;\r\n                }\r\n                return false;\r\n            };\r\n\r\n            if (!check()) {\r\n                interval = setInterval(check, 60000); // Check every 60 seconds\r\n            }\r\n        }\r\n\r\n        return () => {\r\n            if (interval) clearInterval(interval);\r\n        };\r\n    }, [activeSession, context.currentState]); // Added dependency\r\n\r\n    // --- HELPER FUNCTIONS ---\r\n    const handleNext = (overrideInput?: any) => {\r\n        const input = overrideInput !== undefined ? overrideInput : inputValue;\r\n        let nextContext = { ...context };\r\n\r\n        try {\r\n            // --- AUTH & SETUP ---\r\n            if (context.currentState === 'SUBJECT_LIST') {\r\n                if (input === 'ADD_SUBJECT') {\r\n                    nextContext.currentState = 'SUBJECT_ADD_NAME';\r\n                } else {\r\n                    // Input is Subject ID\r\n                    nextContext.selectedSubjectId = input;\r\n                }\r\n            }\r\n\r\n            if (context.currentState === 'SUBJECT_ADD_NAME') {\r\n                const subjectName = input;\r\n                if (subjectName) {\r\n                    const newSubject = AcademicStructureEngine.createSubject(subjectName, new Date().toISOString(), 'Medium');\r\n                    addSubject(newSubject);\r\n                    nextContext.selectedSubjectId = newSubject.id;\r\n                }\r\n            }\r\n\r\n            if (context.currentState === 'SUBJECT_SETUP_DATE') {\r\n                console.log(`[System] Exam Date: ${input}`);\r\n                // Save date logic...\r\n            }\r\n\r\n            if (context.currentState === 'INTENT_ACTION') {\r\n                nextContext.actionType = input === 'ACTION_REGISTER' ? 'REGISTER' : 'STUDY';\r\n            }\r\n\r\n            // --- REGISTRATION FLOW ---\r\n            if (context.currentState === 'REG_TYPE') nextContext.tempRegistration = { ...nextContext.tempRegistration!, type: input };\r\n            if (context.currentState === 'REG_DURATION') nextContext.tempRegistration = { ...nextContext.tempRegistration!, duration: input };\r\n            if (context.currentState === 'REG_UNDERSTANDING') {\r\n                nextContext.tempRegistration = { ...nextContext.tempRegistration!, understanding: input };\r\n\r\n                // AUTO-COMPLETE REGISTRATION\r\n                const mentalLoadVal: 'Low' | 'Medium' | 'High' = 'Medium';\r\n                const understandingScore = Number(input);\r\n\r\n                const studentState = {\r\n                    phase: profile ? (profile.learningPhase || 'INIT') : 'INIT',\r\n                    index: profile ? (profile.consistencyIndex / 10) : 0\r\n                };\r\n\r\n                const newLecture = AcademicStructureEngine.createLecture(\r\n                    context.selectedSubjectId!,\r\n                    `Registered Class`,\r\n                    nextContext.tempRegistration!.duration,\r\n                    understandingScore,\r\n                    mentalLoadVal,\r\n                    nextContext.tempRegistration!.type as any,\r\n                    studentState\r\n                );\r\n                addLecture(newLecture);\r\n                nextContext.feedbackMessage = t('cycle_complete', language);\r\n            }\r\n\r\n            // --- STUDY FLOW ---\r\n            if (context.currentState === 'CALIBRATION_TIME') {\r\n                const studentState = {\r\n                    phase: profile ? (profile.learningPhase || 'INIT') : 'INIT',\r\n                    index: profile ? (profile.consistencyIndex / 10) : 0\r\n                };\r\n\r\n                const adHocLecture = AcademicStructureEngine.createLecture(\r\n                    context.selectedSubjectId!,\r\n                    `Session`,\r\n                    inputValue,\r\n                    5,\r\n                    'Medium',\r\n                    'Theory',\r\n                    studentState\r\n                );\r\n                addLecture(adHocLecture);\r\n\r\n                const focusLevel = context.tempCalibration.focus > 66 ? 'High' : 'Medium';\r\n                const session = PreStudyEngine.registerSession(adHocLecture, context.tempCalibration.familiarity, focusLevel);\r\n                registerSession(session);\r\n                nextContext.currentSessionId = session.id;\r\n            }\r\n\r\n            if (context.currentState === 'REFLECTION_CHECK') {\r\n                if (context.currentSessionId && profile && dailyLoad) {\r\n                    const endedSession = EndSessionEngine.evaluateSession(\r\n                        sessions.find(s => s.id === context.currentSessionId)!,\r\n                        context.tempCalibration.time\r\n                    );\r\n                    const newProfile = StudentProfilerEngine.updateProfile(profile, endedSession);\r\n                    setProfile(newProfile);\r\n                }\r\n                nextContext.feedbackMessage = t('cycle_complete', language);\r\n            }\r\n\r\n            const nextState = FlowEngine.nextState(context.currentState, input);\r\n            setContext({ ...nextContext, currentState: nextState });\r\n\r\n        } catch (e) {\r\n            console.error(\"Engine Error:\", e);\r\n        }\r\n    };\r\n\r\n    const handleSessionComplete = (actualMinutes: number) => {\r\n        setContext(prev => {\r\n            const updated = {\r\n                ...prev,\r\n                tempCalibration: {\r\n                    ...prev.tempCalibration,\r\n                    time: actualMinutes\r\n                }\r\n            };\r\n            const nextState = FlowEngine.nextState('STUDY_EXECUTION', null);\r\n            return { ...updated, currentState: nextState };\r\n        });\r\n    };\r\n\r\n    const getQuestionProps = () => {\r\n        // ... Logic preserved from page.tsx ...\r\n        switch (context.currentState) {\r\n            case 'ORIENTATION': return { inputType: 'none' as const };\r\n            case 'SUBJECT_LIST':\r\n                return {\r\n                    inputType: 'grid' as const,\r\n                    options: [\r\n                        ...subjects.map(s => ({ label: s.name, value: s.id })),\r\n                        { label: t('add_subject', language), value: 'ADD_SUBJECT' }\r\n                    ]\r\n                };\r\n            case 'SUBJECT_ADD_NAME': return { inputType: 'text' as const, placeholder: t('subject_name', language) };\r\n            case 'SUBJECT_SETUP_DATE': return { inputType: 'date' as const };\r\n            case 'INTENT': return { inputType: 'none' as const };\r\n            case 'INTENT_ACTION':\r\n                return {\r\n                    inputType: 'grid' as const,\r\n                    options: [\r\n                        { label: t('study_now', language), value: 'ACTION_STUDY' },\r\n                        { label: t('register_class', language), value: 'ACTION_REGISTER' }\r\n                    ]\r\n                };\r\n            case 'REG_TYPE':\r\n                return {\r\n                    inputType: 'grid' as const,\r\n                    options: [\r\n                        { label: t('theory', language), value: 'Theory' },\r\n                        { label: t('practical', language), value: 'Practical' },\r\n                        { label: t('revision', language), value: 'Revision' }\r\n                    ]\r\n                };\r\n            case 'REG_DURATION':\r\n                return {\r\n                    inputType: 'grid' as const,\r\n                    options: [\r\n                        { label: t('min_15', language), value: 15 },\r\n                        { label: t('min_30', language), value: 30 },\r\n                        { label: t('min_45', language), value: 45 },\r\n                        { label: t('hr_1', language), value: 60 },\r\n                        { label: t('hr_1_15', language), value: 75 },\r\n                        { label: t('hr_1_30', language), value: 90 },\r\n                        { label: t('hr_1_45', language), value: 105 },\r\n                        { label: t('hr_2', language), value: 120 },\r\n                    ]\r\n                };\r\n            case 'REG_UNDERSTANDING': return { inputType: 'slider' as const };\r\n            case 'REG_DEMAND':\r\n                return {\r\n                    inputType: 'grid' as const,\r\n                    options: [\r\n                        { label: t('very_light', language), value: 'Very Light' },\r\n                        { label: t('light', language), value: 'Light' },\r\n                        { label: t('moderate', language), value: 'Moderate' },\r\n                        { label: t('heavy', language), value: 'Heavy' },\r\n                        { label: t('very_heavy', language), value: 'Very Heavy' },\r\n                    ]\r\n                };\r\n            case 'CALIBRATION_FAMILIARITY': return { inputType: 'slider' as const };\r\n            case 'CALIBRATION_FOCUS': return { inputType: 'slider' as const };\r\n            case 'CALIBRATION_TIME': return { inputType: 'slider' as const };\r\n            case 'REFLECTION_CHECK': return { inputType: 'binary' as const };\r\n            case 'REFLECTION_REASON': return { inputType: 'text' as const, placeholder: 'Briefly explain...' };\r\n            case 'SUMMARY': return { inputType: 'none' as const };\r\n            default: return { inputType: 'none' as const };\r\n        }\r\n    };\r\n\r\n    // Reset input when state changes (MOVED BELOW DECLARATIONS)\r\n    useEffect(() => {\r\n        setInputValue(null); // Clear input on every state change\r\n\r\n        // Reset inputs based on state defaults...\r\n        if (context.currentState === 'CALIBRATION_FAMILIARITY') setInputValue(50);\r\n        if (context.currentState === 'CALIBRATION_FOCUS') setInputValue(50);\r\n        if (context.currentState === 'CALIBRATION_TIME') setInputValue(30);\r\n        if (context.currentState === 'REG_UNDERSTANDING') setInputValue(5);\r\n        if (context.currentState === 'REG_DURATION') setInputValue(60);\r\n\r\n        // Orientation Auto-Advance\r\n        if (context.currentState === 'ORIENTATION') {\r\n            const timer = setTimeout(() => handleNext('AUTO_ORIENT'), 4000);\r\n            return () => clearTimeout(timer);\r\n        }\r\n\r\n        // Summary Auto-Advance\r\n        if (context.currentState === 'SUMMARY') {\r\n            const timer = setTimeout(() => handleNext(), 2000); // 2s delay\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [context.currentState]);\r\n\r\n    // --- TIMEOUT MODAL OVERLAY ---\r\n    const renderTimeoutModal = () => {\r\n        if (!timeoutModal) return null;\r\n        return (\r\n            <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-300\">\r\n                <div className=\"bg-[#0f1523] border border-red-500/30 rounded-2xl p-8 max-w-md w-full shadow-2xl text-center\">\r\n                    <div className=\"w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                        <span className=\"text-3xl\"></span>\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-white mb-2\">Session Terminated</h2>\r\n                    <p className=\"text-slate-400 mb-6\">\r\n                        Your session exceeded the 12-hour active limit and was automatically closed with a penalty (Grade C).\r\n                    </p>\r\n                    <button\r\n                        onClick={() => setTimeoutModal(false)}\r\n                        className=\"w-full py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-medium transition-colors\"\r\n                    >\r\n                        Acknowledge & Return\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // --- APP CONTENT ---\r\n    return (\r\n        <>\r\n            {renderTimeoutModal()}\r\n            {renderContent()}\r\n        </>\r\n    );\r\n\r\n    function renderContent() {\r\n\r\n\r\n        // --- DASHBOARD ROUTER ---\r\n        if (['SUBJECT_LIST', 'DASHBOARD_SUBJECT', 'DASHBOARD_SETTINGS', 'DASHBOARD_HOME', 'DASHBOARD_HISTORY', 'DASHBOARD_CONFIG'].includes(context.currentState)) {\r\n            // ... View Logic ...\r\n            if (context.currentState === 'DASHBOARD_SETTINGS' && context.selectedSubjectId) {\r\n                const subject = subjects.find(s => s.id === context.selectedSubjectId)!;\r\n                return (\r\n                    <ControlLayout\r\n                        currentView={context.currentState}\r\n                        onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                        lang={language}\r\n                        onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                        theme={theme}\r\n                        onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                    >\r\n                        <SubjectSettingsView\r\n                            subject={subject}\r\n                            lang={language}\r\n                            onSave={(config) => {\r\n                                console.log(\"Saving Config:\", config);\r\n                                setContext(prev => ({ ...prev, currentState: 'DASHBOARD_SUBJECT' }));\r\n                            }}\r\n                            onCancel={() => setContext(prev => ({ ...prev, currentState: 'DASHBOARD_SUBJECT' }))}\r\n                        />\r\n                    </ControlLayout>\r\n                );\r\n            }\r\n\r\n            if (context.currentState === 'DASHBOARD_SUBJECT' && context.selectedSubjectId) {\r\n                const subject = subjects.find(s => s.id === context.selectedSubjectId)!;\r\n                return (\r\n                    <ControlLayout\r\n                        currentView={context.currentState}\r\n                        onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                        lang={language}\r\n                        onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                        theme={theme}\r\n                        onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                    >\r\n                        <SubjectDetailView\r\n                            subjectId={subject.id}\r\n                            onQuestionFlowStart={(flowType, contextId, predictedDuration) => {\r\n                                if (flowType === 'SESSION_START') {\r\n                                    const lecture = lectures.find(l => l.id === contextId)!;\r\n                                    const session = PreStudyEngine.registerSession(lecture, 5, 'Medium');\r\n                                    registerSession(session);\r\n                                    setContext(prev => ({\r\n                                        ...prev,\r\n                                        currentState: 'STUDY_EXECUTION',\r\n                                        actionType: 'STUDY',\r\n                                        selectedSubjectId: subject.id,\r\n                                        activeLectureId: contextId,\r\n                                        currentSessionId: session.id,\r\n                                        tempCalibration: { familiarity: 5, focus: 50, time: predictedDuration || lecture.duration * 2 }\r\n                                    }));\r\n                                } else {\r\n                                    setContext(prev => ({ ...prev, currentState: 'REG_TYPE', actionType: 'REGISTER', selectedSubjectId: subject.id }));\r\n                                }\r\n                            }}\r\n                            onBack={() => setContext(prev => ({ ...prev, currentState: 'SUBJECT_LIST' }))}\r\n                        />\r\n                    </ControlLayout>\r\n                );\r\n            }\r\n\r\n            if (context.currentState === 'DASHBOARD_HISTORY') {\r\n                return (\r\n                    <ControlLayout\r\n                        currentView={context.currentState}\r\n                        onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                        lang={language}\r\n                        onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                        theme={theme}\r\n                        onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                    >\r\n                        <HistoryView />\r\n                    </ControlLayout>\r\n                );\r\n            }\r\n\r\n            if (context.currentState === 'DASHBOARD_CONFIG') {\r\n                return (\r\n                    <ControlLayout\r\n                        currentView={context.currentState}\r\n                        onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                        lang={language}\r\n                        onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                        theme={theme}\r\n                        onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                    >\r\n                        <SystemConfigView lang={language} />\r\n                    </ControlLayout>\r\n                );\r\n            }\r\n\r\n            return (\r\n                <ControlLayout\r\n                    currentView={context.currentState}\r\n                    onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                    lang={language}\r\n                    onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                    theme={theme}\r\n                    onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                >\r\n                    <DashboardView\r\n                        onSelectSubject={(id) => setContext(prev => ({ ...prev, currentState: 'DASHBOARD_SUBJECT', selectedSubjectId: id }))}\r\n                        onAddSubject={() => handleNext('ADD_SUBJECT')}\r\n                        lang={language}\r\n                    />\r\n                </ControlLayout>\r\n            );\r\n        }\r\n\r\n        if (context.currentState === 'STUDY_EXECUTION') {\r\n            const allocated = context.tempCalibration.time;\r\n            return (\r\n                <ControlLayout\r\n                    currentView={context.currentState}\r\n                    onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                    lang={language}\r\n                    onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                    theme={theme}\r\n                    onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n                >\r\n                    <SessionTimerView\r\n                        allocatedMinutes={allocated}\r\n                        lectureId={context.activeLectureId || context.selectedSubjectId || 'unknown_lecture'}\r\n                        subjectId={context.selectedSubjectId || 'unknown_subject'}\r\n                        lang={language}\r\n                        onComplete={handleSessionComplete}\r\n                    />\r\n                </ControlLayout>\r\n            );\r\n        }\r\n\r\n        const props = getQuestionProps();\r\n        const questionKey = FlowEngine.getQuestionKey(context.currentState);\r\n        const questionText = t(questionKey, language);\r\n\r\n        return (\r\n            <ControlLayout\r\n                currentView={context.currentState}\r\n                onNavigate={(state) => setContext(prev => ({ ...prev, currentState: state }))}\r\n                lang={language}\r\n                onToggleLang={() => setLanguage(l => l === 'en' ? 'ar' : 'en')}\r\n                theme={theme}\r\n                onToggleTheme={() => setTheme(t => t === 'light' ? 'dark' : 'light')}\r\n            >\r\n                <SingleQuestionView\r\n                    question={questionText}\r\n                    subtitle={context.currentState === 'REG_DURATION' ? t('duration_note', language) : undefined}\r\n                    warning={context.currentState === 'REG_DURATION' ? t('duration_warning', language) : undefined}\r\n                    inputType={props.inputType}\r\n                    value={inputValue}\r\n                    onChange={setInputValue}\r\n                    onConfirm={handleNext}\r\n                    placeholder={props.placeholder}\r\n                    options={props.options}\r\n                    lang={language}\r\n                />\r\n            </ControlLayout>\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11757, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/core/services/RealtimePresenceService.ts"],"sourcesContent":["import { getDatabaseInstance } from \"@/core/services/firebase\";\r\nimport { ref, onValue, onDisconnect, serverTimestamp, update } from \"firebase/database\";\r\n\r\n// ROOT PATHS\r\nconst STATUS_ROOT = (uid: string) => `status/${uid}`;\r\nconst CONNECTED_REF = \".info/connected\";\r\n\r\nexport const RealtimePresenceService = {\r\n\r\n    /**\r\n     * INITIALIZE CONNECTION LISTENER\r\n     * Call this once on app mount (AuthState listener).\r\n     * Sets up the \"Kill Switch\" (onDisconnect) mechanics.\r\n     */\r\n    initialize: (uid: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const connectedRef = ref(db, CONNECTED_REF);\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n\r\n        // Listen to connection state\r\n        onValue(connectedRef, (snap) => {\r\n            if (snap.val() === true) {\r\n                // 1. Establish \"Kill Switch\" FIRST\r\n                // If we lose connection, update status to 'offline' but PRESERVE SESSION.\r\n                onDisconnect(userStatusRef).update({\r\n                    state: 'offline',\r\n                    lastSeenAt: serverTimestamp()\r\n                    // activeSession: null (REMOVED: Session survives disconnect)\r\n                });\r\n\r\n                // 2. Set Initial Online State\r\n                update(userStatusRef, {\r\n                    state: 'online',\r\n                    lastSeenAt: serverTimestamp(),\r\n                });\r\n            }\r\n        });\r\n\r\n        // 3. LISTEN FOR AUTHORITATIVE REPORT (Admin Force End)\r\n        // This is the SINGLE SOURCE OF TRUTH for forced termination.\r\n        const terminationRef = ref(db, `status/${uid}/sessionTermination`);\r\n        onValue(terminationRef, (snap) => {\r\n            const data = snap.val();\r\n            if (data) {\r\n                console.warn(\"[RTDB]  RECEIVED AUTHORITATIVE TERMINATION SIGNAL:\", data);\r\n                // Force End Local Session (Remote Kill)\r\n                // Pass payload to display warning in UI\r\n                import(\"@/store/useStore\").then(({ useStore }) => {\r\n                    useStore.getState().endActiveSession(false, true, data);\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * UPDATE VISIBILITY STATE\r\n     * 'online' (Focused) vs 'background' (Blurred)\r\n     */\r\n    updateState: (uid: string, state: 'online' | 'background') => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n        update(userStatusRef, {\r\n            state,\r\n            lastSeenAt: serverTimestamp()\r\n        });\r\n    },\r\n\r\n    /**\r\n     * HEARTBEAT (Keep-Alive)\r\n     * Updates timestamps every 30-60s.\r\n     * MUST NOT overwrite 'background' state.\r\n     */\r\n    heartbeat: (uid: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n        // We only update lastSeenAt. We rely on updateState to manage online/background.\r\n        update(userStatusRef, {\r\n            lastSeenAt: serverTimestamp()\r\n        });\r\n    },\r\n\r\n    /**\r\n     * SESSION MANAGEMENT\r\n     * Writes full activeSession object.\r\n     */\r\n    startSession: (uid: string, lectureId: string, subjectId: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n        const sessionId = `${uid}_${lectureId}_${Date.now()}`;\r\n\r\n        // 1. Write FULL Active Session Object\r\n        update(userStatusRef, {\r\n            // Force online when starting session (usually user is active)\r\n            state: 'online',\r\n            lastSeenAt: serverTimestamp(),\r\n            activeSession: {\r\n                sessionId,\r\n                lectureId,\r\n                subjectId,\r\n                startedAt: serverTimestamp()\r\n            }\r\n        });\r\n    },\r\n\r\n    endSession: (uid: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n\r\n        // Atomic Wipe of Session -> effectively \"Not Studying\"\r\n        update(userStatusRef, {\r\n            activeSession: null,\r\n            lastSeenAt: serverTimestamp()\r\n        });\r\n    },\r\n\r\n    /**\r\n     * MANUAL OFFLINE (Cleanup)\r\n     * e.g. Logout or Tab Close\r\n     * STRICT: Must PRESERVE activeSession if one exists.\r\n     */\r\n    setOffline: (uid: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n        update(userStatusRef, {\r\n            state: 'offline',\r\n            lastSeenAt: serverTimestamp()\r\n            // activeSession: null (REMOVED: Session persists until explicitly ended)\r\n        });\r\n    },\r\n\r\n    /**\r\n     * TRACK PAGE NAVIGATION\r\n     */\r\n    trackPage: (uid: string, path: string) => {\r\n        const db = getDatabaseInstance();\r\n        if (!db) return;\r\n\r\n        const userStatusRef = ref(db, STATUS_ROOT(uid));\r\n        update(userStatusRef, {\r\n            currentPage: path,\r\n            lastSeenAt: serverTimestamp()\r\n        });\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11913, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/layout/PresenceListener.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { useStore } from '@/store/useStore';\r\nimport { RealtimePresenceService } from '@/core/services/RealtimePresenceService';\r\nimport { usePathname } from 'next/navigation';\r\n\r\nexport const PresenceListener = () => {\r\n    const { authState, activeSession } = useStore();\r\n    const user = authState.user;\r\n    const pathname = usePathname();\r\n\r\n    // --- 0. DEV ENVIRONMENT GUARD ---\r\n    // In production, we might want to disable this check or make it robust.\r\n    // For now, we allow localhost to write to RTDB (assuming correct config).\r\n\r\n    // --- 1. PRESENCE LAYER (RTDB) ---\r\n    useEffect(() => {\r\n        if (!user?.id) return;\r\n\r\n        // A. Initialize Connection Listeners (Kill Switch)\r\n        RealtimePresenceService.initialize(user.id);\r\n\r\n        // B. Visibility Handler (Online <-> Background)\r\n        const handleVisibility = () => {\r\n            const status = document.hidden ? 'background' : 'online';\r\n            RealtimePresenceService.updateState(user.id, status);\r\n        };\r\n        document.addEventListener('visibilitychange', handleVisibility);\r\n\r\n        // C. Heartbeat Loop (60s)\r\n        // STRICT: Only update timestamp, do NOT overwrite state.\r\n        const heartbeat = setInterval(() => {\r\n            RealtimePresenceService.heartbeat(user.id);\r\n        }, 60000);\r\n\r\n        // D. Cleanup (Offline)\r\n        const handleUnload = () => {\r\n            RealtimePresenceService.setOffline(user.id);\r\n        };\r\n        window.addEventListener('beforeunload', handleUnload);\r\n\r\n        return () => {\r\n            document.removeEventListener('visibilitychange', handleVisibility);\r\n            window.removeEventListener('beforeunload', handleUnload);\r\n            clearInterval(heartbeat);\r\n        };\r\n    }, [user?.id]);\r\n\r\n    // --- 2. STUDY STATE LAYER (RTDB) ---\r\n    // Tracks \"In Session\" status via Session ID persistence\r\n    useEffect(() => {\r\n        if (!user?.id) return;\r\n\r\n        if (activeSession) {\r\n            // Start/Update Session in RTDB\r\n            // Writes strict object: { sessionId, lectureId, subjectId, startedAt }\r\n            RealtimePresenceService.startSession(\r\n                user.id,\r\n                activeSession.lectureId,\r\n                activeSession.subjectId\r\n            );\r\n        } else {\r\n            // End Session in RTDB (Atomic Wipe)\r\n            RealtimePresenceService.endSession(user.id);\r\n        }\r\n\r\n    }, [user?.id, activeSession?.lectureId, activeSession?.subjectId]);\r\n\r\n    // Track Page Changes as Interactions\r\n    useEffect(() => {\r\n        if (user?.id) {\r\n            RealtimePresenceService.trackPage(user.id, pathname);\r\n        }\r\n    }, [pathname, user?.id]);\r\n\r\n    return null;\r\n};\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;AAOO,MAAM,mBAAmB;IAC5B,MAAM,EAAE,SAAS,EAAE,aAAa,EAAE,GAAG,IAAA,oIAAQ;IAC7C,MAAM,OAAO,UAAU,IAAI;IAC3B,MAAM,WAAW,IAAA,iJAAW;IAE5B,mCAAmC;IACnC,wEAAwE;IACxE,0EAA0E;IAE1E,mCAAmC;IACnC,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,MAAM,IAAI;QAEf,mDAAmD;QACnD,6KAAuB,CAAC,UAAU,CAAC,KAAK,EAAE;QAE1C,gDAAgD;QAChD,MAAM,mBAAmB;YACrB,MAAM,SAAS,SAAS,MAAM,GAAG,eAAe;YAChD,6KAAuB,CAAC,WAAW,CAAC,KAAK,EAAE,EAAE;QACjD;QACA,SAAS,gBAAgB,CAAC,oBAAoB;QAE9C,0BAA0B;QAC1B,yDAAyD;QACzD,MAAM,YAAY,YAAY;YAC1B,6KAAuB,CAAC,SAAS,CAAC,KAAK,EAAE;QAC7C,GAAG;QAEH,uBAAuB;QACvB,MAAM,eAAe;YACjB,6KAAuB,CAAC,UAAU,CAAC,KAAK,EAAE;QAC9C;QACA,OAAO,gBAAgB,CAAC,gBAAgB;QAExC,OAAO;YACH,SAAS,mBAAmB,CAAC,oBAAoB;YACjD,OAAO,mBAAmB,CAAC,gBAAgB;YAC3C,cAAc;QAClB;IACJ,GAAG;QAAC,MAAM;KAAG;IAEb,sCAAsC;IACtC,wDAAwD;IACxD,IAAA,kNAAS,EAAC;QACN,IAAI,CAAC,MAAM,IAAI;QAEf,IAAI,eAAe;YACf,+BAA+B;YAC/B,uEAAuE;YACvE,6KAAuB,CAAC,YAAY,CAChC,KAAK,EAAE,EACP,cAAc,SAAS,EACvB,cAAc,SAAS;QAE/B,OAAO;YACH,oCAAoC;YACpC,6KAAuB,CAAC,UAAU,CAAC,KAAK,EAAE;QAC9C;IAEJ,GAAG;QAAC,MAAM;QAAI,eAAe;QAAW,eAAe;KAAU;IAEjE,qCAAqC;IACrC,IAAA,kNAAS,EAAC;QACN,IAAI,MAAM,IAAI;YACV,6KAAuB,CAAC,SAAS,CAAC,KAAK,EAAE,EAAE;QAC/C;IACJ,GAAG;QAAC;QAAU,MAAM;KAAG;IAEvB,OAAO;AACX"}},
    {"offset": {"line": 11994, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/components/layout/RootGate.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useStore } from '@/store/useStore';\r\nimport CompleteProfileView from '@/components/profile/CompleteProfileView';\r\nimport { MainApp } from '@/components/layout/MainApp';\r\nimport { PresenceListener } from '@/components/layout/PresenceListener';\r\n\r\n/**\r\n * ROOT GATE KEEPER\r\n * \r\n * The single source of truth for Application State.\r\n * Handles Auth Initialization internally.\r\n */\r\nexport default function RootGate() {\r\n    // --- 1. UNCONDITIONAL HOOKS ---\r\n    const { authState, syncAuth, initializeRealtimeSync } = useStore();\r\n    const [isMounted, setIsMounted] = useState(false);\r\n\r\n    // Initial Mount & Auth Subscription (RUNS ONCE)\r\n    useEffect(() => {\r\n        setIsMounted(true);\r\n        // Initialize Auth Listener\r\n        syncAuth();\r\n    }, []); // Empty dependency array = Runs once on mount\r\n\r\n    // Real-time Data Sync (Optimization: Only when auth'd)\r\n    useEffect(() => {\r\n        if (authState.status === 'AUTHENTICATED' && authState.user?.id) {\r\n            initializeRealtimeSync(authState.user.id);\r\n        }\r\n    }, [authState.status, authState.user?.id]);\r\n\r\n\r\n    // --- 2. LOADING STATE (Hydration & Auth Check) ---\r\n    // If not mounted (SSR/Hydration) OR Auth is still figuring itself out\r\n    if (!isMounted || authState.status === 'LOADING') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-[999999] bg-[#020617] flex items-center justify-center\">\r\n                <div className=\"w-8 h-8 border-4 border-indigo-500/30 border-t-indigo-500 rounded-full animate-spin\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- 3. STATE MACHINE DECISIONS ---\r\n    const isAuth = authState.status === 'AUTHENTICATED';\r\n    // STRICT: Profile is only complete if fullName is present in Store (from Firestore)\r\n    const isProfileComplete = authState.user?.completed === true && !!authState.user?.fullName;\r\n\r\n    // SCENARIO A: AUTHENTICATED & INCOMPLETE -> ONBOARDING\r\n    // Strictly isolate \"Onboarding\" flow so incomplete profiles can't access MainApp\r\n    if (isAuth && !isProfileComplete) {\r\n        return (\r\n            <>\r\n                <PresenceListener />\r\n                <CompleteProfileView />\r\n            </>\r\n        );\r\n    }\r\n\r\n    // SCENARIO B: MAIN APPLICATION\r\n    // Renders for both GUESTS and COMPLETE AUTH users.\r\n    // Guests see \"Sign In\" button (Handled by ControlLayout within MainApp).\r\n    return (\r\n        <>\r\n            <PresenceListener />\r\n            <MainApp />\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAce,SAAS;IACpB,iCAAiC;IACjC,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,sBAAsB,EAAE,GAAG,IAAA,oIAAQ;IAChE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,gDAAgD;IAChD,IAAA,kNAAS,EAAC;QACN,aAAa;QACb,2BAA2B;QAC3B;IACJ,GAAG,EAAE,GAAG,8CAA8C;IAEtD,uDAAuD;IACvD,IAAA,kNAAS,EAAC;QACN,IAAI,UAAU,MAAM,KAAK,mBAAmB,UAAU,IAAI,EAAE,IAAI;YAC5D,uBAAuB,UAAU,IAAI,CAAC,EAAE;QAC5C;IACJ,GAAG;QAAC,UAAU,MAAM;QAAE,UAAU,IAAI,EAAE;KAAG;IAGzC,oDAAoD;IACpD,sEAAsE;IACtE,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,WAAW;QAC9C,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;;;;;;;;;;IAG3B;IAEA,qCAAqC;IACrC,MAAM,SAAS,UAAU,MAAM,KAAK;IACpC,oFAAoF;IACpF,MAAM,oBAAoB,UAAU,IAAI,EAAE,cAAc,QAAQ,CAAC,CAAC,UAAU,IAAI,EAAE;IAElF,uDAAuD;IACvD,iFAAiF;IACjF,IAAI,UAAU,CAAC,mBAAmB;QAC9B,qBACI;;8BACI,8OAAC,oKAAgB;;;;;8BACjB,8OAAC,+JAAmB;;;;;;;IAGhC;IAEA,+BAA+B;IAC/B,mDAAmD;IACnD,yEAAyE;IACzE,qBACI;;0BACI,8OAAC,oKAAgB;;;;;0BACjB,8OAAC,kJAAO;;;;;;;AAGpB"}},
    {"offset": {"line": 12092, "column": 0}, "map": {"version":3,"sources":["file:///E:/Courses/Acadimic%20system/src/app/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport RootGate from '@/components/layout/RootGate';\r\n\r\nexport default function Page() {\r\n    return <RootGate />;\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIe,SAAS;IACpB,qBAAO,8OAAC,mJAAQ;;;;;AACpB"}}]
}